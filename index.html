<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <!-- âœ… iOS / Androidï¼šç”¨ visualViewport + svh/dvh ç©©å®šé¦–å±ï¼Œé™ä½åœ°å€åˆ—æ”¶åˆè·³å‹• -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Tasun è³‡æ–™é¦–é  Â· ç©ºç„¡æ˜</title>
  <link rel="icon" href="data:,">
  <meta name="color-scheme" content="dark light">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- âœ…ï¼ˆæ•ˆèƒ½é™è¼‰ï¼‰ä½è¨˜æ†¶é«”/çœæµé‡/æ¸›å°‘å‹•ä½œ â†’ è‡ªå‹•é—œé–‰é«˜æˆæœ¬ç‰¹æ•ˆ -->
  <script>
  (function(){
    try{
      const dm = navigator.deviceMemory || 0;
      const conn = navigator.connection || {};
      const saveData = !!conn.saveData;
      const reduceMotion = !!(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches);
      const lowMem = (dm && dm <= 4);
      if(saveData || reduceMotion || lowMem){
        document.documentElement.classList.add("perf-lite");
      }
    }catch(e){}
  })();
  </script>

  <!-- âœ…å…¨ç«™ç‰ˆæœ¬ -->
  <script>
    window.APP_VER = window.APP_VER || "20260129_03";
    window.TASUN_APP_VER = window.TASUN_APP_VER || window.APP_VER;
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body class="locked booting">
  <!-- âœ…ç‰ˆæœ¬é–å®š + appH ç©©å®šï¼ˆé¿å… iOS åœ°å€åˆ—è·³å‹•ï¼‰+ preload ä¸»åœ–ï¼ˆæ¸›å°‘é¦–å±ç©ºç™½ï¼‰ -->
  <script>
  (function () {
    "use strict";

    const VER = String(window.TASUN_APP_VER || window.APP_VER || "").trim();
    const url = new URL(location.href);
    const curV = url.searchParams.get("v") || "";

    if (VER && curV !== VER) {
      url.searchParams.set("v", VER);
      location.replace(url.toString());
      return;
    }

    window.__CACHE_V = VER || curV || "";

    window.__withV = window.__withV || function (u) {
      const vv = String(window.__CACHE_V || "").trim();
      if (!vv) return u;
      try {
        const uu = new URL(u, document.baseURI);
        if (uu.origin === location.origin) {
          uu.searchParams.set("v", vv);
          return uu.toString();
        }
        return u;
      } catch (e) {
        const s = String(u || "");
        if (!s || /^https?:\/\//i.test(s) || /^mailto:/i.test(s)) return s;
        const sep = s.includes("?") ? "&" : "?";
        return s + sep + "v=" + encodeURIComponent(vv);
      }
    };

    /* âœ… iOS åœ°å€åˆ—è·³å‹•æŠ‘åˆ¶ï¼šå–ã€Œæœ€å°å¯è¦–é«˜åº¦ã€ä½œç‚º appHï¼ˆåªæœƒè®Šå°ï¼Œä¸æœƒå› æ”¶åˆè€Œè®Šå¤§é€ æˆè·³å‹•ï¼‰ */
    (function initViewportStabilizer(){
      const root = document.documentElement;
      let minH = 0;
      let lastW = 0;

      function calcVV(reset){
        try{
          const vv = window.visualViewport;
          const h = Math.round(vv ? vv.height : window.innerHeight);
          const w = Math.round(vv ? vv.width  : window.innerWidth);

          const top = Math.round(vv ? vv.offsetTop : 0);
          const bottom = Math.max(0, Math.round(window.innerHeight - (vv ? (vv.height + vv.offsetTop) : window.innerHeight)));

          root.style.setProperty("--vv-top", top + "px");
          root.style.setProperty("--vv-bottom", bottom + "px");

          if(reset || !minH || Math.abs(w - lastW) > 180){
            minH = h;
            lastW = w;
          }else{
            minH = Math.min(minH, h); // âœ…åªå–æ›´å°çš„é«˜åº¦ â†’ æ”¶åˆ/å±•é–‹ä¸è·³
          }
          root.style.setProperty("--appH", minH + "px");
          root.style.setProperty("--appW", w + "px");
        }catch(e){
          try{
            root.style.setProperty("--appH", window.innerHeight + "px");
            root.style.setProperty("--appW", window.innerWidth + "px");
          }catch(_){}
        }
      }

      calcVV(true);

      const onResize = () => calcVV(false);
      const onOrient = () => calcVV(true);

      window.addEventListener("resize", onResize, { passive:true });
      window.addEventListener("orientationchange", onOrient, { passive:true });
      if(window.visualViewport){
        window.visualViewport.addEventListener("resize", onResize, { passive:true });
        // âœ…scroll ä¹Ÿå¯èƒ½è§¸ç™¼ offset è®ŠåŒ–ï¼Œä½†åªæ›´æ–° CSS è®Šæ•¸ï¼Œä¸åš layout é‡æ¸¬
        window.visualViewport.addEventListener("scroll", onResize, { passive:true });
      }
      document.addEventListener("visibilitychange", ()=>{ if(document.visibilityState==="visible") calcVV(false); }, { passive:true });
    })();

    // âœ… preload ä¸»åœ–ï¼ˆæ›´å¿«é€²ä¾†ï¼‰
    try{
      const id = "preloadZen";
      if(!document.getElementById(id)){
        const l = document.createElement("link");
        l.id = id;
        l.rel = "preload";
        l.as = "image";
        l.href = window.__withV("ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png");
        l.setAttribute("data-base", "ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png");
        document.head.appendChild(l);
      }
    }catch(e){}

    function patchZenResources(){
      const withV = window.__withV || ((u)=>u);
      try{
        const l = document.getElementById("preloadZen");
        if(l){
          const base = l.getAttribute("data-base") || l.getAttribute("href") || "";
          if(base) l.href = withV(base);
        }
      }catch(e){}
      try{
        const img = document.getElementById("zenImg");
        if(img){
          const base = img.getAttribute("data-base") || img.getAttribute("src") || "";
          if(base) img.src = withV(base);
        }
      }catch(e){}
    }
    patchZenResources();
    document.addEventListener("DOMContentLoaded", patchZenResources, { once:true });

    // âœ…å‹•æ…‹è¼‰å…¥ï¼ˆç¶­æŒä½ åŸæœ¬æ¶æ§‹ï¼‰
    (function(){
      const withV = window.__withV || ((u)=>u);
      function loadScript(src){
        return new Promise((resolve)=>{
          try{
            const s = document.createElement("script");
            s.src = src;
            s.async = false;
            s.onload = ()=>resolve(true);
            s.onerror = ()=>resolve(false);
            document.head.appendChild(s);
          }catch(e){ resolve(false); }
        });
      }

      (async()=>{
        await loadScript(withV("tasun-boot.js"));
        await loadScript(withV("tasun-loader.js"));

        function tryStart(){
          try{
            if(window.TasunLoader && typeof window.TasunLoader.start === "function"){
              window.TasunLoader.start({
                pageKey: "index",
                verUrl: "tasun-version.json",
                corePath: "tasun-core.js",
                forceUrlV: true,
                forceVersionSync: false,
                patchResources: true,
                networkToast: true,
                appHeightVar: false,
                preloadId: "preloadZen",
                zenImgId: "zenImg",
                appVer: window.TASUN_APP_VER
              });
              return true;
            }
          }catch(e){}
          return false;
        }

        if(!tryStart()){
          let n=0;
          const t=setInterval(()=>{
            n++;
            if(tryStart() || n>120) clearInterval(t);
          }, 50);
        }
      })();
    })();
  })();
  </script>

  <style>
    :root{
      --gap-01cm: 0.1cm;
      --outer-side: var(--gap-01cm);
      --frame-inset: var(--gap-01cm);
      --frame-radius: clamp(16px, 1.55vw, 30px);

      --vv-top: 0px;
      --vv-bottom: 0px;

      /* âœ…ä¸»è¦–è¦ºäº®åº¦ï¼ˆé¿å…æ•´é  filterï¼‰ */
      --ambient-op: 0.58;

      --zen-opacity: 0.99;
      --zen-scale: 1.00;
      --zen-contrast: 1.14;
      --zen-bright: 1.12;
      --zen-sat: 1.05;
      --zen-posX: 50%;
      --zen-posY: 50%;

      /* âœ…ç‰¹æ•ˆï¼ˆperf-lite æœƒé—œï¼‰ */
      --ripple-op: .0032;
      --ripple-speed: 30s;
      --mist-op: .10;
      --mist-a: rgba(245,250,255,0.10);
      --mist-b: rgba(235,245,255,0.06);
      --mist-beam: rgba(255,248,235,0.05);
      --mist-blur: 16px;
      --mist-speed: 54s;

      /* âœ…Blurï¼šæ¡Œæ©Ÿ 16â€“18pxï¼›æ‰‹æ©Ÿ 12pxï¼ˆæ•ˆèƒ½å¤§å¹…å¥½ï¼‰ */
      --panel-blur: 17px;
      --btn-blur: 17px;

      --title-size: clamp(2.15rem, 4.6vw, 4.15rem);

      /* âœ…ç¦ªå­—å¤§å°ï¼šåº•éƒ¨å­—ã€Œä¿åº•ä¸ç¸®ã€ */
      --axis-top: clamp(78px, 11vh, 170px);
      --axis-size: clamp(2.00rem, 3.8vw, 3.80rem);
      --axis-op: 0.86;

      --side-size: clamp(1.06rem, 2.0vw, 1.70rem);
      --bottom-size: clamp(1.14rem, 2.2vw, 1.72rem);

      --side-op: 0.68;
      --bottom-op: 0.95;

      --zen-fixed-y: 58%;
      --zen-fixed-x: clamp(64px, 18vw, 360px);

      --zw-bottom-lift: clamp(2.10cm, 5.4vh, 2.95cm);
      --zw-bottom-pad: calc(var(--frame-inset) + var(--zw-bottom-lift) + env(safe-area-inset-bottom) + var(--vv-bottom));

      /* âœ…é»ƒæ°´æ™¶ï¼šæ›´æ·±é‡‘ã€æ›´éŠ³åˆ©ã€æé‚Šæ›´ç©©ã€é™°å½±æ›´èšç„¦ */
      --amber-1: rgba(255, 255, 255, 0.78);
      --amber-2: rgba(255, 244, 210, 0.72);
      --amber-3: rgba(245, 184, 74, 0.90);
      --amber-4: rgba(155, 82, 20, 0.96);
      --gold-fallback: rgba(255, 232, 175, 0.98);
      --gold-stroke: rgba(92, 56, 22, 0.70);
      --gold-shadow: rgba(0, 0, 0, 0.52);
      --gold-glow: rgba(255, 220, 160, 0.18);

      /* âœ…æŒ‰éµï¼šæ›´é€æ˜ã€ä½†å­—æ›´æ¸…æ¥šï¼ˆé¿å…æ´—å­—ï¼‰ */
      --btn-border: rgba(246, 211, 122, 0.72);
      --btn-border-hi: rgba(255, 244, 210, 0.92);

      --btn-glass-a: 0.060;
      --btn-glass-b: 0.055;

      --btn-body-a: rgba(255, 248, 232, 0.055);
      --btn-body-b: rgba(30, 22, 14, 0.070); /* âœ…é»‘æ›´é€æ˜ */
      --btn-text: rgba(255, 226, 156, 0.99);
      --btn-stroke: rgba(18, 8, 2, 0.94);
      --btn-stroke-w: 2.10px;
      --btn-shadowA: rgba(0,0,0,0.74);
      --btn-glowA: rgba(255, 210, 140, 0.18);

      --userbar-pad: clamp(12px, 1.1vw, 20px);

      /* âœ…nav layout varsï¼ˆJS åªæ”¹é€™äº›ï¼Œé¿å…å¤§é‡é‡æ’é‡æ¸¬ï¼‰ */
      --navTop: 140px;
      --navBottom: 140px;
      --btnH: 82px;
      --btnGap: 14px;
      --btnW: 460px; /* æ¡Œæ©Ÿå´é‚Šç”¨ */
      --btnScale: 1;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html, body{ height:100%; }

    body{
      min-height:100vh;
      font-family:"æ¨™æ¥·é«”","Noto Serif TC","Microsoft JhengHei",serif;
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
      background:
        radial-gradient(1100px 720px at 50% 12%, rgba(255,244,220,var(--ambient-op)) 0, rgba(0,0,0,0) 72%),
        radial-gradient(900px 520px at 50% 92%, rgba(246,211,122,0.12) 0, rgba(0,0,0,0) 74%),
        linear-gradient(180deg, #070809 0%, #080A0C 55%, #060608 100%);
    }
    body.locked{ overflow:hidden; }
    body.booting *{ transition:none !important; }

    html.perf-lite .ripple-film,
    html.perf-lite .mist-film{ display:none !important; }
    html.perf-lite .user-bar::before,
    html.perf-lite .user-pill,
    html.perf-lite .btn-switch,
    html.perf-lite .nav-btn{
      backdrop-filter:none !important;
      -webkit-backdrop-filter:none !important;
    }

    .gold-crystal{
      font-weight: 900;
      letter-spacing: .14em;
      color: var(--gold-fallback);
      -webkit-text-stroke: 1.15px var(--gold-stroke);
      paint-order: stroke fill;
      text-shadow:
        0 1px 0 rgba(255,255,255,0.10),
        0 8px 16px var(--gold-shadow),
        0 0 10px var(--gold-glow);
    }
    @supports ((-webkit-background-clip: text) or (background-clip: text)){
      .gold-crystal{
        background: linear-gradient(180deg,
          var(--amber-1) 0%,
          var(--amber-2) 32%,
          var(--amber-3) 70%,
          var(--amber-4) 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        -webkit-text-fill-color: transparent;
      }
    }

    /* ===== ä¸»å®¹å™¨ ===== */
    .hero{
      min-height: var(--appH, 100svh);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--outer-side);
    }

    .hero-inner{
      position:relative;
      width: calc(100vw - (var(--outer-side) * 2));
      height: calc(var(--appH, 100svh) - (var(--outer-side) * 2));
      min-height: 560px;
      border-radius: calc(var(--frame-radius) + 10px);
      overflow:hidden;

      background:
        radial-gradient(1200px 760px at 50% 18%, rgba(255,250,235,0.14), rgba(0,0,0,0) 62%),
        radial-gradient(980px 560px at 50% 92%, rgba(246,211,122,0.15), rgba(0,0,0,0) 74%),
        linear-gradient(180deg, #9c876b 0%, #7b654d 48%, #5a4635 100%);
      contain: layout paint;
    }

    .hero-inner::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.07), rgba(0,0,0,0.03)),
        radial-gradient(1100px 680px at 50% 55%, rgba(255,255,255,0.14), rgba(0,0,0,0));
      box-shadow:
        0 22px 76px rgba(0,0,0,0.26),
        inset 0 1px 0 rgba(255,255,255,0.08);
      border: 1px solid rgba(246,211,122,0.20);
      pointer-events:none;
    }
    .hero-inner::after{
      content:"";
      position:absolute;
      inset: 1px;
      border-radius: inherit;
      background:
        radial-gradient(800px 420px at 50% 15%, rgba(255,255,255,0.10), rgba(0,0,0,0) 62%),
        linear-gradient(180deg, rgba(255,244,210,0.07), rgba(0,0,0,0.03));
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.05),
        inset 0 -18px 34px rgba(0,0,0,0.06);
      pointer-events:none;
      opacity: .94;
    }

    .blessing-film{
      position:absolute;
      inset: 0;
      pointer-events:none;
      z-index: 3;
      background:
        radial-gradient(900px 540px at 50% 10%, rgba(255,244,210,0.18), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(255,248,225,0.12), rgba(0,0,0,0) 55%),
        radial-gradient(980px 640px at 50% 58%, rgba(255,232,175,0.10), rgba(0,0,0,0) 74%);
      mix-blend-mode: screen;
      opacity: .56;
    }

    /* ===== èˆå°ï¼ˆåº•åœ–ï¼‰ ===== */
    .lotus-stage{
      position:absolute;
      left: var(--frame-inset);
      right: var(--frame-inset);
      top: var(--frame-inset);
      bottom: var(--frame-inset);
      border-radius: var(--frame-radius);
      overflow:hidden;

      background:
        radial-gradient(1200px 740px at 50% 18%, rgba(255,255,255,0.16), rgba(0,0,0,0) 62%),
        radial-gradient(980px 620px at 50% 72%, rgba(255,244,210,0.08), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(112,88,64,0.12), rgba(72,54,40,0.12));

      border: 1px solid rgba(246,211,122,0.20);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        inset 0 14px 34px rgba(0,0,0,0.07),
        inset 0 -24px 40px rgba(0,0,0,0.05);

      /* âœ…å¤§é¢ç© blur ä¸ç”¨ backdrop-filterï¼ˆé¿å…å¡é “ï¼‰ï¼Œç”¨æ¼¸å±¤/å…‰æ¾¤æ¨¡æ“¬ */
      contain: paint;
    }

    .zen-visual{ position:absolute; inset:0; }
    .zen-visual img{
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: var(--zen-posX) var(--zen-posY);
      transform: scale(var(--zen-scale));
      opacity: var(--zen-opacity);
      filter: contrast(var(--zen-contrast)) brightness(var(--zen-bright)) saturate(var(--zen-sat));
      display:block;
    }

    .spotlight{
      position:absolute;
      inset:0;
      background:
        radial-gradient(900px 520px at 50% 55%, rgba(255,255,255,0.14) 0, rgba(0,0,0,0) 70%),
        radial-gradient(900px 520px at 50% 30%, rgba(246,211,122,0.07) 0, rgba(0,0,0,0) 72%);
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .ripple-film, .mist-film{
      position:absolute;
      inset: var(--frame-inset);
      border-radius: var(--frame-radius);
      pointer-events:none;
      z-index: 2;
      overflow:hidden;
      contain: paint;
    }
    .ripple-film::before{
      content:"";
      position:absolute;
      inset:-30%;
      background:
        repeating-radial-gradient(circle at 50% 70%,
          rgba(255,255,255,var(--ripple-op)) 0 2px,
          rgba(0,0,0,0) 2px 18px);
      transform: rotate(8deg);
      animation: rippleMove var(--ripple-speed) linear infinite;
    }
    @keyframes rippleMove{
      0%{ transform: translate3d(-2%,0,0) rotate(8deg); }
      100%{ transform: translate3d(2%,0,0) rotate(8deg); }
    }
    .mist-film::before{
      content:"";
      position:absolute;
      inset:-26%;
      background:
        radial-gradient(900px 520px at 30% 30%, var(--mist-a), rgba(0,0,0,0) 70%),
        radial-gradient(900px 520px at 70% 35%, var(--mist-b), rgba(0,0,0,0) 72%),
        linear-gradient(110deg, rgba(0,0,0,0), var(--mist-beam), rgba(0,0,0,0));
      filter: blur(var(--mist-blur));
      opacity: var(--mist-op);
      animation: mistDrift var(--mist-speed) ease-in-out infinite;
    }
    @keyframes mistDrift{
      0%{ transform: translate3d(-2%, -1%, 0); }
      50%{ transform: translate3d(2%, 1%, 0); }
      100%{ transform: translate3d(-2%, -1%, 0); }
    }

    /* ===== æ¨™é¡Œ ===== */
    .site-title-wrapper{
      position:absolute;
      left: 50%;
      top: calc(var(--frame-inset) + 8px + var(--vv-top));
      transform: translateX(-50%);
      z-index: 12;
      pointer-events:none;
      isolation:isolate;
    }
    .site-title-wrapper::before{
      content:"";
      position:absolute;
      inset: -10px -18px;
      border-radius: 26px;
      background:
        radial-gradient(280px 120px at 50% 40%, rgba(255,255,255,0.14), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(255,244,210,0.06), rgba(0,0,0,0));
      border: 1px solid rgba(255,240,200,0.18);
      box-shadow: 0 14px 36px rgba(0,0,0,0.16);
      opacity: .20;
      z-index: -1;
    }
    .site-title{
      font-size: var(--title-size);
      text-align:center;
      opacity: .99;
      white-space: nowrap;
    }

    /* ===== ç¦ªå­— ===== */
    .zen-words{
      position:absolute;
      inset: 0;
      z-index: 11;
      pointer-events:none;
      isolation:isolate;
      contain: paint;
    }

    .zen-crystal{
      --zc-stroke: rgba(92,56,22,0.74);
      --zc-stroke-w: 1.25px;
      --zc-shadow: rgba(0,0,0,0.54);
      --zc-glow: rgba(255,210,140,0.18);

      font-weight: 900;
      letter-spacing: .14em;

      color: rgba(255,232,175,0.98);
      -webkit-text-fill-color: rgba(255,232,175,0.98);

      -webkit-text-stroke: var(--zc-stroke-w) var(--zc-stroke);
      paint-order: stroke fill;

      text-shadow:
        0 1px 0 rgba(255,255,255,0.10),
        0 2px 1px rgba(0,0,0,0.18),
        0 10px 18px var(--zc-shadow),
        0 0 12px var(--zc-glow);
    }
    @supports ((-webkit-background-clip: text) or (background-clip: text)){
      .zen-crystal{
        background:
          linear-gradient(180deg,
            rgba(255,255,255,0.78) 0%,
            rgba(255,232,175,0.74) 34%,
            rgba(245,184,74,0.90) 68%,
            rgba(155,82,20,0.96) 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        -webkit-text-fill-color: transparent;
      }
    }

    .zw-top-axis{
      position:absolute;
      left: 50%;
      top: calc(var(--axis-top) + var(--vv-top));
      transform: translateX(-50%);
      opacity: var(--axis-op);
      padding: 10px 18px;
      border-radius: 22px;
      white-space: nowrap;
    }
    .zw-axis-text{
      font-size: var(--axis-size);
      white-space: pre;
      letter-spacing: 0;
      line-height: 1;
      opacity: 0.98;
    }

    .zw-side-col{
      position:absolute;
      top: var(--zen-fixed-y);
      transform: translateY(-50%);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      letter-spacing: .18em;
      font-size: var(--side-size);
      opacity: var(--side-op);
      white-space: nowrap;
      padding: 10px 12px;
      border-radius: 20px;
    }
    #zwLeft{ left: calc(50% - var(--zen-fixed-x)); }
    #zwRight{ right: calc(50% - var(--zen-fixed-x)); }

    .zw-bottom-line{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      bottom: var(--zw-bottom-pad);
      font-size: var(--bottom-size); /* âœ…åº•éƒ¨å­—ä¿åº•ä¸ç¸® */
      letter-spacing: .28em;
      opacity: var(--bottom-op);
      white-space: nowrap;
      padding: 8px 10px;
      border-radius: 18px;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.18));
    }

    /* ===== ä½¿ç”¨è€…åˆ—ï¼ˆé‡æ–°æ¶æ§‹ï¼šæ‰‹æ©Ÿä¸å†æ’çˆ†ï¼‰ ===== */
    .user-bar{
      position:absolute;
      left: calc(var(--frame-inset) + var(--userbar-pad) + env(safe-area-inset-left));
      top:  calc(var(--frame-inset) + var(--userbar-pad) + env(safe-area-inset-top) + var(--vv-top));
      display:flex;
      gap: 10px;
      row-gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      max-width: calc(100% - (var(--frame-inset) * 2) - 12px);
      z-index: 13;
      isolation: isolate;
      contain: layout paint;
    }

    .user-bar::before{
      content:"";
      position:absolute;
      inset:-10px -12px;
      border-radius: 999px;
      background:
        radial-gradient(260px 120px at 18% 28%, rgba(255,255,255,0.14), rgba(0,0,0,0) 70%),
        radial-gradient(320px 140px at 78% 30%, rgba(246,211,122,0.12), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(255,244,210,0.09), rgba(0,0,0,0.26));
      border: 1px solid rgba(255,244,210,0.32);
      box-shadow:
        0 18px 44px rgba(0,0,0,0.32),
        inset 0 1px 0 rgba(255,255,255,0.10);
      backdrop-filter: blur(var(--panel-blur));
      -webkit-backdrop-filter: blur(var(--panel-blur));
      z-index: -1;
      pointer-events:none;
    }

    .user-pill{
      padding: 10px 14px;
      border-radius: 999px;
      background:
        radial-gradient(240px 90px at 24% 20%, rgba(255,255,255,0.10), rgba(0,0,0,0) 70%),
        radial-gradient(300px 120px at 78% 30%, rgba(246,211,122,0.09), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(255,244,210,0.06), rgba(0,0,0,0.22));
      border: 1px solid rgba(255,244,210,0.32);
      backdrop-filter: blur(var(--panel-blur));
      -webkit-backdrop-filter: blur(var(--panel-blur));
      font-size: 15px;
      letter-spacing: .06em;
      white-space:nowrap;
      box-shadow: 0 14px 28px rgba(0,0,0,0.22);
      font-weight: 900;

      color: rgba(255, 232, 175, 0.98);
      -webkit-text-stroke: 0px transparent;
      text-shadow: 0 9px 18px rgba(0,0,0,0.62), 0 0 10px rgba(255,210,140,0.16);
    }

    .btn-switch{
      border: 1px solid rgba(255,244,210,0.34);
      background:
        radial-gradient(220px 80px at 22% 22%, rgba(255,255,255,0.10), rgba(0,0,0,0) 70%),
        radial-gradient(260px 100px at 78% 28%, rgba(246,211,122,0.10), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(255,244,210,0.06), rgba(0,0,0,0.22));
      padding: 10px 14px;
      border-radius: 999px;
      cursor:pointer;
      backdrop-filter: blur(var(--panel-blur));
      -webkit-backdrop-filter: blur(var(--panel-blur));
      box-shadow: 0 14px 28px rgba(0,0,0,0.22);
      letter-spacing:.08em;
      font-weight: 900;
      font-size: 15px;

      color: rgba(255, 232, 175, 0.98);
      -webkit-text-stroke: 0px transparent;
      text-shadow: 0 9px 18px rgba(0,0,0,0.62), 0 0 10px rgba(255,210,140,0.16);
    }
    .btn-export{ opacity: .98; }

    /* ===== å°è¦½æŒ‰éµï¼ˆé€æ˜ç»ç’ƒè†œæ¼‚æµ®ï¼‰ ===== */
    .nav-area{
      position:absolute;
      inset: var(--frame-inset);
      z-index: 7;
      pointer-events:auto;
      contain: layout paint; /* âœ…æ¸›å°‘é‡æ’æ“´æ•£ */
    }

    .nav-btn{
      display:flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;

      border-radius: 999px;
      border: 1px solid var(--btn-border);

      background:
        radial-gradient(340px 130px at 24% 20%, rgba(255,255,255,var(--btn-glass-a)), rgba(0,0,0,0) 64%),
        radial-gradient(380px 160px at 76% 26%, rgba(246,211,122,var(--btn-glass-b)), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, var(--btn-body-a), var(--btn-body-b));

      box-shadow:
        0 16px 46px rgba(0,0,0,0.28),
        0 0 34px rgba(246,211,122,0.12),
        inset 0 1px 0 rgba(255,255,255,0.10),
        inset 0 -10px 18px rgba(0,0,0,0.05);

      backdrop-filter: blur(var(--btn-blur));
      -webkit-backdrop-filter: blur(var(--btn-blur));

      user-select:none;
      -webkit-tap-highlight-color: transparent;

      position: relative;
      overflow: hidden;
      z-index: 1;

      height: var(--btnH);
    }

    /* âœ…åå…‰ç¸®å°ã€è®Šå¼±ï¼šé¿å…æ´—å­— */
    .nav-btn::after{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.00) 46%),
        radial-gradient(220px 100px at 40% 12%, rgba(255,255,255,0.06), rgba(0,0,0,0) 70%);
      opacity: .14;
      mix-blend-mode: screen;
      pointer-events:none;
    }

    .nav-btn span{
      padding: 0 18px;
      position:relative;
      z-index: 1;

      /* âœ…æŒ‰éµé¢ç©ï¼ˆé»ƒé‡‘æ¯”ä¾‹æ„Ÿï¼‰ç¸®æ”¾ï¼šç”¨ btnScale + container query */
      font-size: clamp(1.16rem, calc(5.2cqw * var(--btnScale)), 2.05rem);

      color: var(--btn-text) !important;
      -webkit-text-fill-color: var(--btn-text);

      -webkit-text-stroke: var(--btn-stroke-w) var(--btn-stroke);
      text-shadow:
        0 1px 0 rgba(0,0,0,0.18),
        0 7px 14px var(--btn-shadowA),
        0 0 10px var(--btn-glowA);

      letter-spacing: .06em;
      font-weight: 900;
      font-family:"æ¨™æ¥·é«”","Noto Serif TC","Microsoft JhengHei",serif;
      line-height: 1.12;

      white-space: normal;
      text-align: center;
      text-wrap: balance;

      max-width: 92%;
      overflow-wrap: anywhere;
      word-break: keep-all;
      line-break: strict;
    }

    /* âœ…è‹±æ–‡å­—åµæ¸¬ï¼šé™ä½å­—è· + ç•¥ç¸®å­—ç´šï¼Œé¿å…å¤ªå¯¬ç³Š */
    .nav-btn span.latin{
      font-family:"Noto Sans TC","Microsoft JhengHei","Noto Serif TC",sans-serif;
      letter-spacing: .04em;
      transform: scaleX(0.985);
    }
    .nav-btn span.latin-only{
      letter-spacing: .03em;
      transform: scaleX(0.975);
    }

    .nav-btn:hover{
      border-color: var(--btn-border-hi);
      box-shadow:
        0 20px 54px rgba(0,0,0,0.32),
        0 0 44px rgba(246,211,122,0.16),
        inset 0 1px 0 rgba(255,255,255,0.12),
        inset 0 -10px 18px rgba(0,0,0,0.06);
    }
    .nav-btn:focus{
      outline:none;
      border-color: var(--btn-border-hi);
      box-shadow:
        0 0 0 2px rgba(246,211,122,0.14),
        0 20px 54px rgba(0,0,0,0.32),
        0 0 44px rgba(246,211,122,0.16);
    }

    /* ===== nav layoutï¼ˆJS åªåˆ‡ class + è®Šæ•¸ï¼‰ ===== */
    .nav-area{
      padding-top: var(--navTop);
      padding-bottom: var(--navBottom);
      padding-left: 16px;
      padding-right: 16px;
    }

    /* æ‰‹æ©Ÿï¼šç›´æ¬„ */
    .nav-area.stack{
      display:flex;
      flex-direction: column;
      gap: var(--btnGap);
      justify-content:flex-start;
    }
    .nav-area.stack .nav-btn{
      position:relative;
      width: 100%;
      border-radius: 18px;
    }

    /* æ‰‹æ©Ÿï¼šé›™æ¬„ï¼ˆè¶…ä½é«˜åº¦æ™‚ç”¨ï¼‰ */
    .nav-area.grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--btnGap);
      align-content: start;
    }
    .nav-area.grid2 .nav-btn{
      position:relative;
      width: 100%;
      border-radius: 18px;
    }
    /* systemBtn è®“å®ƒä¸€åˆ—åƒæ»¿ï¼ˆæ›´å¥½æŒ‰ï¼‰ */
    .nav-area.grid2 #systemBtn{ grid-column: 1 / -1; }

    /* æ¡Œæ©Ÿï¼šå·¦å³å´é‚Šï¼ˆç”¨ absolute å®šä½ï¼Œé¿å…ä¸­å¿ƒæ“ å£“ç¦ªå­—ï¼‰ */
    .nav-area.sides{
      position:absolute;
      inset: var(--frame-inset);
      padding-top: 0;
      padding-bottom: 0;
      padding-left: 0;
      padding-right: 0;
    }
    .nav-area.sides .nav-btn{
      position:absolute;
      width: var(--btnW);
      height: var(--btnH);
    }

    /* ===== ç™»å…¥é®ç½©ï¼ˆä¿ç•™ä½ åŸåŠŸèƒ½ï¼‰ ===== */
    .login-overlay{
      position:fixed; inset:0; z-index: 3000;
      display:none; align-items:center; justify-content:center;
      background:
        radial-gradient(900px 560px at 50% 45%, rgba(0,0,0,0.30), rgba(0,0,0,0.66)),
        radial-gradient(1200px 760px at 50% 10%, rgba(246,211,122,0.10), rgba(0,0,0,0)),
        rgba(0,0,0,0.52);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .login-box{
      width: min(520px, calc(100vw - 36px));
      border-radius: 22px;
      padding: 22px 22px 18px;
      background: linear-gradient(180deg, rgba(34, 22, 12, 0.96), rgba(15, 10, 6, 0.97));
      border: 1px solid rgba(246,211,122,0.62);
      box-shadow: 0 26px 90px rgba(0,0,0,0.58), inset 0 1px 0 rgba(255,255,255,0.06);
    }
    .login-title{ font-size: 1.64rem; margin-bottom: 10px; text-align:center; }
    .login-sub{
      text-align:center; min-height: 18px; font-size: 14px; opacity:.86; margin-bottom: 14px;
      color: rgba(255,232,175,0.90);
      letter-spacing:.06em;
      -webkit-text-stroke: 0.55px rgba(92,56,22,0.52);
      text-shadow: 0 7px 14px rgba(0,0,0,0.46);
      font-weight: 900;
    }
    .login-field{ display:flex; flex-direction: column; gap: 8px; margin: 12px 0; }
    .login-field label{
      font-size: 14px; letter-spacing: .12em; color: rgba(255,232,175,0.90);
      -webkit-text-stroke: 0.50px rgba(92,56,22,0.52);
      text-shadow: 0 7px 14px rgba(0,0,0,0.42);
      font-weight: 900;
    }
    .login-pwd-wrapper{ display:flex; gap: 10px; align-items:center; }
    .login-pwd-input{
      flex:1; padding: .78rem .96rem; border-radius:999px;
      border:1px solid rgba(246,211,122,0.78);
      background:
        linear-gradient(180deg, rgba(255,250,235,0.08), rgba(0,0,0,0.00)),
        linear-gradient(180deg, rgba(10, 7, 4, 0.78), rgba(0,0,0,0.44));
      color: rgba(255, 244, 210, 0.99); caret-color: rgba(255, 244, 210, 0.99);
      -webkit-text-stroke: .72px rgba(92,56,22,0.52);
      text-shadow: 0 1px 0 rgba(10,6,2,0.28), 0 5px 10px rgba(10,6,2,0.44);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 12px 20px rgba(0,0,0,0.24);
      outline:none;
      font-size: 15px;
      font-weight: 900;
    }
    .login-pwd-input:focus{
      border-color: rgba(255,244,210,0.96);
      box-shadow: 0 0 0 2px rgba(246,211,122,0.18), 0 0 22px rgba(246,211,122,0.22), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .btn-eye-login{
      width: 44px; height: 44px; border-radius: 999px;
      border:1px solid rgba(246,211,122,0.62);
      background: rgba(0,0,0,0.22);
      color: rgba(255,232,175,0.96);
      cursor:pointer;
      box-shadow: 0 12px 22px rgba(0,0,0,0.26);
      -webkit-text-stroke: 0.65px rgba(92,56,22,0.52);
      text-shadow: 0 8px 16px rgba(0,0,0,0.50);
      font-weight: 900;
    }
    .login-error{
      min-height: 18px; color: rgba(255,190,160,0.98); font-size: 14px; letter-spacing: .06em; margin-top: 6px; text-align:center;
      -webkit-text-stroke: 0.45px rgba(0,0,0,0.40);
      text-shadow: 0 8px 16px rgba(0,0,0,0.48);
      font-weight: 900;
    }
    .login-actions{ display:flex; gap: 12px; justify-content:center; margin-top: 14px; }
    .btn-login, .btn-secondary{
      border-radius: 999px; padding: 12px 18px;
      border: 1px solid rgba(255,244,210,0.40);
      background:
        radial-gradient(240px 90px at 24% 18%, rgba(255,255,255,0.16), rgba(0,0,0,0) 70%),
        radial-gradient(300px 120px at 78% 26%, rgba(246,211,122,0.14), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(255,244,210,0.10), rgba(0,0,0,0.24));
      cursor:pointer; letter-spacing: .12em;
      box-shadow:
        0 16px 34px rgba(0,0,0,0.32),
        inset 0 1px 0 rgba(255,255,255,0.10);
      font-size: 15px;
      font-weight: 900;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);

      color: rgba(255,232,175,0.98);
      -webkit-text-stroke: 0px transparent;
      text-shadow: 0 10px 18px rgba(0,0,0,0.62), 0 0 10px rgba(255,210,140,0.14);
    }

    /* ===== è‡ªè£½ä¸‹æ‹‰ï¼ˆä¿ç•™ï¼‰ ===== */
    .select-wrap{ position:relative; width:100%; }
    .select-wrap select{ position:absolute; inset:0; opacity:0; pointer-events:none; }
    .select-display{
      width:100%; display:flex; align-items:center; justify-content:flex-start; text-align:left;
      padding: .78rem 2.90rem .78rem .96rem;
      border-radius:999px; border:1px solid rgba(246,211,122,0.78);
      background:
        linear-gradient(180deg, rgba(255,250,235,0.08), rgba(0,0,0,0.00)),
        linear-gradient(180deg, rgba(10, 7, 4, 0.78), rgba(0,0,0,0.44));
      color: rgba(255,232,175,0.96);
      -webkit-text-stroke: .70px rgba(92,56,22,0.52);
      text-shadow: 0 1px 0 rgba(10,6,2,0.28), 0 6px 12px rgba(0,0,0,0.46);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 12px 20px rgba(0,0,0,0.24);
      cursor:pointer; user-select:none; position:relative; appearance:none;
      backdrop-filter:none; -webkit-backdrop-filter:none;
      font-size: 15px;
      font-weight: 900;
    }
    .select-display::after{
      content:"â–¾";
      position:absolute; right: .88rem; top: 50%; transform: translateY(-50%);
      opacity: .98;
      font-size: 1.36rem;
      color: rgba(255,226,156,0.98);
      -webkit-text-stroke: 0.85px rgba(92,56,22,0.62);
      text-shadow: 0 7px 14px rgba(0,0,0,0.52), 0 0 10px rgba(255,210,140,0.14);
      pointer-events:none;
      font-weight: 900;
    }
    .select-menu{
      position:absolute; left:0; right:0; top: calc(100% + 10px);
      max-height: 280px; overflow:auto;
      border-radius: 16px; border: 1px solid rgba(246,211,122,0.62);
      background: rgba(8,5,3,0.98);
      box-shadow: 0 22px 60px rgba(0,0,0,0.46), 0 0 24px rgba(246,211,122,0.10);
      display:none; z-index: 4005; padding: 6px;
    }
    .select-menu.open{ display:block; }
    .select-option{
      padding: .70rem .96rem; border-radius: 12px; cursor:pointer;
      color: rgba(255,232,175,0.98); letter-spacing:.06em;
      -webkit-text-stroke: .50px rgba(92,56,22,0.42);
      text-shadow: 0 2px 10px rgba(0,0,0,0.38);
      user-select:none; border: 1px solid transparent;
      font-weight: 900;
    }
    .select-option:hover{ background: rgba(255,244,210,0.10); }
    .select-option[aria-selected="true"]{ background: rgba(246,211,122,0.14); border-color: rgba(246,211,122,0.20); }
    .select-option.active{ background: rgba(255,244,210,0.14); border-color: rgba(255,244,210,0.22); outline: none; }

    /* ===== æ‰‹æ©Ÿé‡æ–°æ’ç‰ˆï¼ˆé—œéµï¼šé¿å…ä½ æˆªåœ–é‚£ç¨®ã€Œäº‚ã€ï¼‰ ===== */
    @media (max-width: 900px){
      :root{
        --panel-blur: 12px;
        --btn-blur: 12px;

        --side-size: clamp(1.02rem, 3.0vw, 1.30rem);
        --bottom-size: clamp(1.14rem, 3.2vw, 1.44rem);
        --axis-size: clamp(1.90rem, 5.2vw, 2.80rem);

        --zen-fixed-x: clamp(56px, 12vw, 140px);
        --axis-top: clamp(86px, 12vh, 170px);
        --zw-bottom-lift: clamp(2.25cm, 6.2vh, 3.10cm);
      }

      .hero-inner{ min-height: 520px; }

      /* âœ…user-barï¼šæ”¹æˆã€Œå…©åˆ—å°å¡ã€â†’ ä¸å†æ’çˆ†èˆå° */
      .user-bar{
        left: calc(var(--frame-inset) + 12px + env(safe-area-inset-left));
        right: calc(var(--frame-inset) + 12px + env(safe-area-inset-right));
        max-width: none;

        display:grid;
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
          "pill pill"
          "switch export";
        gap: 8px;
        align-items: stretch;
      }
      .user-pill{ grid-area: pill; white-space: normal; text-wrap: balance; }
      #btnSwitchUser{ grid-area: switch; }
      #btnExport{ grid-area: export; }

      .btn-switch, .user-pill{ font-size: 14px; padding: 10px 12px; }
      .site-title{ letter-spacing: .12em; }
    }

    @media (max-height: 560px){
      /* âœ…è¶…ä½é«˜åº¦ï¼šå´é‚Šç¦ªå­—ç¨å¾®ç¸®å°/æ·¡ä¸€é»ï¼Œä¿åº•å­—ä¸å‹• */
      :root{ --side-op: 0.58; }
      .zw-side-col{ padding: 8px 10px; }
    }
  </style>

  <!-- ===== Login Overlay ===== -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <div class="login-title gold-crystal">Tasun è³‡æ–™ Â· ç™»å…¥</div>
      <div class="login-sub" id="loginSub"></div>

      <form id="loginForm">
        <div class="login-field">
          <label for="username">ä½¿ç”¨è€…åç¨±</label>

          <div class="select-wrap" id="usernameWrap">
            <select id="username" name="username" autocomplete="username"></select>
            <button type="button" class="select-display" id="usernameDisplay" aria-haspopup="listbox" aria-expanded="false">
              è«‹é¸æ“‡ä½¿ç”¨è€…
            </button>
            <div class="select-menu" id="usernameMenu" role="listbox" aria-label="ä½¿ç”¨è€…åç¨±æ¸…å–®"></div>
          </div>
        </div>

        <div class="login-field">
          <label for="password">å¯†ç¢¼</label>
          <div class="login-pwd-wrapper">
            <input id="password" name="password" type="password" autocomplete="current-password" class="login-pwd-input" />
            <button type="button" class="btn-eye-login" id="btnTogglePwd">ğŸ‘</button>
          </div>
        </div>

        <div class="login-error" id="loginError"></div>

        <div class="login-actions">
          <button type="submit" class="btn-login">ç™»å…¥</button>
          <button type="button" class="btn-secondary" id="btnForceRelogin">åˆ‡æ›/é‡æ–°ç™»å…¥</button>
        </div>
      </form>
    </div>
  </div>

  <main class="hero">
    <div class="hero-inner" id="heroInner">
      <div class="ripple-film" aria-hidden="true"></div>
      <div class="mist-film" aria-hidden="true"></div>
      <div class="blessing-film" aria-hidden="true"></div>

      <div class="lotus-stage" id="lotusStage" aria-hidden="true">
        <div class="spotlight" aria-hidden="true"></div>
        <div class="zen-visual" aria-hidden="true">
          <img id="zenImg"
               src="ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png"
               data-base="ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png"
               alt=""
               loading="eager"
               decoding="async"
               fetchpriority="high"
               crossorigin="anonymous">
        </div>
      </div>

      <div class="zen-words" aria-hidden="true">
        <div class="zw-top-axis" id="zwTopAxis">
          <span class="zw-axis-text zen-crystal" id="zwAxisText">ç©º ç„¡ æ˜</span>
        </div>
        <div class="zw-side-col zen-crystal" id="zwLeft">ç©ºå¯§ç„¡æˆ‘</div>
        <div class="zw-side-col zen-crystal" id="zwRight">æ¸…æ˜å¯§éœ</div>
        <div class="zw-bottom-line zen-crystal" id="zwBottomLine">ç©ºç„¡ã€€æ˜éœ</div>
      </div>

      <div class="user-bar" id="userBar">
        <div class="user-pill" id="userInfo" data-text="ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥">ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥</div>
        <button class="btn-switch" id="btnSwitchUser" type="button">åˆ‡æ›å¸³è™Ÿ</button>
        <button class="btn-switch btn-export" id="btnExport" type="button">åŒ¯å‡ºå‚™ä»½</button>
      </div>

      <div class="site-title-wrapper" id="titleWrap">
        <div class="site-title gold-crystal">Tasun è³‡æ–™</div>
      </div>

      <!-- âœ… nav-areaï¼šæŒ‰éµè¦†è“‹å±¤ï¼ˆç–Šåœ¨åœ–å½¢èˆ‡æ–‡å­—ä¸Šï¼‰ -->
      <div class="nav-area" id="navArea"></div>
    </div>
  </main>

  <script>
  (function(){
    "use strict";

    function runIndexApp(){
      if(window.__tasun_index_app_started__) return;
      window.__tasun_index_app_started__ = true;

      const Core = window.TasunCore || null;
      const withV = (Core && Core.withV) ? Core.withV : (window.__withV || ((u)=>u));
      const safeJsonParse = (Core && Core.jsonParse) ? Core.jsonParse : ((s,f)=>{ try{return JSON.parse(s);}catch(e){return f;} });
      const clamp = (Core && Core.clamp) ? Core.clamp : ((n,a,b)=>Math.max(a,Math.min(b,n)));

      const rafDebounce = (Core && Core.rafDebounce) ? Core.rafDebounce : (fn=>{
        let r=0; return function(){ try{ cancelAnimationFrame(r); }catch(e){} r=requestAnimationFrame(()=>{ try{ fn(); }catch(e){} }); };
      });

      const onFontsReady = (cb)=>{
        if(document.fonts && document.fonts.ready) document.fonts.ready.then(cb);
        else setTimeout(cb, 180);
      };

      const $ = (sel)=>document.querySelector(sel);

      const AUTH_KEY    = "tasunAuthTable_v1";
      const CURRENT_KEY = "tasunCurrentUser_v1";
      const SESSION_KEY = "tasunSessionLogin_v1";
      const NAV_KEY     = "tasunNavButtons_v1";
      const ROUTE_KEY   = "tasunNavRoutes_v1";

      const BACKUP_RING_KEY = "tasunBackupRing_v1";
      const BACKUP_RING_MAX = 10;

      const METRO_ID    = "btn2";
      const METRO_HREF  = "æ±æ±å·¥ç¨‹ç®¡ç†è¡¨.html";

      const FIXED_ROUTES = {
        "æ·é‹æ±æ±ç·šäº‹é …ç´€éŒ„": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
        "æ·é‹æ±æ±ç·šäº‹é …è¨˜éŒ„": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
        "æ·é‹æ±æ±ç·šäº‹é …ç´€éŒ„.html": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
        "æ·é‹æ±æ±ç·šäº‹é …è¨˜éŒ„.html": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
        "æ·é‹æ±æ±ç·šè¨˜äº‹": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
        "æ·é‹æ±æ±ç·šè¨˜äº‹.html": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
      };

      const LEGACY_BUTTON_KEYS = ["btn1","btn2","btn3","btn4","btn5"];

      const loginOverlay = $("#loginOverlay");
      const loginForm    = $("#loginForm");
      const loginError   = $("#loginError");
      const loginSub     = $("#loginSub");
      const userInfo     = $("#userInfo");
      const btnSwitch    = $("#btnSwitchUser");
      const btnExport    = $("#btnExport");
      const btnTogglePwd = $("#btnTogglePwd");
      const btnForceRelogin = $("#btnForceRelogin");

      const navArea      = $("#navArea");
      const titleWrap    = $("#titleWrap");
      const userBar      = $("#userBar");
      const zwTopAxis    = $("#zwTopAxis");
      const zwBottomLine = $("#zwBottomLine");
      const zenImg       = document.getElementById("zenImg");
      const heroInner    = $("#heroInner");

      const usernameWrap = document.getElementById("usernameWrap");
      const usernameSel = document.getElementById("username");
      const usernameDisplay = document.getElementById("usernameDisplay");
      const usernameMenu = document.getElementById("usernameMenu");

      /* =========================
         âœ…é›²ç«¯ï¼ˆindex.htmlï¼šå¤šå€‹ localStorage key åŒæ­¥ï¼‰ Type (B)
         resourceKeyï¼štasun-index-db
         keysï¼šAUTH_KEY / NAV_KEY / ROUTE_KEY
         åˆä½µï¼šcloud-kit merge æ¨¡å¼ï¼ˆå¤šäººåŒæ™‚ä¸è¦†è“‹ï¼‰
         UIï¼šç¶­æŒ kit é è¨­ï¼ˆå³ä¸‹è§’ï¼‰
         ========================= */
      const CLOUD_RES_URL = "tasun-resources.json";
      const CLOUD_RESOURCE_KEY = String(window.TASUN_INDEX_CLOUD_KEY || "tasun-index-db").trim() || "tasun-index-db";
      const CLOUD_KEYS = [AUTH_KEY, NAV_KEY, ROUTE_KEY];
      const CLOUD_KEY_SET = new Set(CLOUD_KEYS);

      let cloudCtrl = null;
      let cloudApplying = false;
      let cloudSaveTimer = 0;

      function loadScriptOnce(src){
        return new Promise((resolve)=>{
          try{
            const id = "tasunScript__" + src;
            if(document.getElementById(id)) return resolve(true);
            const s = document.createElement("script");
            s.id = id;
            s.src = src;
            s.async = true;
            s.onload = ()=>resolve(true);
            s.onerror = ()=>resolve(false);
            document.head.appendChild(s);
          }catch(e){ resolve(false); }
        });
      }

      function buildCloudPayloadFromLocal(){
        const rows = [];
        const keys = CLOUD_KEYS.slice().sort((a,b)=>a.localeCompare(b,"zh-Hant"));
        keys.forEach((k, idx)=>{
          const raw = localStorage.getItem(k);
          rows.push({ id: idx + 1, k, v: (raw == null ? "" : String(raw)) });
        });
        return { db: rows, counter: rows.length };
      }

      function scheduleCloudSave(readOnly){
        if(readOnly) return;
        if(!cloudCtrl || typeof cloudCtrl.saveMerged !== "function") return;
        if(cloudApplying) return;

        clearTimeout(cloudSaveTimer);
        cloudSaveTimer = setTimeout(()=>{
          Promise.resolve(cloudCtrl.saveMerged({ lock:false, mode:"merge" })).catch(()=>{});
        }, 650);
      }

      async function ensureCloudMounted(user){
        const role = String(user?.level || "read").toLowerCase();
        const readOnly = (role === "read") || !user;

        const ok = await loadScriptOnce(withV("tasun-cloud-kit.js"));
        if(!ok || !window.TasunCloudKit || typeof window.TasunCloudKit.mount !== "function"){
          return null;
        }

        try{
          window.TasunCloudKit.init({
            appVer: window.TASUN_APP_VER || "",
            resourcesUrl: withV(CLOUD_RES_URL),
            ui: { enabled:true, hideLockButtons:true, position:"bottom-right" },
            lock: { enabled:false, auto:false }
          });
        }catch(e){}

        if(cloudCtrl){
          cloudCtrl.__readOnly__ = readOnly;
          try{ cloudCtrl.pullNow && cloudCtrl.pullNow().catch(()=>{}); }catch(e){}
          return cloudCtrl;
        }

        cloudCtrl = window.TasunCloudKit.mount({
          resourceKey: CLOUD_RESOURCE_KEY,
          pk: "k",
          idField: "id",
          counterField: "counter",
          merge: { conflictPolicy: "stash-remote", lock: "none" },
          watch: { intervalSec: 10 },
          getLocal: () => buildCloudPayloadFromLocal(),
          apply: (payload) => {
            if(!payload || !Array.isArray(payload.db)) return;
            cloudApplying = true;
            try{
              payload.db.forEach(row=>{
                const k = String(row?.k || "").trim();
                if(!k || !CLOUD_KEY_SET.has(k)) return;
                const v = (row?.v == null) ? "" : String(row.v);
                if(localStorage.getItem(k) !== v) localStorage.setItem(k, v);
              });
            }finally{
              cloudApplying = false;
            }
            // âœ…ä¸ reloadï¼šåªé‡å»ºæŒ‰éµ/ç™»å…¥æ¸…å–®
            try{ onIndexConfigApplied(); }catch(e){}
          }
        });

        cloudCtrl.__readOnly__ = readOnly;

        try{ cloudCtrl.pullNow && cloudCtrl.pullNow().catch(()=>{}); }catch(e){}
        return cloudCtrl;
      }

      /* âœ…åµæ¸¬è‹±æ–‡/ASCII */
      function markLatin(span){
        const t = String(span.textContent || "");
        const hasLatin = /[A-Za-z0-9_./-]/.test(t);
        const hasCJK   = /[\u3400-\u9FFF]/.test(t);
        if(hasLatin) span.classList.add("latin");
        if(hasLatin && !hasCJK) span.classList.add("latin-only");
      }

      function hrefToDom(href){
        const h = String(href || "").trim();
        if(!h) return "#";
        if(/^https?:\/\//i.test(h)) return h;
        if(/^mailto:/i.test(h)) return h;
        return withV(encodeURI(h));
      }
      function labelToFile(label){
        let s = String(label || "").trim();
        if(!s) return "#";
        if(s.endsWith(".html")) return s;
        s = s.replace(/[\\\/:*?"<>|]/g, "").trim();
        s = s.replace(/\s+/g, "");
        return s + ".html";
      }

      function collectBackupPayload(reason){
        const now = new Date();
        const keys = [];
        for(let i=0;i<localStorage.length;i++){
          const k = localStorage.key(i);
          if(!k) continue;
          if(k.startsWith("tasun") || k.includes("æ±æ±") || k.includes("æ·é‹") || k.includes("æ°´ç’°") || k.includes("å¯©æŸ¥") || k.includes("æ–‡ä»¶") || k.includes("è³‡æ–™åº«")){
            keys.push(k);
          }
        }
        keys.sort((a,b)=>a.localeCompare(b, "zh-Hant"));
        const data = {};
        keys.forEach(k => {
          const raw = localStorage.getItem(k);
          const parsed = safeJsonParse(raw, null);
          data[k] = (parsed === null && raw !== "null" && raw !== null) ? raw : parsed;
        });

        const sess = safeJsonParse(sessionStorage.getItem(SESSION_KEY) || "null", null);

        return {
          meta: {
            app: "Tasun index.html",
            reason: String(reason || "manual"),
            ts: now.toISOString(),
            href: location.href,
            cacheV: (window.__CACHE_V || "")
          },
          session: sess,
          data
        };
      }

      function storeBackupRing(payload){
        try{
          const arr = safeJsonParse(localStorage.getItem(BACKUP_RING_KEY) || "[]", []);
          const next = Array.isArray(arr) ? arr : [];
          next.unshift(payload);
          next.length = Math.min(next.length, BACKUP_RING_MAX);
          localStorage.setItem(BACKUP_RING_KEY, JSON.stringify(next));
        }catch(e){}
      }

      function downloadJson(payload){
        const ts = new Date().toISOString().replace(/[:.]/g, "-");
        const filename = `Tasunå‚™ä»½_${ts}.json`;
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json;charset=utf-8" });
        const u = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = u;
        a.download = filename;
        a.style.display = "none";
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          URL.revokeObjectURL(u);
          a.remove();
        }, 0);
      }

      let _exportTimer = 0;
      let _pendingReason = "";
      let _exportOnceExit = false;

      function exportBackupNow(reason, opts){
        const o = opts || {};
        const payload = collectBackupPayload(reason);
        storeBackupRing(payload);
        if(o.download){
          try{ downloadJson(payload); }catch(e){}
        }
      }
      function scheduleExport(reason){
        const r = String(reason || "auto");
        _pendingReason = _pendingReason ? (_pendingReason + " | " + r) : r;
        clearTimeout(_exportTimer);
        _exportTimer = setTimeout(() => {
          const rr = _pendingReason || "auto";
          _pendingReason = "";
          exportBackupNow(rr, { download:false });
        }, 350);
      }
      function tryExportOnExit(){
        if(_exportOnceExit) return;
        _exportOnceExit = true;
        exportBackupNow("exit/pagehide", { download:false });
      }

      window.addEventListener("pagehide", tryExportOnExit, { passive:true });
      document.addEventListener("visibilitychange", () => {
        if(document.visibilityState === "hidden") tryExportOnExit();
      }, { passive:true });

      /* =========================
         Routes / Buttons / Auth
         ========================= */
      function applyFixedRoutes(obj){
        const out = (obj && typeof obj === "object") ? { ...obj } : {};
        Object.keys(FIXED_ROUTES).forEach(k => { out[k] = FIXED_ROUTES[k]; });
        out[METRO_ID] = METRO_HREF;
        out["systemBtn"] = out["systemBtn"] || "æ¬Šé™è¡¨.html";
        return out;
      }

      function loadRoutes(){
        const seed = applyFixedRoutes({
          "btn3": "https://www.dropbox.com/",
          "systemBtn": "æ¬Šé™è¡¨.html",
          [METRO_ID]: METRO_HREF
        });

        const raw = localStorage.getItem(ROUTE_KEY);
        if(!raw){
          localStorage.setItem(ROUTE_KEY, JSON.stringify(seed, null, 2));
          return seed;
        }

        const parsed = safeJsonParse(raw, null);
        const base = (parsed && typeof parsed === "object") ? parsed : {};
        const merged = applyFixedRoutes({ ...base, ...seed });

        if(JSON.stringify(base) !== JSON.stringify(merged)){
          localStorage.setItem(ROUTE_KEY, JSON.stringify(merged, null, 2));
        }
        return merged;
      }

      function loadNavButtonsSeedIfMissing(){
        const seed = [
          { id:"btn1", label:"è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨" },
          { id:"btn2", label:"æ·é‹æ±æ­¢æ±æ¹–ç·š" },
          { id:"btn3", label:"é›²ç«¯æª”æ¡ˆ" },
          { id:"btn4", label:"å·¥ç¨‹è³‡æ–™åº«" },
          { id:"btn5", label:"è³‡æ–™åº«" }
        ];
        const raw = localStorage.getItem(NAV_KEY);
        if(!raw){
          localStorage.setItem(NAV_KEY, JSON.stringify(seed));
          return seed;
        }
        const arr = safeJsonParse(raw, null);
        if(Array.isArray(arr) && arr.length) return arr;
        localStorage.setItem(NAV_KEY, JSON.stringify(seed));
        return seed;
      }

      function resolveHref(cfg, routes){
        const id = String(cfg?.id || "").trim();
        const label = String(cfg?.label || "").trim();

        if(label && FIXED_ROUTES[label]) return FIXED_ROUTES[label];
        if(id === METRO_ID) return METRO_HREF;
        if(routes && routes[id]) return routes[id];
        if(routes && label && routes[label]) return routes[label];

        const guess = labelToFile(label);
        if(FIXED_ROUTES[guess]) return FIXED_ROUTES[guess];
        return guess;
      }

      function getDefaultAuthTableLegacy(btnCount){
        const keys = Array.from({length: btnCount}, (_, i) => `btn${i+1}`);
        const mkAll = () => Object.fromEntries(keys.map(k => [k, true]));
        const mkOnlyLast = () => Object.fromEntries(keys.map((k, i) => [k, i === btnCount - 1]));
        return [
          { user:"alex",  pass:"Tasun08040224", role:"admin", ...mkAll() },
          { user:"JOYCE", pass:"09220224",      role:"admin", ...mkAll() },
          { user:"tasun", pass:"tasun08040224", role:"write", ...mkAll() },
          { user:"wu",    pass:"123456",        role:"read",  ...mkOnlyLast() }
        ];
      }

      function normalizeRowFromStorage(row, btnCount){
        const username = (row?.username ?? row?.user ?? row?.name ?? row?.account ?? "").toString().trim();
        const password = (row?.password ?? row?.pass ?? "").toString();
        const level    = (row?.level ?? row?.role ?? "read").toString().trim().toLowerCase();

        const buttons = [];
        for(let i=0;i<btnCount;i++){
          const k = `btn${i+1}`;
          buttons[i] = !!row?.[k];
        }
        return { username, password, level, buttons };
      }

      function loadAuthTable(btnCount){
        const raw = localStorage.getItem(AUTH_KEY);
        if(!raw){
          const legacy = getDefaultAuthTableLegacy(btnCount);
          localStorage.setItem(AUTH_KEY, JSON.stringify(legacy));
          return legacy.map(r => normalizeRowFromStorage(r, btnCount));
        }
        const parsed = safeJsonParse(raw, null);
        const arr = Array.isArray(parsed) ? parsed : (parsed && Array.isArray(parsed.users) ? parsed.users : null);
        if(Array.isArray(arr)){
          const mapped = arr.map(r => normalizeRowFromStorage(r, btnCount)).filter(x => x.username);
          if(mapped.length) return mapped;
        }
        const legacy = getDefaultAuthTableLegacy(btnCount);
        localStorage.setItem(AUTH_KEY, JSON.stringify(legacy));
        return legacy.map(r => normalizeRowFromStorage(r, btnCount));
      }

      function setSession(user){
        try{ sessionStorage.setItem(SESSION_KEY, JSON.stringify({ user: user.username, role: user.level, t: Date.now() })); }catch(e){}
      }
      function clearSession(){ try{ sessionStorage.removeItem(SESSION_KEY); }catch(e){} }
      function getSession(){
        const obj = safeJsonParse(sessionStorage.getItem(SESSION_KEY) || "null", null);
        if(!obj || typeof obj !== "object") return null;
        const u = String(obj.user || "").trim();
        const r = String(obj.role || "").trim().toLowerCase();
        if(!u) return null;
        return { user: u, role: r, t: Number(obj.t || 0) };
      }

      const ROLE_MAP = {
        "btn1": ["admin","write","read"],
        "btn2": ["admin","write","read"],
        "btn3": ["admin","write","read"],
        "btn4": ["admin","write"],
        "btn5": ["admin","write","read"],
        "systemBtn": ["admin"]
      };
      const SYSTEM_BTN = { id:"systemBtn", label:"ç³»çµ± / æ¬Šé™", roles:["admin"] };

      let BTN_CONFIGS = [];
      let mainNavBtns = [];
      let AUTH_TABLE = [];
      let ROUTES = loadRoutes();
      let NAV_ARR = loadNavButtonsSeedIfMissing();

      function isRoleAllowed(cfg, level){
        if(!cfg || !Array.isArray(cfg.roles)) return true;
        return cfg.roles.includes(level);
      }
      function isAllowedByAuth(user, cfg){
        if(cfg && cfg.id === "systemBtn") return true;
        const flags = Array.isArray(user.buttons) ? user.buttons : [];
        const m = String(cfg?.id || "").match(/^btn(\d+)$/i);
        if(!m) return true;
        const idx = parseInt(m[1], 10) - 1;
        return (flags[idx] === undefined) ? true : !!flags[idx];
      }

      function buildMainButtonsDOM(){
        ROUTES = loadRoutes();
        NAV_ARR = loadNavButtonsSeedIfMissing();

        BTN_CONFIGS = NAV_ARR.map(x => {
          const id = String(x?.id || "").trim();
          const label = String(x?.label || "").trim();
          const roles = ROLE_MAP[id] || ["admin","write","read"];
          const target = (id === "btn3") ? "_blank" : "";
          return { id, label, roles, target };
        }).concat([SYSTEM_BTN]);

        mainNavBtns = [];
        navArea.innerHTML = "";

        BTN_CONFIGS.forEach((cfg) => {
          const a = document.createElement("a");
          a.className = "nav-btn";
          a.id = cfg.id || "";

          const span = document.createElement("span");
          span.textContent = cfg.label;
          markLatin(span);

          a.appendChild(span);

          const finalHref = resolveHref(cfg, ROUTES);
          a.setAttribute("href", hrefToDom(finalHref));

          const t = cfg.target || "";
          if(t){
            a.target = t;
            if(t === "_blank") a.rel = "noopener noreferrer";
          }

          a.style.display = "none";
          navArea.appendChild(a);
          mainNavBtns.push(a);
        });
      }

      function resetButtonsForLogout(){
        mainNavBtns.forEach(btn => btn.style.display = "none");
        navArea.classList.remove("stack","grid2","sides");
        scheduleAll();
      }

      let CURRENT_USER = null;

      function refreshButtonsForCurrentUser(){
        if(!CURRENT_USER) return;

        mainNavBtns.forEach((btn, index) => {
          const cfg = BTN_CONFIGS[index];
          const okRole = isRoleAllowed(cfg, CURRENT_USER.level);
          const okAuth = isAllowedByAuth(CURRENT_USER, cfg);

          btn.style.display = (okRole && okAuth) ? "flex" : "none";

          const finalHref = resolveHref(cfg, ROUTES);
          btn.setAttribute("href", hrefToDom(finalHref));
        });

        scheduleAll();
      }

      function onIndexConfigApplied(){
        try{
          ROUTES = loadRoutes();
          NAV_ARR = loadNavButtonsSeedIfMissing();
          AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);

          // è‹¥ç™»å…¥é®ç½©æ­£åœ¨é¡¯ç¤º â†’ ç«‹åˆ»åˆ·æ–°æ¸…å–®
          try{
            if(loginOverlay && loginOverlay.style.display === "flex"){
              populateUserSelect();
            }
          }catch(e){}

          buildMainButtonsDOM();

          if(CURRENT_USER){
            refreshButtonsForCurrentUser();
          }else{
            resetButtonsForLogout();
          }
        }catch(e){}
      }

      /* =========================
         âœ…Layoutï¼šæ ¸å¿ƒç›®æ¨™
         1) åº•éƒ¨å­—ä¸ç¸®ï¼ˆbottom-size ä¿åº•ï¼‰
         2) åµæ¸¬åº•éƒ¨å­—æœƒæ’æŒ‰éµå€ â†’ åªæ¨æŒ‰éµå€ï¼ˆä¸ç¸®åº•å­—ï¼‰
         3) æŒ‰éµå…¨éƒ¨åœ¨è¢å¹•å…§ï¼šé«˜åº¦ä¸è¶³æ™‚è‡ªå‹•ç¸®æ”¾ï¼ˆbtnH / btnGap / btnScaleï¼‰
         4) æ¸›å°‘é‡æ¸¬ï¼šåªé‡ userBar / title / bottom / hero-inner
         ========================= */
      function getVVBottomInset(){
        try{
          const vv = window.visualViewport;
          if(!vv) return 0;
          return Math.max(0, window.innerHeight - (vv.height + vv.offsetTop));
        }catch(e){ return 0; }
      }

      function getVisibleButtons(){
        return mainNavBtns.filter(b => b.style.display !== "none");
      }

      function layoutButtons(){
        if(!navArea || !heroInner) return;
        const visible = getVisibleButtons();
        if(!visible.length) return;

        // âœ…é—œéµé‡æ¸¬ï¼ˆä½ æŒ‡å®šåªé‡é€™äº›ï¼‰
        const rect = heroInner.getBoundingClientRect();
        const H = Math.max(1, rect.height);
        const W = Math.max(1, rect.width);

        const ub = userBar ? userBar.getBoundingClientRect() : null;
        const tw = titleWrap ? titleWrap.getBoundingClientRect() : null;
        const ax = zwTopAxis ? zwTopAxis.getBoundingClientRect() : null;
        const bl = zwBottomLine ? zwBottomLine.getBoundingClientRect() : null;

        const vvBottom = getVVBottomInset();

        const topBound = Math.max(
          86,
          ub ? (ub.bottom - rect.top) + 14 : 0,
          tw ? (tw.bottom - rect.top) + 14 : 0,
          ax ? (ax.bottom - rect.top) + 12 : 0
        );

        // âœ…åº•éƒ¨ç•Œç·šï¼šä»¥ã€Œåº•éƒ¨å­— topã€å„ªå…ˆï¼ˆé˜²æ’ï¼‰
        let bottomBound = H - (12 + vvBottom);
        if(bl){
          bottomBound = Math.min(bottomBound, (bl.top - rect.top) - 10);
        }
        bottomBound = Math.max(bottomBound, topBound + 120);

        const avail = Math.max(1, bottomBound - topBound);

        const isNarrow = window.matchMedia("(max-width: 900px)").matches || W < 980;

        // å…ˆæ¸…æ‰æ¡Œæ©Ÿå®šä½
        visible.forEach(btn=>{
          btn.style.left = "";
          btn.style.right = "";
          btn.style.top = "";
          btn.style.width = "";
          btn.style.height = "";
        });

        if(isNarrow){
          // âœ…æ‰‹æ©Ÿï¼šå…ˆå˜—è©¦å–®æ¬„ stackï¼Œä¸å¤ å†æ›é›™æ¬„ grid2
          navArea.classList.remove("sides");
          navArea.style.setProperty("--navTop", Math.round(topBound) + "px");
          navArea.style.setProperty("--navBottom", Math.round(H - bottomBound) + "px");

          const n = visible.length;

          // å–®æ¬„ä¼°ç®—
          const gapMin = 8, gapMax = 14;
          const btnMin = 52, btnMax = 88;

          function fitStack(){
            const gap = clamp(Math.round((avail / (n+1)) * 0.22), gapMin, gapMax);
            const h = clamp(Math.floor((avail - gap*(n-1)) / n), btnMin, btnMax);
            const need = n*h + gap*(n-1);
            const slack = Math.max(0, avail - need);

            // âœ…æ¨æŒ‰éµå€å¾€ä¸‹ï¼ˆä¸å‹•åº•éƒ¨å­—ï¼‰
            const push = Math.min(32, Math.round(slack * 0.22));

            navArea.style.setProperty("--btnGap", gap + "px");
            navArea.style.setProperty("--btnH", h + "px");

            // âœ…æŒ‰éµé¢ç©æ¯”ä¾‹ â†’ btnScale
            const scale = clamp((h / 82) * 0.98, 0.62, 1.02);
            navArea.style.setProperty("--btnScale", String(scale));

            navArea.style.setProperty("--navTop", Math.round(topBound + push) + "px");
            navArea.style.setProperty("--navBottom", Math.round(H - bottomBound) + "px");

            return (need <= avail);
          }

          const okStack = fitStack();

          // ä»å¯èƒ½å¤ªçŸ®ï¼šç”¨é›™æ¬„
          if(!okStack){
            navArea.classList.remove("stack");
            navArea.classList.add("grid2");

            // systemBtn æ”¾æœ€å¾Œï¼Œè®“å®ƒåƒæ»¿ä¸€åˆ—
            const sys = visible.find(b => b.id === "systemBtn") || null;
            if(sys){
              const others = visible.filter(b => b !== sys);
              // é‡æ–° appendï¼Œä¿æŒ DOM ç°¡å–®ï¼ˆåªåœ¨æ¥µç«¯æ™‚åšï¼‰
              others.forEach(b=>navArea.appendChild(b));
              navArea.appendChild(sys);
            }

            const n2 = getVisibleButtons().length;
            const hasSys = !!sys;
            const otherCount = hasSys ? (n2 - 1) : n2;
            const rows = (hasSys ? Math.ceil(otherCount / 2) + 1 : Math.ceil(n2 / 2));

            const gap = clamp(Math.round((avail / (rows+1)) * 0.24), 6, 12);
            const h = clamp(Math.floor((avail - gap*(rows-1)) / rows), 46, 84);

            const need = rows*h + gap*(rows-1);
            const slack = Math.max(0, avail - need);
            const push = Math.min(32, Math.round(slack * 0.22));

            navArea.style.setProperty("--btnGap", gap + "px");
            navArea.style.setProperty("--btnH", h + "px");
            navArea.style.setProperty("--btnScale", String(clamp((h / 78) * 0.98, 0.58, 1.02)));
            navArea.style.setProperty("--navTop", Math.round(topBound + push) + "px");
            navArea.style.setProperty("--navBottom", Math.round(H - bottomBound) + "px");
          }else{
            navArea.classList.remove("grid2");
            navArea.classList.add("stack");
          }

          return;
        }

        // âœ…æ¡Œæ©Ÿï¼šå·¦å³å´é‚Šï¼ˆå…¨éƒ¨åœ¨è¢å¹•å…§ï¼‰
        navArea.classList.remove("stack","grid2");
        navArea.classList.add("sides");

        const left = [];
        const right = [];
        visible.forEach((btn, i) => (i % 2 === 0 ? left : right).push(btn));

        // æ¡Œæ©Ÿå¯ç”¨é«˜åº¦ï¼šä»ç„¶é¿é–‹åº•éƒ¨å­—ï¼ˆbottomBoundï¼‰èˆ‡ä¸Šæ–¹åˆ—
        const topSafe = topBound;
        const bottomSafe = bottomBound;
        const availY = Math.max(1, bottomSafe - topSafe);

        // å¯¬åº¦ï¼šç•™ä¸­å¿ƒèµ°é“çµ¦ç¦ªå­—
        const centerGap = clamp(W * 0.16, 180, 260);
        const sideMaxW = Math.max(280, Math.floor((W - centerGap) / 2) - 40);
        const btnW = clamp(Math.floor(W * 0.26), 340, Math.min(560, sideMaxW));
        navArea.style.setProperty("--btnW", btnW + "px");

        // é«˜åº¦/é–“è·ï¼šè‡ªå‹•ç¸®æ”¾ä»¥å¡é€² availY
        const maxRows = Math.max(left.length, right.length);
        const gapBase = clamp(Math.round(H * 0.045), 16, 26);
        const hBase = clamp(Math.round(H * 0.118), 74, 112);

        const need = maxRows*hBase + Math.max(0, (maxRows-1)*gapBase);
        const s = clamp(availY / need, 0.66, 1.0);

        const gapY = Math.max(14, Math.round(gapBase * s));
        const btnH = Math.max(64, Math.round(hBase * s));

        navArea.style.setProperty("--btnGap", gapY + "px");
        navArea.style.setProperty("--btnH", btnH + "px");
        navArea.style.setProperty("--btnScale", String(clamp((btnH / 92) * 0.98, 0.62, 1.00)));

        const xPad = 28;
        const leftX = xPad;
        const rightX = Math.max(leftX + btnW + 12, W - xPad - btnW);

        function placeColumn(btns, isLeft){
          const rows = btns.length;
          if(!rows) return;

          const total = rows*btnH + Math.max(0, (rows-1)*gapY);
          const slack = Math.max(0, availY - total);
          const y0 = topSafe + Math.min(52, Math.round(slack * 0.22));

          let y = y0;
          for(const btn of btns){
            btn.style.top = Math.round(y) + "px";
            if(isLeft){
              btn.style.left = Math.round(leftX) + "px";
              btn.style.right = "";
            }else{
              btn.style.right = Math.round(W - (rightX + btnW)) + "px";
              btn.style.left = "";
            }
            y += btnH + gapY;
          }
        }

        placeColumn(left, true);
        placeColumn(right, false);
      }

      /* =========================
         Username pickerï¼ˆä¿ç•™ï¼‰
         ========================= */
      let _userActiveIndex = -1;
      let _typeBuf = "";
      let _typeTimer = 0;

      function menuItems(){ return Array.from(usernameMenu ? usernameMenu.querySelectorAll(".select-option") : []); }
      function isMenuOpen(){ return !!(usernameMenu && usernameMenu.classList.contains("open")); }
      function closeUsernameMenu(){
        if(!usernameMenu) return;
        usernameMenu.classList.remove("open");
        if(usernameDisplay) usernameDisplay.setAttribute("aria-expanded", "false");
        _userActiveIndex = -1;
        _typeBuf = "";
      }
      function openUsernameMenu(){
        if(!usernameMenu || !usernameDisplay) return;
        if(usernameDisplay.disabled) return;

        usernameMenu.classList.add("open");
        usernameDisplay.setAttribute("aria-expanded", "true");

        const items = menuItems();
        if(!items.length) return;

        const idx = items.findIndex(it => (it.dataset.value || "") === (usernameSel.value || ""));
        setActiveIndex(idx >= 0 ? idx : 0, true);
      }
      function toggleUsernameMenu(){ if(isMenuOpen()) closeUsernameMenu(); else openUsernameMenu(); }

      function syncUsernameDisplay(){
        if(!usernameSel || !usernameDisplay) return;
        const opt = usernameSel.options[usernameSel.selectedIndex];
        const txt = opt ? String(opt.textContent || "").trim() : "";
        if(!txt || (opt && opt.disabled)) usernameDisplay.textContent = "è«‹é¸æ“‡ä½¿ç”¨è€…";
        else usernameDisplay.textContent = txt;
      }

      function selectByValue(val){
        if(!val) return;
        usernameSel.value = val;
        syncUsernameDisplay();
        const items = menuItems();
        items.forEach(it => it.setAttribute("aria-selected", (it.dataset.value === val) ? "true" : "false"));
      }

      function setActiveIndex(nextIndex, scrollIntoView){
        const items = menuItems();
        if(!items.length) { _userActiveIndex = -1; return; }

        const n = items.length;
        let idx = nextIndex;
        if(idx < 0) idx = 0;
        if(idx >= n) idx = n - 1;

        _userActiveIndex = idx;
        items.forEach((it, i) => it.classList.toggle("active", i === idx));

        if(scrollIntoView){
          try{ items[idx].scrollIntoView({ block:"nearest" }); }catch(e){}
        }
      }

      function buildUsernameMenu(){
        if(!usernameMenu || !usernameSel || !usernameDisplay) return;
        usernameMenu.innerHTML = "";

        const opts = Array.from(usernameSel.options || []);
        const usable = opts.filter(o => !o.disabled && String(o.value||"").trim());

        if(!usable.length){
          usernameDisplay.textContent = "ï¼ˆå°šç„¡ä½¿ç”¨è€…ï¼Œè«‹å…ˆåˆ°ã€Œç³»çµ± / æ¬Šé™ã€æ–°å¢ï¼‰";
          usernameDisplay.disabled = true;
          closeUsernameMenu();
          return;
        }

        usernameDisplay.disabled = false;

        usable.forEach((o, i) => {
          const item = document.createElement("div");
          item.className = "select-option";
          item.setAttribute("role", "option");
          item.dataset.value = o.value;
          item.textContent = o.textContent;

          const selected = (o.value === usernameSel.value);
          item.setAttribute("aria-selected", selected ? "true" : "false");

          item.addEventListener("mouseenter", () => { if(isMenuOpen()) setActiveIndex(i, false); });
          item.addEventListener("click", () => {
            selectByValue(o.value);
            closeUsernameMenu();
            usernameDisplay.focus();
          });

          usernameMenu.appendChild(item);
        });
      }

      function refreshUsernamePicker(){
        if(!usernameSel) return;

        const opt = usernameSel.options[usernameSel.selectedIndex];
        if(opt && opt.disabled){
          const first = Array.from(usernameSel.options).find(o => !o.disabled && String(o.value||"").trim());
          if(first) usernameSel.value = first.value;
        }

        syncUsernameDisplay();
        buildUsernameMenu();
      }

      if(usernameDisplay){
        usernameDisplay.addEventListener("click", toggleUsernameMenu);

        usernameDisplay.addEventListener("keydown", (e) => {
          if(usernameDisplay.disabled) return;

          const key = e.key;

          if(key === "ArrowDown" || key === "ArrowUp"){
            e.preventDefault();
            if(!isMenuOpen()) openUsernameMenu();
            const items = menuItems();
            if(!items.length) return;

            const dir = (key === "ArrowDown") ? 1 : -1;
            const next = (_userActiveIndex < 0) ? 0 : (_userActiveIndex + dir);
            setActiveIndex(next, true);
            return;
          }

          if(key === "Enter"){
            e.preventDefault();
            if(!isMenuOpen()){ openUsernameMenu(); return; }
            const items = menuItems();
            if(!items.length) return;

            const idx = (_userActiveIndex >= 0) ? _userActiveIndex : 0;
            const val = items[idx]?.dataset?.value || "";
            if(val) selectByValue(val);
            closeUsernameMenu();
            return;
          }

          if(key === "Escape"){ e.preventDefault(); closeUsernameMenu(); return; }

          if(key && key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey){
            if(!isMenuOpen()) openUsernameMenu();
            _typeBuf += key.toLowerCase();
            clearTimeout(_typeTimer);
            _typeTimer = setTimeout(()=>{ _typeBuf=""; }, 650);

            const items = menuItems();
            const idx = items.findIndex(it => String(it.textContent||"").trim().toLowerCase().startsWith(_typeBuf));
            if(idx >= 0) setActiveIndex(idx, true);
          }
        });
      }

      document.addEventListener("click", (e) => {
        if(!usernameWrap || !usernameMenu) return;
        if(isMenuOpen() && !usernameWrap.contains(e.target)) closeUsernameMenu();
      });
      document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeUsernameMenu(); });

      function populateUserSelect(){
        AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
        usernameSel.innerHTML = "";

        if(!AUTH_TABLE.length){
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "ï¼ˆå°šç„¡ä½¿ç”¨è€…ï¼Œè«‹å…ˆåˆ°ã€Œç³»çµ± / æ¬Šé™ã€æ–°å¢ï¼‰";
          opt.disabled = true;
          opt.selected = true;
          usernameSel.appendChild(opt);
          refreshUsernamePicker();
          return;
        }

        const ph = document.createElement("option");
        ph.value = "";
        ph.textContent = "è«‹é¸æ“‡ä½¿ç”¨è€…";
        ph.disabled = true;
        ph.selected = true;
        usernameSel.appendChild(ph);

        const names = Array.from(new Set(AUTH_TABLE.map(r => r.username).filter(Boolean)));
        names.sort((a,b)=>a.localeCompare(b, "zh-Hant"));
        names.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          usernameSel.appendChild(opt);
        });

        refreshUsernamePicker();
      }

      function showLogin(){
        document.body.classList.add("locked");
        loginOverlay.style.display = "flex";
        loginError.textContent = "";
        loginSub.textContent = "";
        $("#password").value = "";

        populateUserSelect();
        resetButtonsForLogout();

        userInfo.textContent = "ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥";
        userInfo.setAttribute("data-text", "ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥");

        autoEnterIfSessionValid();
        scheduleAll();

        setTimeout(() => { try{ usernameDisplay && usernameDisplay.focus(); }catch(e){} }, 0);
      }

      function autoEnterIfSessionValid(){
        const sess = getSession();
        if(!sess) return;

        const u = AUTH_TABLE.find(r => r.username === sess.user);
        if(!u){ clearSession(); return; }
        if(String(u.level||"").toLowerCase() !== String(sess.role||"").toLowerCase()){
          clearSession(); return;
        }

        loginSub.textContent = `å·²ç™»å…¥ï¼š${u.username}ï¼ˆ${u.level}ï¼‰â€¦ æ­£åœ¨é€²å…¥`;
        setTimeout(() => {
          if(!getSession()) return;
          applyUser(u);
        }, 150);
      }

      function applyUser(user){
        document.body.classList.remove("locked");
        loginOverlay.style.display = "none";
        loginSub.textContent = "";

        setSession(user);
        localStorage.setItem(CURRENT_KEY, JSON.stringify({ user: user.username, role: user.level }));

        CURRENT_USER = user;

        const t = `ç›®å‰ä½¿ç”¨è€…ï¼š${user.username} (${user.level})`;
        userInfo.textContent = t;
        userInfo.setAttribute("data-text", t);

        refreshButtonsForCurrentUser();
        scheduleExport("login:applyUser");

        // âœ…ç™»å…¥å¾Œæ›é›²ç«¯ï¼ˆreadOnly ä¾è§’è‰²ï¼‰
        ensureCloudMounted(user).catch(()=>{});

        scheduleAll();
      }

      /* =========================
         âœ…æ””æˆª localStorage å¯«å…¥ï¼šè‡ªå‹•å‚™ä»½ + è‡ªå‹•é›²ç«¯åˆä½µå¯«å…¥
         ========================= */
      (function patchLocalStorageOnce(){
        try{
          if(localStorage.__tasun_patched__) return;
          Object.defineProperty(localStorage, "__tasun_patched__", { value: true, enumerable:false });

          const _set = localStorage.setItem.bind(localStorage);
          const _remove = localStorage.removeItem.bind(localStorage);

          localStorage.setItem = function(k, v){
            _set(k, v);
            scheduleExport("save:setItem:" + k);

            if(CLOUD_KEY_SET.has(String(k))){
              const ro = !!(cloudCtrl && cloudCtrl.__readOnly__);
              scheduleCloudSave(ro);
            }
          };
          localStorage.removeItem = function(k){
            _remove(k);
            scheduleExport("save:removeItem:" + k);

            if(CLOUD_KEY_SET.has(String(k))){
              const ro = !!(cloudCtrl && cloudCtrl.__readOnly__);
              scheduleCloudSave(ro);
            }
          };
        }catch(e){}
      })();

      /* =========================
         âœ…å•Ÿå‹•
         ========================= */
      const scheduleLayout = rafDebounce(layoutButtons);
      function scheduleAll(){ scheduleLayout(); }

      AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
      buildMainButtonsDOM();

      // âœ…æœªç™»å…¥ä¹Ÿå…ˆ pull é›²ç«¯ï¼ˆreadOnlyï¼‰
      ensureCloudMounted(null).catch(()=>{});

      showLogin();

      if(zenImg){
        zenImg.addEventListener("load", () => { scheduleAll(); }, { once:false });
      }

      requestAnimationFrame(() => {
        document.body.classList.remove("booting");
        scheduleAll();
        onFontsReady(() => scheduleAll());
      });

      /* ===== login events ===== */
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = usernameSel.value;
        const password = $("#password").value;

        if(!username){ loginError.textContent = "è«‹å…ˆé¸æ“‡ä½¿ç”¨è€…åç¨±ã€‚"; return; }
        const user = AUTH_TABLE.find(row => row.username === username && row.password === password);
        if(!user){ loginError.textContent = "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚"; return; }

        loginError.textContent = "";
        applyUser(user);
        $("#password").value = "";
      });

      btnForceRelogin.addEventListener("click", () => {
        clearSession();
        loginSub.textContent = "è«‹é‡æ–°è¼¸å…¥å¯†ç¢¼ç™»å…¥";
        loginError.textContent = "";
        const pwd = $("#password");
        pwd.value = "";
        pwd.focus();
        scheduleAll();
      });

      btnSwitch.addEventListener("click", () => {
        clearSession();
        localStorage.removeItem(CURRENT_KEY);
        CURRENT_USER = null;
        showLogin();
        scheduleExport("switchUser");
        scheduleAll();
      });

      btnTogglePwd.addEventListener("click", () => {
        const pwd = $("#password");
        pwd.type = (pwd.type === "password") ? "text" : "password";
      });

      btnExport.addEventListener("click", () => {
        exportBackupNow("manual:button", { download:true });
      });

      // âœ…é¿å… resize é€£çºŒé‡æ’å¡é “ï¼šåªæ’ç¨‹ rAF
      window.addEventListener("resize", () => scheduleAll(), { passive:true });
      if(window.visualViewport){
        window.visualViewport.addEventListener("resize", () => scheduleAll(), { passive:true });
        // scroll åªåšæ’ç¨‹ï¼Œä¸åšé‡åº¦è¨ˆç®—
        let _vvTick = 0;
        window.visualViewport.addEventListener("scroll", () => {
          const now = (performance && performance.now) ? performance.now() : Date.now();
          if(now - _vvTick < 140) return;
          _vvTick = now;
          scheduleAll();
        }, { passive:true });
      }
    }

    if(window.TasunLoader && typeof window.TasunLoader.ready === "function"){
      window.TasunLoader.ready(runIndexApp, 8000);
    }else if(window.TasunCore && typeof window.TasunCore.ready === "function"){
      window.TasunCore.ready(runIndexApp, 8000);
    }else{
      setTimeout(runIndexApp, 0);
    }
  })();
  </script>
</body>
</html>
