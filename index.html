<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun 資料首頁 · 空無明</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <link rel="icon" href="data:,">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- ✅ 全站版本：要與 tasun-version.json 一致 -->
  <script>window.TASUN_APP_VER="20260127_05";</script>

  <!-- ✅ 進站必鎖定最新版 ?v=APP_VER（避免不同電腦顯示不同版本） -->
  <script>
  (function(){
    try{
      var APP = (window.TASUN_APP_VER||"").toString().trim();
      if(!APP) return;
      var u = new URL(location.href);
      var cur = (u.searchParams.get("v")||"").toString().trim();
      var KEY = "tasun_force_v_once__index__" + (cur||"none") + "_to_" + APP;
      if(cur !== APP && !sessionStorage.getItem(KEY)){
        sessionStorage.setItem(KEY, "1");
        u.searchParams.set("v", APP);
        location.replace(u.toString());
        return;
      }
    }catch(e){}
  })();
  </script>

  <!-- ✅ 先 core → 再 boot（都帶 v=APP_VER） -->
  <script>
  (function(){
    var APP = (window.TASUN_APP_VER||"").toString().trim();
    function addScript(src){
      return new Promise(function(resolve){
        var s=document.createElement("script");
        s.src = src + (src.indexOf("?")>=0 ? "&" : "?") + "v=" + encodeURIComponent(APP);
        s.async = false;
        s.onload = function(){ resolve(true); };
        s.onerror= function(){ resolve(false); };
        document.head.appendChild(s);
      });
    }
    window.__TASUN_READY__ = (async function(){
      await addScript("tasun-core.js");
      await addScript("tasun-boot.js");
      return true;
    })();
  })();
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800;900&family=Noto+Serif+TC:wght@400;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#070809;
      --bg1:#0b0d10;

      --goldHi: rgba(255,254,246,.98);
      --goldText: rgba(246,214,150,.98);
      --goldDeep: rgba(210,140,36,.98);

      --edge: rgba(25,16,8,.78);
      --edgeSoft: rgba(25,16,8,.42);

      --glass1: rgba(255,255,255,.12);
      --glass2: rgba(255,255,255,.06);
      --border: rgba(246,214,150,.28);

      --r: 20px;
      --shadow: 0 26px 90px rgba(0,0,0,.45);
      --shadow2: 0 14px 40px rgba(0,0,0,.32);

      --titleSize: clamp(26px, 2.6vw, 44px);
      --subSize:   clamp(12px, 1.05vw, 16px);
      --btnSize:   clamp(13.5px, 1.05vw, 16px);

      /* ✅ stack2 斷點：桌機窄版到 1024 仍維持左右雙欄；只有更小手機才單欄 */
      --stack1BP: 560px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color: rgba(240,230,210,.96);
      font-family:"Noto Sans TC", system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      background:
        radial-gradient(1100px 760px at 50% 34%, rgba(246,214,150,.08), transparent 62%),
        radial-gradient(1000px 720px at 18% 26%, rgba(255,255,255,.06), transparent 62%),
        radial-gradient(1000px 720px at 82% 26%, rgba(255,255,255,.05), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
    }

    .crystalText{
      color:transparent;
      background: linear-gradient(180deg,
        var(--goldHi) 0%,
        rgba(255,246,224,.98) 18%,
        var(--goldText) 46%,
        rgba(226,156,54,.98) 78%,
        var(--goldHi) 100%);
      -webkit-background-clip:text;
      background-clip:text;
      -webkit-text-fill-color:transparent;
      -webkit-text-stroke: .34px rgba(255,230,180,.26);
      text-shadow:
        0.5px 0 0 var(--edge),
        -0.5px 0 0 var(--edge),
        0 0.5px 0 var(--edge),
        0 -0.5px 0 var(--edge),
        0 2px 10px rgba(0,0,0,.55),
        0 0 18px rgba(255,220,150,.10);
      filter: drop-shadow(0 1px 0 rgba(255,255,255,.05));
    }

    .wrap{
      height:100vh;
      padding: 18px 16px 18px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 14px;
      border-radius: var(--r);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .uinfo{
      display:flex; flex-wrap:wrap;
      align-items:center; gap:10px;
      min-width: 220px;
    }
    .pill{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(246,214,150,.22);
      background: rgba(255,255,255,.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
      font-size: 14px;
      color: rgba(240,230,210,.90);
      letter-spacing:.04em;
      white-space:nowrap;
    }
    .pill b{ font-weight:800; }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:center;
      justify-content:center;
      text-align:center;
      min-width: 240px;
      flex: 1 1 auto;
    }
    .title{
      font-family:"Noto Serif TC","Noto Sans TC",serif;
      font-size: var(--titleSize);
      letter-spacing:.14em;
      font-weight: 900;
      line-height:1.12;
    }
    .sub{
      font-size: var(--subSize);
      letter-spacing:.14em;
      color: rgba(240,230,210,.72);
    }

    .btn{
      appearance:none;
      border:1px solid rgba(246,214,150,.26);
      background:
        radial-gradient(130% 240% at 22% 14%, rgba(255,255,255,.18), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      padding: 12px 16px;
      border-radius: 999px;
      cursor:pointer;
      font-family:inherit;
      font-size: var(--btnSize);
      letter-spacing:.08em;
      user-select:none;
      box-shadow: 0 14px 32px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.10);
      transition: transform .12s ease, filter .12s ease, border-color .12s ease;
      color: rgba(246,214,150,.98);
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); border-color: rgba(246,214,150,.46); }
    .btn:active{ transform:none; filter: brightness(.99); }

    .stage{
      flex: 1;
      min-height: 0;
      border-radius: calc(var(--r) + 6px);
      border: 1px solid rgba(246,214,150,.20);
      background:
        radial-gradient(1200px 820px at 50% 36%, rgba(255,255,255,.06), transparent 64%),
        radial-gradient(900px 660px at 50% 62%, rgba(246,214,150,.06), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    /* ✅ 主舞台：左右按鍵永遠在兩側，不會壓到中心蓮花/禪字 */
    .grid{
      height:100%;
      display:grid;
      grid-template-columns: minmax(220px, 1fr) minmax(320px, 620px) minmax(220px, 1fr);
      gap: 14px;
      padding: 16px;
      align-items:stretch;
    }

    /* ✅ 只有手機極窄才變單欄（<=560） */
    @media (max-width: 560px){
      .grid{
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }
    }

    /* ✅ 桌機窄版 <=1024 仍是左右雙欄（stack2）— 只是縮 side 寬度 */
    @media (max-width: 1024px){
      .grid{
        grid-template-columns: minmax(200px, 1fr) minmax(300px, 520px) minmax(200px, 1fr);
      }
    }

    .col{
      min-height:0;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .side{
      padding-top: clamp(80px, 10vh, 140px);
      padding-bottom: 14px;
      overflow:auto;
    }

    .center{
      align-items:center;
      justify-content:flex-start;
      text-align:center;
      position:relative;
      overflow:hidden;
    }

    .zen{
      margin-top: clamp(14px, 2vh, 22px);
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(246,214,150,.16);
      background: rgba(0,0,0,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      color: rgba(240,230,210,.84);
      letter-spacing:.12em;
      font-size: clamp(12px, 1.2vw, 15px);
      max-width: 92%;
    }

    .lotus{
      margin-top: clamp(16px, 5vh, 34px);
      width: min(520px, 92%);
      aspect-ratio: 1 / 1;
      border-radius: 999px;
      position:relative;
      overflow:hidden;
      border: 1px solid rgba(246,214,150,.16);
      background:
        radial-gradient(circle at 50% 45%, rgba(246,214,150,.20), transparent 55%),
        radial-gradient(circle at 50% 65%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(circle at 50% 50%, rgba(0,0,0,.22), rgba(0,0,0,.65));
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
    }
    /* 若你有蓮花主圖，直接把 lotus.png 換成你的檔名即可 */
    .lotus::before{
      content:"";
      position:absolute; inset:-2px;
      background: url("lotus.png") center/contain no-repeat;
      opacity: .92;
      filter: drop-shadow(0 12px 24px rgba(0,0,0,.45));
      pointer-events:none;
    }
    .lotus::after{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.14), transparent 62%);
      transform: rotate(12deg);
      opacity:.35;
      pointer-events:none;
    }

    .navBtn{
      width:100%;
      text-align:center;
      padding: 14px 16px;
      border-radius: 999px;
      border: 1px solid rgba(246,214,150,.26);
      background:
        radial-gradient(140% 240% at 20% 12%, rgba(255,255,255,.16), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: 0 14px 34px rgba(0,0,0,.32), inset 0 1px 0 rgba(255,255,255,.10);
      cursor:pointer;
      color: rgba(246,214,150,.98);
      font-weight: 800;
      letter-spacing:.12em;
      font-size: var(--btnSize);
      user-select:none;
      transition: transform .12s ease, filter .12s ease, border-color .12s ease;
    }
    .navBtn:hover{ transform: translateY(-1px); filter: brightness(1.06); border-color: rgba(246,214,150,.46); }
    .navBtn:active{ transform:none; filter: brightness(.99); }
    .navBtn[disabled]{ opacity:.45; cursor:not-allowed; transform:none !important; filter:none !important; }

    /* Login Mask（DOM 保留；登入邏輯由 tasun-core.js 接管） */
    .loginMask{
      position:fixed; inset:0;
      background: radial-gradient(900px 560px at 50% 42%, rgba(0,0,0,.46), rgba(0,0,0,.78));
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:999;
    }
    .loginMask.show{display:flex;}
    .loginModal{
      width:min(520px, 96vw);
      border-radius:22px;
      border:1px solid rgba(246,214,150,.28);
      background: linear-gradient(180deg, rgba(14,18,16,.94), rgba(10,14,13,.88));
      box-shadow:0 30px 90px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    .loginHead{
      padding:14px 16px;
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      border-bottom:1px solid rgba(246,214,150,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      min-height:56px;
    }
    .loginTitle{
      grid-column:2;
      justify-self:center;
      font-family:"Noto Serif TC","Noto Sans TC",serif;
      font-size: clamp(18px, 1.7vw, 24px);
      letter-spacing:.14em;
      font-weight: 900;
    }
    .loginBody{padding:14px 16px 10px;}
    .loginFoot{
      padding:12px 16px;
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
      border-top:1px solid rgba(246,214,150,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.05));
    }
    label{display:block; margin:10px 0 6px; color:rgba(246,214,150,.90); letter-spacing:.10em;}
    select,input{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(246,214,150,.22);
      background: rgba(0,0,0,.35);
      color: rgba(246,214,150,.98);
      padding:12px 12px;
      font-size: 15px;
      outline:none;
    }
    .err{display:none; margin-top:10px; color:rgba(255,150,150,.95); font-weight:800; text-align:center;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="uinfo">
        <div class="pill">使用者：<b id="uName">—</b></div>
        <div class="pill">權限：<b id="uRole">—</b></div>
      </div>

      <div class="brand">
        <div class="title crystalText">Tasun 資料</div>
        <div class="sub">空無明 · 入口</div>
      </div>

      <div style="display:flex; gap:10px; align-items:center;">
        <button class="btn" id="btnSwitch" type="button">切換帳號</button>
      </div>
    </div>

    <div class="stage">
      <div class="grid">
        <!-- Left -->
        <div class="col side" id="colL">
          <button class="navBtn" data-href="汐東工程管理表.html" data-roles="read,write,admin">汐東工程管理表</button>
          <button class="navBtn" data-href="捷運汐東線事項記錄.html" data-roles="read,write,admin">捷運汐東線事項記錄</button>
          <button class="navBtn" data-href="捷運汐止東湖線統包工程-資料庫.html" data-roles="read,write,admin">汐止東湖線 · 資料庫</button>
        </div>

        <!-- Center -->
        <div class="col center">
          <div class="zen">按鍵固定左右兩側，不壓到蓮花與禪字；桌機窄版到 1024 仍維持左右雙欄。</div>
          <div class="lotus" aria-label="Lotus"></div>
        </div>

        <!-- Right -->
        <div class="col side" id="colR">
          <button class="navBtn" data-href="工程資料庫.html" data-roles="read,write,admin">工程資料庫</button>
          <button class="navBtn" data-href="臻鼎管理表.html" data-roles="read,write,admin">臻鼎管理表</button>
          <button class="navBtn" data-href="權限表.html" data-roles="admin">權限表（Admin）</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal（由 tasun-core.js 接管） -->
  <div class="loginMask" id="loginMask" aria-hidden="true">
    <div class="loginModal" role="dialog" aria-modal="true" aria-label="登入">
      <div class="loginHead">
        <div></div>
        <div class="loginTitle crystalText">登入</div>
        <div style="justify-self:end;">
          <button class="btn" id="loginClose" type="button">關閉</button>
        </div>
      </div>
      <div class="loginBody">
        <label>帳號</label>
        <select id="loginUser" autocomplete="username">
          <option value="">請選擇帳號</option>
        </select>

        <label>密碼</label>
        <input id="loginPass" type="password" autocomplete="current-password" placeholder="請輸入密碼" />

        <div class="err" id="loginErr"></div>
      </div>
      <div class="loginFoot">
        <button class="btn" id="loginToAuth" type="button">前往權限表</button>
        <button class="btn" id="loginBtn" type="button">登入</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    "use strict";

    function run(){
      var Core = window.TasunCore;
      if(!Core || !Core.Auth){
        console.error("TasunCore/Auth not ready.");
        return;
      }

      Core.init({
        pageKey: "index",
        forceUrlV: true,
        forceVersionSync: true,
        patchResources: true,
        networkToast: false,
        appHeightVar: false
      });

      var Auth = Core.Auth;
      var withV = Core.withV;

      function go(href){ location.href = withV(href); }

      function applyRole(){
        var role = Auth.role();
        document.querySelectorAll(".navBtn[data-roles]").forEach(function(btn){
          var roles = (btn.getAttribute("data-roles")||"").split(",").map(function(s){ return s.trim(); }).filter(Boolean);
          btn.style.display = roles.includes(role) ? "block" : "none";
        });
        var u = Auth.current();
        document.getElementById("uName").textContent = (u && u.username) ? u.username : "—";
        document.getElementById("uRole").textContent = role || "—";
      }

      document.addEventListener("click", function(e){
        var b = e.target.closest(".navBtn[data-href]");
        if(!b) return;
        var href = b.getAttribute("data-href");
        if(href) go(href);
      });

      document.getElementById("btnSwitch").onclick = function(){
        // 交給 core：如果已登入，通常會讓你切換；若未登入會跳登入
        Auth.ensureLoggedIn();
      };

      document.getElementById("loginToAuth").onclick = function(){ go("權限表.html"); };

      Auth.init({
        onAuthed: function(){ applyRole(); },
        onSessionChange: function(){ applyRole(); },
        onForceRelogin: function(msg){
          applyRole();
        }
      });

      // 首次進站
      Auth.ensureLoggedIn();
      applyRole();
    }

    (window.__TASUN_READY__ || Promise.resolve(true)).then(run);
  })();
  </script>
</body>
</html>
