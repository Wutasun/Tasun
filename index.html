<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun è³‡æ–™é¦–é  Â· ç©ºç„¡æ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ä¸­æ–‡ç¶²é å­—å‹ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --gold: #f6d37a;
    --gold-soft: rgba(246, 211, 122, 0.75);
    --panel-border: rgba(246, 211, 122, 0.35);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    min-height: 100vh;
    font-family: "Noto Serif TC","æ¨™æ¥·é«”","Microsoft JhengHei",serif;
    background: #050302;
    color: var(--gold);
    overflow-x: hidden;
  }
  body.locked { overflow: hidden; }

  /* ========================== ç™»å…¥é®ç½© ========================== */
  .login-overlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at 50% 18%, rgba(255, 228, 170, 0.35), rgba(0, 0, 0, 0.98));
    display: flex; align-items: center; justify-content: center;
    z-index: 999;
  }
  .login-box {
    width: min(380px, 90vw);
    padding: 2.4rem 2.6rem 2.2rem;
    border-radius: 18px;
    background: radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.28), rgba(0, 0, 0, 0.94));
    border: 1px solid var(--panel-border);
    box-shadow: 0 0 24px rgba(0,0,0,0.9), 0 0 32px rgba(246,211,122,0.25);
    color: var(--gold-soft);
  }
  .login-title {
    text-align: center;
    font-size: 1.4rem;
    letter-spacing: 0.2em;
    margin-bottom: 1.6rem;
    text-shadow:
      0 0 8px rgba(246,211,122,0.8),
      0 0 18px rgba(246,211,122,0.5);
  }
  .login-field { margin-bottom: 1rem; }
  .login-field label {
    display: block; font-size: 0.85rem;
    letter-spacing: 0.18em; margin-bottom: 0.3rem; color: var(--gold-soft);
  }
  .login-field input, .login-field select {
    width: 100%; padding: 0.55rem 0.7rem;
    border-radius: 999px;
    border: 1px solid rgba(246,211,122,0.5);
    background: rgba(0,0,0,0.8);
    color: var(--gold);
  }
  .login-field input:focus, .login-field select:focus {
    border-color: rgba(255,238,190,0.9);
    box-shadow: 0 0 12px rgba(246,211,122,0.7);
  }
  .login-pwd-wrapper { display: flex; align-items: center; gap: 0.45rem; }
  .btn-eye-login {
    padding: 0.25rem 0.7rem; border-radius: 999px;
    border: 1px solid rgba(246,211,122,0.8); background: rgba(0,0,0,0.85);
    color: var(--gold); cursor: pointer;
  }
  .btn-login {
    padding: 0.55rem 2.8rem; border-radius: 999px;
    border: 1px solid rgba(246,211,122,0.9);
    background: radial-gradient(circle at 0% 0%, rgba(246,211,122,0.36), rgba(0,0,0,0.98));
    color: var(--gold); cursor: pointer;
    letter-spacing: 0.22em;
  }
  .login-error { min-height: 1.1rem; color: #ffb3b3; text-align: center; }

  /* ========================== ä¸»è¦–è¦º ========================== */
  .hero {
    position: relative; min-height: 100vh;
    display: flex; align-items: center; justify-content: center;
    overflow: hidden; color: var(--gold);
  }
  .hero::before {
    content: ""; position: absolute; inset: 0;
    background:
      radial-gradient(circle at 50% 12%, rgba(255,237,180,0.85), transparent 60%),
      url("é¦–é åœ–ç‰‡.png") center 72% / auto 105% no-repeat;
    z-index: -2;
  }
  .hero::after {
    content: ""; position: absolute; inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.88), rgba(0,0,0,0.55));
    z-index: -1;
  }
  .hero-inner { width: 100vw; height: 100vh; position: relative; }

  /* ========================== æŒ‰éˆ• ========================== */
  .nav-area { position: absolute; inset: 0; }
  .nav-btn {
    position: absolute;
    padding: 1.05rem 2.9rem;
    border-radius: 999px;
    border: 1px solid rgba(246,211,122,0.9);
    background: radial-gradient(circle at 0% 0%, rgba(246,211,122,0.34), rgba(0,0,0,0.9));
    color: var(--gold); white-space: nowrap;
    display: flex; justify-content: center; align-items: center;
    backdrop-filter: blur(16px);
    cursor: pointer;
  }
  .nav-left  { left: 16%; }
  .nav-right { right: 16%; }
  .top    { top: 30%; }
  .middle { top: 50%; }
  .bottom { top: 70%; }

  /* ========================== RWD ========================== */
  @media (max-width: 900px) {
    .nav-area {
      position: static;
      display: flex; flex-wrap: wrap;
      justify-content: center; gap: 0.9rem;
      margin-top: min(58vh, 420px);
    }
    .nav-btn {
      position: relative;
      flex: 0 1 calc(50% - 0.9rem);
      padding: 0.9rem 1rem;
      font-size: clamp(0.9rem, 1.8vw, 1.2rem);
    }
  }
</style>
</head>

<body class="locked">

<!-- ========================== ç™»å…¥å€ ========================== -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-box">
    <div class="login-title">Tasun è³‡æ–™ Â· ç™»å…¥</div>

    <form id="loginForm">
      <div class="login-field">
        <label for="username">ä½¿ç”¨è€…åç¨±</label>
        <select id="username"></select>
      </div>

      <div class="login-field">
        <label for="password">å¯†ç¢¼</label>
        <div class="login-pwd-wrapper">
          <input id="password" type="password" />
          <button type="button" class="btn-eye-login" id="btnTogglePwd">ğŸ‘</button>
        </div>
      </div>

      <div class="login-error" id="loginError"></div>

      <div class="login-actions">
        <button type="submit" class="btn-login">ç™»å…¥</button>
      </div>
    </form>
  </div>
</div>

<!-- ========================== ä¸»ç•«é¢ ========================== -->
<main class="hero">
  <div class="hero-inner">

    <!-- ä½¿ç”¨è€…åˆ— -->
    <div class="user-bar">
      <div class="user-pill" id="userInfo">ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥</div>
      <button class="btn-switch" id="btnSwitchUser">åˆ‡æ›å¸³è™Ÿ</button>
    </div>

    <!-- æŒ‰éˆ•å€ï¼ˆå« button-id é˜²å‘†ï¼‰ -->
    <div class="nav-area">

      <a class="nav-btn nav-left" data-side="left" data-button-id="btn1"
         href="è‡»é¼ç®¡ç†è¡¨.html" data-roles="admin,write,read">
        <span>è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨</span>
      </a>

      <a class="nav-btn nav-left" data-side="left" data-button-id="btn2"
         href="ç”„é¼quality.html" data-roles="admin,write,read">
        <span>ç¼ºå¤± / å“è³ª</span>
      </a>

      <a class="nav-btn nav-left" data-side="left" data-button-id="btn3"
         href="https://www.dropbox.com" target="_blank"
         data-roles="admin,write,read">
        <span>é›²ç«¯æª”æ¡ˆ</span>
      </a>

      <a class="nav-btn nav-right" data-side="right" data-button-id="btn4"
         href="å·¥ç¨‹è³‡æ–™åº«.html" data-roles="admin,write,read">
        <span>å·¥ç¨‹è³‡æ–™åº«</span>
      </a>

      <a class="nav-btn nav-right" data-side="right" data-button-id="btn5"
         href="è³‡æ–™åº«.html" data-roles="admin,write,read">
        <span>è³‡æ–™åº«</span>
      </a>

      <a class="nav-btn nav-right" data-side="right" data-button-id="system"
         href="æ¬Šé™è¡¨.html" data-roles="admin">
        <span>ç³»çµ± / æ¬Šé™</span>
      </a>

    </div>
  </div>
</main>

<!-- ========================== JavaScriptï¼ˆé˜²å‘†ç‰ˆï¼‰ ========================== -->
<script>
const AUTH_KEY      = "tasunAuthTable_v1";
const CURRENT_KEY   = "tasunCurrentUser_v1";
const BTN_LABEL_KEY = "tasunButtonLabels_v1";

const loginOverlay = document.getElementById("loginOverlay");
const loginForm    = document.getElementById("loginForm");
const loginError   = document.getElementById("loginError");
const userInfo     = document.getElementById("userInfo");
const btnSwitch    = document.getElementById("btnSwitchUser");
const btnTogglePwd = document.getElementById("btnTogglePwd");

const allNavBtns = Array.from(document.querySelectorAll(".nav-btn"));

const buttonMap = {};
allNavBtns.forEach(btn => {
  const id = btn.dataset.buttonId;
  if (id) buttonMap[id] = btn;
});

const systemButton = buttonMap["system"];
const userButtons =
  Object.keys(buttonMap)
        .filter(id => id !== "system")
        .sort()
        .map(id => buttonMap[id]);

function normalizeButtonText(t){ return (t||"").trim(); }

function loadButtonLabels() {
  const defaults = userButtons.map(btn => normalizeButtonText(btn.innerText));
  const raw = localStorage.getItem(BTN_LABEL_KEY);
  if (!raw) return defaults;

  try {
    const arr = JSON.parse(raw);
    if (Array.isArray(arr)) return arr.map((v,i)=>v||defaults[i]);
  } catch(e){}
  return defaults;
}
const buttonLabels = loadButtonLabels();

function applyButtonLabels(labels){
  labels.forEach((label,i)=>{
    if(userButtons[i])
      userButtons[i].querySelector("span").textContent = label;
  });
}

function getDefaultAuthTable(){
  return [
    {username:"alex",  password:"Tasun08040224", level:"admin", buttons:[true,true,true,true,true]},
    {username:"tasun", password:"tasun08040224", level:"write", buttons:[true,true,true,true,true]},
    {username:"wu",    password:"123456",        level:"read",  buttons:[false,false,false,false,true]}
  ];
}
function loadAuthTable(){
  const raw = localStorage.getItem(AUTH_KEY);
  if(!raw){
    const d = getDefaultAuthTable();
    localStorage.setItem(AUTH_KEY, JSON.stringify(d));
    return d;
  }
  try{
    const arr = JSON.parse(raw);
    if(Array.isArray(arr)) return arr;
  }catch(e){}
  const d = getDefaultAuthTable();
  localStorage.setItem(AUTH_KEY, JSON.stringify(d));
  return d;
}
const AUTH_TABLE = loadAuthTable();

function roleAllowed(btn, level){
  const roles = (btn.dataset.roles||"").split(",").map(v=>v.trim());
  return roles.includes(level);
}

function layoutDesktopButtons(){
  const visible = userButtons.filter(btn=>btn.style.display!=="none");
  const left  = visible.filter(b=>b.dataset.side==="left");
  const right = visible.filter(b=>b.dataset.side==="right");

  function setVert(btns){
    btns.forEach(b=>b.classList.remove("top","middle","bottom"));
    if(btns.length===1){
      btns[0].classList.add("middle");
    } else if(btns.length===2){
      btns[0].classList.add("top");
      btns[1].classList.add("bottom");
    } else if(btns.length>=3){
      btns[0].classList.add("top");
      btns[1].classList.add("middle");
      btns[2].classList.add("bottom");
    }
  }
  setVert(left); setVert(right);
}

function applyUser(user,labels){
  loginOverlay.style.display = "none";
  document.body.classList.remove("locked");
  userInfo.textContent = `ç›®å‰ä½¿ç”¨è€…ï¼š${user.username} (${user.level})`;

  if(labels) applyButtonLabels(labels);

  allNavBtns.forEach(btn=>btn.style.display="none");

  userButtons.forEach((btn,i)=>{
    if(user.buttons[i] && roleAllowed(btn,user.level)){
      btn.style.display="flex";
    }
  });

  if(systemButton)
    systemButton.style.display = user.level==="admin" ? "flex" : "none";

  layoutDesktopButtons();
}

function findUser(u,p){
  return AUTH_TABLE.find(x=>x.username===u && x.password===p);
}

function populateUserSelect(){
  const sel = document.getElementById("username");
  sel.innerHTML="";
  AUTH_TABLE.forEach(r=>{
    const o=document.createElement("option");
    o.value=r.username;
    o.textContent=r.username;
    sel.appendChild(o);
  });
}
populateUserSelect();

loginForm.addEventListener("submit",e=>{
  e.preventDefault();
  const u=document.getElementById("username").value.trim();
  const p=document.getElementById("password").value;
  const user=findUser(u,p);
  if(!user){
    loginError.textContent="å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
    return;
  }
  loginError.textContent="";
  localStorage.setItem(CURRENT_KEY, JSON.stringify({username:user.username,level:user.level}));
  applyUser(user,buttonLabels);
});

btnSwitch.addEventListener("click",()=>{
  localStorage.removeItem(CURRENT_KEY);
  document.body.classList.add("locked");
  loginOverlay.style.display="flex";
  loginError.textContent="";
  loginForm.reset();
  populateUserSelect();
  allNavBtns.forEach(btn=>btn.style.display="none");
  userInfo.textContent="ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥";
});

btnTogglePwd.addEventListener("click",()=>{
  const pwd=document.getElementById("password");
  pwd.type = pwd.type==="password" ? "text" : "password";
});

(function init(){
  allNavBtns.forEach(btn=>btn.style.display="none");
})();
</script>

</body>
</html>
