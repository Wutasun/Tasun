<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Tasun è³‡æ–™é¦–é  Â· ç©ºç„¡æ˜</title>
  <link rel="icon" href="data:,">
  <meta name="color-scheme" content="dark light">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- âœ…ï¼ˆæ•ˆèƒ½é™è¼‰ï¼‰ä½è¨˜æ†¶é«”/çœæµé‡/æ¸›å°‘å‹•ä½œ â†’ è‡ªå‹•é—œé–‰é«˜æˆæœ¬ç‰¹æ•ˆï¼Œé¿å…ã€Œç„¡å›æ‡‰ã€èˆ‡ç•¶æ©Ÿ -->
  <script>
  (function(){
    try{
      const dm = navigator.deviceMemory || 0;
      const conn = navigator.connection || {};
      const saveData = !!conn.saveData;
      const reduceMotion = !!(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches);
      const lowMem = (dm && dm <= 4);
      if(saveData || reduceMotion || lowMem){
        document.documentElement.classList.add("perf-lite");
      }
    }catch(e){}
  })();
  </script>

  <script>window.APP_VER=window.APP_VER||"20260129_03";window.TASUN_APP_VER=window.TASUN_APP_VER||window.APP_VER;</script>

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body class="locked booting">
  <!-- âœ…ç‰ˆæœ¬é–å®š + APPé«˜åº¦ç©©å®šï¼ˆé¿å… iOS åœ°å€åˆ—è·³å‹•ï¼‰+ è¦–è¦ºè¦–çª—ä¸Šä¸‹é®æ“‹ï¼ˆé¿å…åº•éƒ¨å­—/æŒ‰éµè¢«é®ï¼‰+ preload + å‹•æ…‹è¼‰å…¥ -->
  <script>
  (function () {
    "use strict";

    const VER = String(window.TASUN_APP_VER || window.APP_VER || "").trim();
    const url = new URL(location.href);
    const curV = url.searchParams.get("v") || "";

    if (VER && curV !== VER) {
      url.searchParams.set("v", VER);
      location.replace(url.toString());
      return;
    }

    window.__CACHE_V = VER || curV || "";
    window.__withV = window.__withV || function (u) {
      const vv = String(window.__CACHE_V || "").trim();
      if (!vv) return u;

      try {
        const uu = new URL(u, document.baseURI);
        if (uu.origin === location.origin) {
          uu.searchParams.set("v", vv);
          return uu.toString();
        }
        return u;
      } catch (e) {
        const s = String(u || "");
        if (!s || /^https?:\/\//i.test(s) || /^mailto:/i.test(s)) return s;
        const sep = s.includes("?") ? "&" : "?";
        return s + sep + "v=" + encodeURIComponent(vv);
      }
    };

    (function initViewportStabilizer(){
      const root = document.documentElement;
      let stableH = 0;
      let stableW = 0;

      function calcVV() {
        try{
          const vv = window.visualViewport;
          const h = Math.round(vv ? vv.height : window.innerHeight);
          const w = Math.round(vv ? vv.width  : window.innerWidth);

          const top = Math.round(vv ? vv.offsetTop : 0);
          const bottom = Math.max(0, Math.round(window.innerHeight - (vv ? (vv.height + vv.offsetTop) : window.innerHeight)));

          root.style.setProperty("--vv-top", top + "px");
          root.style.setProperty("--vv-bottom", bottom + "px");

          if(!stableH){
            stableH = h; stableW = w;
          }else{
            const dw = Math.abs(w - stableW);
            const dh = Math.abs(h - stableH);
            if(dw > 140 || dh > 160){
              stableH = h;
              stableW = w;
            }
          }
          root.style.setProperty("--appH", stableH + "px");
        }catch(e){
          try{ root.style.setProperty("--appH", window.innerHeight + "px"); }catch(_){}
        }
      }

      calcVV();
      window.addEventListener("resize", calcVV, { passive:true });
      window.addEventListener("orientationchange", calcVV, { passive:true });
      if(window.visualViewport){
        window.visualViewport.addEventListener("resize", calcVV, { passive:true });
        // âœ…é¿å… visualViewport scroll é€ æˆã€Œæ¯å¹€é‡æ’ã€â†’ äº¤çµ¦ layout ç¨‹å¼è‡ªå·±åˆ¤æ–·æ˜¯å¦éœ€è¦åˆ·æ–°
        window.visualViewport.addEventListener("scroll", calcVV, { passive:true });
      }
      document.addEventListener("visibilitychange", ()=>{ if(document.visibilityState==="visible") calcVV(); }, { passive:true });
    })();

    try{
      const id = "preloadZen";
      if(!document.getElementById(id)){
        const l = document.createElement("link");
        l.id = id;
        l.rel = "preload";
        l.as = "image";
        l.href = window.__withV("ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png");
        l.setAttribute("data-base", "ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png");
        document.head.appendChild(l);
      }
    }catch(e){}

    function patchZenResources(){
      const withV = window.__withV || ((u)=>u);
      try{
        const l = document.getElementById("preloadZen");
        if(l){
          const base = l.getAttribute("data-base") || l.getAttribute("href") || "";
          if(base) l.href = withV(base);
        }
      }catch(e){}
      try{
        const img = document.getElementById("zenImg");
        if(img){
          const base = img.getAttribute("data-base") || img.getAttribute("src") || "";
          if(base) img.src = withV(base);
        }
      }catch(e){}
    }
    patchZenResources();
    document.addEventListener("DOMContentLoaded", patchZenResources, { once:true });

    (function(){
      const withV = window.__withV || ((u)=>u);

      function loadScript(src){
        return new Promise((resolve)=>{
          try{
            const s = document.createElement("script");
            s.src = src;
            s.async = false;
            s.onload = ()=>resolve(true);
            s.onerror = ()=>resolve(false);
            document.head.appendChild(s);
          }catch(e){
            resolve(false);
          }
        });
      }

      (async()=>{
        await loadScript(withV("tasun-boot.js"));
        await loadScript(withV("tasun-loader.js"));

        function tryStart(){
          try{
            if(window.TasunLoader && typeof window.TasunLoader.start === "function"){
              window.TasunLoader.start({
                pageKey: "index",
                verUrl: "tasun-version.json",
                corePath: "tasun-core.js",
                forceUrlV: true,
                forceVersionSync: false,
                patchResources: true,
                networkToast: true,
                appHeightVar: false,
                preloadId: "preloadZen",
                zenImgId: "zenImg",
                appVer: window.TASUN_APP_VER
              });
              return true;
            }
          }catch(e){}
          return false;
        }

        if(!tryStart()){
          let n = 0;
          const t = setInterval(()=>{
            n++;
            if(tryStart() || n > 120) clearInterval(t);
          }, 50);
        }
      })();
    })();
  })();
  </script>

  <style>
    :root{
      --gap-01cm: 0.1cm;
      --outer-side: var(--gap-01cm);
      --frame-inset: var(--gap-01cm);

      --frame-radius: clamp(16px, 1.55vw, 30px);
      --stage-top: var(--frame-inset);

      --vv-top: 0px;
      --vv-bottom: 0px;

      /* âœ…æ•´é«”äº®åº¦ï¼ˆæ”¹ç”¨èƒŒæ™¯èª¿æ•´ï¼Œé¿å…å…¨é  filter é€ æˆ GPU/è¨˜æ†¶é«”å£“åŠ›ï¼‰ */
      --ambient-op: 0.58;

      /* âœ…åº•åœ–ç•¥æäº®ï¼Œä¿ç•™ç¦ªé¢¨ */
      --zen-opacity: 0.990;
      --zen-scale: 1.00;
      --zen-contrast: 1.16;
      --zen-bright: 1.12;
      --zen-sat: 1.05;
      --zen-posX: 50%;
      --zen-posY: 50%;

      /* âœ…ç‰¹æ•ˆï¼ˆé«˜æˆæœ¬ï¼‰é è¨­å­˜åœ¨ï¼›perf-lite æœƒè‡ªå‹•é—œé–‰ */
      --ripple-op: .0032;
      --ripple-speed: 30s;

      --mist-op: .10;
      --mist-a: rgba(245,250,255,0.10);
      --mist-b: rgba(235,245,255,0.06);
      --mist-beam: rgba(255,248,235,0.05);
      --mist-blur: 16px;
      --mist-speed: 54s;

      /* âœ…é™ä½å¤§é¢ç© blurï¼ˆèˆå°ä¸å†ä½¿ç”¨ backdrop-filterï¼‰ */
      --stage-blur: 0px;
      --panel-blur: 8px;
      --btn-blur: 0.6px;
      --btn-blur-m: 0.8px;

      --title-size: clamp(2.45rem, 5.1vw, 4.30rem);

      --axis-top: clamp(78px, 11vh, 170px);
      --axis-pad-x: clamp(18px, 2vw, 26px);
      --axis-pad-y: clamp(10px, 1.2vw, 14px);
      --axis-size: clamp(2.06rem, 3.9vw, 3.85rem);
      --axis-op: 0.84;

      --mantra-size: clamp(1.10rem, 2.1vw, 2.00rem);
      --side-op: 0.66;

      /* âœ…(3) åº•éƒ¨ç¦ªå­—ä¸Šç§»ï¼ˆä½ åœ–ä¸­ç´…ç®­é ­ä½ç½®ï¼‰ */
      --bottom-op: 0.72;
      --zen-fixed-y: 58%;
      --zen-fixed-x: clamp(64px, 18vw, 360px);
      --zw-bottom-pad: calc(var(--frame-inset) + 1.55cm + env(safe-area-inset-bottom) + var(--vv-bottom));

      --zw-plate-op-axis: 0.07;
      --zw-plate-op-side: 0.09;
      --zw-plate-op-bottom: 0.07;

      --zw-plate-a: rgba(70, 52, 36, 0.13);
      --zw-plate-b: rgba(255, 244, 220, 0.07);
      --zw-plate-border: rgba(255, 235, 195, 0.13);

      --userbar-pad: clamp(14px, 1.15vw, 22px);

      /* âœ…(1) ä½¿ç”¨è€…åˆ—ï¼šå­—æ›´äº®ã€æé‚Šæ›´é»‘ã€æ›´ç²—ï¼Œä¿è­‰æ¸…æ¥š */
      --ui-fill: rgba(255, 255, 255, 0.995);
      --ui-stroke: rgba(0, 0, 0, 0.94);
      --ui-stroke-w: 1.55px;
      --ui-shadow-1: rgba(0, 0, 0, 0.82);
      --ui-glow: rgba(255, 242, 200, 0.18);

      --btn-border: rgba(246, 211, 122, 0.64);
      --btn-border-hi: rgba(255, 244, 210, 0.86);

      /* âœ…æŒ‰éµç»ç’ƒï¼ˆè¼ªå»“æ›´æ˜é¡¯ã€ä»ä¸æ´—å­—ï¼‰ */
      --btn-glass-a: 0.060;
      --btn-glass-b: 0.056;

      /* âœ…æŒ‰éµåº•æ›´ç©©ï¼ˆä½ åœ–2ï¼šæŒ‰éµèˆ‡æ–‡å­—æ¯”ä¾‹â†’åº•æ¿æ›´å¯¦ã€å­—æ›´å¤§ï¼‰ */
      --btn-body-a: rgba(92, 70, 50, 0.18);
      --btn-body-b: rgba(58, 44, 33, 0.24);

      /* âœ…æŒ‰éµæ–‡å­—ï¼šé«˜å°æ¯”å›ºå®šåŸºæº– + é»‘åº•å¢Šç‰‡ï¼ˆä»»ä½•åº•åœ–éƒ½æ¸…æ¥šï¼‰ */
      --btn-text: rgba(255, 255, 255, 0.999);
      --btn-stroke: rgba(0, 0, 0, 0.94);
      --btn-stroke-w: 2.05px;
      --btn-shadowA: rgba(0,0,0,0.90);
      --btn-glowA: rgba(255, 245, 210, 0.12);
      --btn-text-plate: rgba(0,0,0,0.62);
      --btn-text-plate-op: 0.34;

      --lotus-spot-op: .16;

      --login-border: rgba(246,211,122,0.62);
      --login-solid-top: rgba(34, 22, 12, 0.96);
      --login-solid-bot: rgba(15, 10, 6, 0.97);
      --login-field-bg: rgba(10, 7, 4, 0.78);
      --login-field-bg2: rgba(255,250,235,0.08);
      --login-ink: rgba(255, 244, 210, 0.99);
      --login-stroke: rgba(0,0,0,0.55);
      --login-shadow-a: rgba(10,6,2,0.44);
      --login-shadow-b: rgba(10,6,2,0.28);
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html, body { height: 100%; }

    body{
      min-height:100vh;
      font-family:"æ¨™æ¥·é«”","Noto Serif TC","Microsoft JhengHei",serif;
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;

      background:
        radial-gradient(1100px 720px at 50% 12%, rgba(255,244,220,var(--ambient-op)) 0, rgba(0,0,0,0) 72%),
        radial-gradient(900px 520px at 50% 92%, rgba(246,211,122,0.12) 0, rgba(0,0,0,0) 74%),
        linear-gradient(180deg, #070809 0%, #080A0C 55%, #060608 100%);
      /* âœ…ç§»é™¤å…¨é  filterï¼ˆå¤§å¹…é™ä½ GPU/è¨˜æ†¶é«”è² æ“”ï¼Œé¿å…ç„¡å›æ‡‰ï¼‰ */
    }
    body.locked{ overflow:hidden; }
    body.booting *{ transition:none !important; }

    /* âœ…(æ•ˆèƒ½é™è¼‰) ç›´æ¥é—œé–‰é«˜æˆæœ¬ç‰¹æ•ˆ / å¤§é¢ç© blur */
    html.perf-lite .ripple-film,
    html.perf-lite .mist-film{ display:none !important; }
    html.perf-lite .ripple-film::before,
    html.perf-lite .mist-film::before{ animation:none !important; }
    html.perf-lite .lotus-stage{ backdrop-filter:none !important; -webkit-backdrop-filter:none !important; }
    html.perf-lite .user-bar::before,
    html.perf-lite .user-pill,
    html.perf-lite .btn-switch,
    html.perf-lite .nav-btn{
      backdrop-filter:none !important;
      -webkit-backdrop-filter:none !important;
    }

    /* âœ…(1)(2) æ–‡å­—æ›´æ¸…æ¥šï¼šé™°å½±æ›´èšç„¦ã€æé‚Šæ›´é»‘æ›´ç²— */
    .crystal-ui{
      color: var(--ui-fill);
      -webkit-text-stroke: var(--ui-stroke-w) var(--ui-stroke);
      text-shadow:
        0 1px 0 rgba(0,0,0,0.22),
        0 10px 22px var(--ui-shadow-1),
        0 0 12px rgba(255,255,255,0.10),
        0 0 18px var(--ui-glow);
      letter-spacing: .10em;
      font-weight: 900;
    }

    .hero{
      min-height: var(--appH, 100svh);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--outer-side);
    }

    .hero-inner{
      position:relative;
      width: calc(100vw - (var(--outer-side) * 2));
      height: calc(var(--appH, 100svh) - (var(--outer-side) * 2));
      min-height: 560px;
      border-radius: calc(var(--frame-radius) + 10px);
      overflow:hidden;

      background:
        radial-gradient(1200px 760px at 50% 18%, rgba(255,250,235,0.14), rgba(0,0,0,0) 62%),
        radial-gradient(980px 560px at 50% 92%, rgba(246,211,122,0.15), rgba(0,0,0,0) 74%),
        linear-gradient(180deg, #9c876b 0%, #7b654d 48%, #5a4635 100%);
    }

    .hero-inner::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.07), rgba(0,0,0,0.03)),
        radial-gradient(1100px 680px at 50% 55%, rgba(255,255,255,0.14), rgba(0,0,0,0));
      box-shadow:
        0 22px 76px rgba(0,0,0,0.26),
        inset 0 1px 0 rgba(255,255,255,0.08);
      border: 1px solid rgba(246,211,122,0.20);
      pointer-events:none;
    }
    .hero-inner::after{
      content:"";
      position:absolute;
      inset: 1px;
      border-radius: inherit;
      background:
        radial-gradient(800px 420px at 50% 15%, rgba(255,255,255,0.10), rgba(0,0,0,0) 62%),
        linear-gradient(180deg, rgba(255,244,210,0.07), rgba(0,0,0,0.03));
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.05),
        inset 0 -18px 34px rgba(0,0,0,0.06);
      pointer-events:none;
      opacity: .94;
    }

    .lotus-stage{
      position:absolute;
      left: var(--frame-inset);
      right: var(--frame-inset);
      top: var(--stage-top);
      bottom: var(--frame-inset);
      border-radius: var(--frame-radius);
      overflow:hidden;

      background:
        radial-gradient(1200px 740px at 50% 18%, rgba(255,255,255,0.16), rgba(0,0,0,0) 62%),
        radial-gradient(980px 620px at 50% 72%, rgba(255,244,210,0.08), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(112,88,64,0.14), rgba(72,54,40,0.14));

      border: 1px solid rgba(246,211,122,0.20);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        inset 0 14px 34px rgba(0,0,0,0.07),
        inset 0 -24px 40px rgba(0,0,0,0.05);

      /* âœ…å¤§é¢ç© backdrop-filter æœƒåƒ GPU/è¨˜æ†¶é«” â†’ ç§»é™¤ */
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
    }

    .zen-visual{ position:absolute; inset:0; }
    .zen-visual img{
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: var(--zen-posX) var(--zen-posY);
      transform: scale(var(--zen-scale));
      opacity: var(--zen-opacity);
      filter: contrast(var(--zen-contrast)) brightness(var(--zen-bright)) saturate(var(--zen-sat));
      display:block;
    }

    .spotlight{
      position:absolute;
      inset:0;
      background:
        radial-gradient(900px 520px at 50% 55%, rgba(255,255,255,var(--lotus-spot-op)) 0, rgba(0,0,0,0) 70%),
        radial-gradient(900px 520px at 50% 30%, rgba(246,211,122,0.07) 0, rgba(0,0,0,0) 72%);
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .ripple-film, .mist-film{
      position:absolute;
      inset: var(--frame-inset);
      border-radius: var(--frame-radius);
      pointer-events:none;
      z-index: 2;
      overflow:hidden;
      contain: paint;
    }
    .ripple-film::before{
      content:"";
      position:absolute;
      inset:-30%;
      background:
        repeating-radial-gradient(circle at 50% 70%,
          rgba(255,255,255,var(--ripple-op)) 0 2px,
          rgba(0,0,0,0) 2px 18px);
      transform: rotate(8deg);
      animation: rippleMove var(--ripple-speed) linear infinite;
    }
    @keyframes rippleMove{
      0%{ transform: translate3d(-2%,0,0) rotate(8deg); }
      100%{ transform: translate3d(2%,0,0) rotate(8deg); }
    }

    .mist-film::before{
      content:"";
      position:absolute;
      inset:-26%;
      background:
        radial-gradient(900px 520px at 30% 30%, var(--mist-a), rgba(0,0,0,0) 70%),
        radial-gradient(900px 520px at 70% 35%, var(--mist-b), rgba(0,0,0,0) 72%),
        linear-gradient(110deg, rgba(0,0,0,0), var(--mist-beam), rgba(0,0,0,0));
      filter: blur(var(--mist-blur));
      opacity: var(--mist-op);
      animation: mistDrift var(--mist-speed) ease-in-out infinite;
    }
    @keyframes mistDrift{
      0%{ transform: translate3d(-2%, -1%, 0); }
      50%{ transform: translate3d(2%, 1%, 0); }
      100%{ transform: translate3d(-2%, -1%, 0); }
    }

    .site-title-wrapper{
      position:absolute;
      left: 50%;
      top: calc(var(--frame-inset) + 6px + var(--vv-top));
      transform: translateX(-50%);
      z-index: 12;
      pointer-events:none;
    }
    .site-title{
      font-size: var(--title-size);
      letter-spacing: .16em;
      text-align:center;
      opacity: .99;
      white-space: nowrap;
    }

    .zen-words{
      position:absolute;
      inset: 0;
      z-index: 11;
      pointer-events:none;
      isolation:isolate;
    }

    .zw-plate{ position: relative; display:block !important; visibility: visible !important; }
    .zw-plate::before{
      content:"";
      position:absolute;
      inset:-10px -14px;
      border-radius: 20px;
      background:
        radial-gradient(240px 120px at 50% 35%, rgba(255,255,255,0.06), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, var(--zw-plate-b), rgba(0,0,0,0)),
        linear-gradient(180deg, rgba(0,0,0,0), var(--zw-plate-a));
      border: 1px solid var(--zw-plate-border);
      box-shadow:
        0 10px 22px rgba(0,0,0,0.10),
        inset 0 1px 0 rgba(255,255,255,0.05);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      pointer-events:none;
      opacity: 0.10;
    }
    .zw-plate.axis::before{ opacity: var(--zw-plate-op-axis); }
    .zw-plate.side::before{ opacity: var(--zw-plate-op-side); }
    .zw-plate.bottom::before{ opacity: var(--zw-plate-op-bottom); }

    .zen-crystal{
      --zc-stroke: rgba(34, 16, 6, 0.72);
      --zc-shadow: rgba(0,0,0,0.38);
      --zc-glow: rgba(255,220,150,0.10);
      --zc-hi: rgba(255,255,255,0.10);

      font-weight: 900;
      background:
        linear-gradient(180deg,
          rgba(255,248,232,0.78) 0%,
          rgba(255,226,168,0.62) 26%,
          rgba(245,196,92,0.66) 62%,
          rgba(255,252,244,0.74) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;

      -webkit-text-stroke: 1.55px var(--zc-stroke);
      paint-order: stroke fill;

      text-shadow:
        0 -1px 0 var(--zc-hi),
        0  1px 0 rgba(0,0,0,0.12),
        0  10px 18px var(--zc-shadow),
        0  0 14px var(--zc-glow);
    }

    .zw-top-axis{
      position:absolute;
      left: 50%;
      top: calc(var(--axis-top) + var(--vv-top));
      transform: translateX(-50%);
      opacity: var(--axis-op);
      padding: var(--axis-pad-y) var(--axis-pad-x);
      border-radius: 22px;
      white-space: nowrap;
    }
    .zw-axis-text{
      font-size: var(--axis-size);
      white-space: pre;
      letter-spacing: 0;
      line-height: 1;
      opacity: 0.98;
    }

    .zw-side-col{
      position:absolute;
      top: var(--zen-fixed-y);
      transform: translateY(-50%);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      letter-spacing: .18em;
      font-size: var(--mantra-size);
      opacity: var(--side-op);
      white-space: nowrap;
      padding: 10px 12px;
      border-radius: 20px;
    }
    #zwLeft{ left: calc(50% - var(--zen-fixed-x)); }
    #zwRight{ right: calc(50% - var(--zen-fixed-x)); }

    .zw-bottom-line{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      bottom: var(--zw-bottom-pad);
      font-size: var(--mantra-size);
      letter-spacing: .28em;
      opacity: var(--bottom-op);
      white-space: nowrap;
      padding: 8px 10px;
      border-radius: 18px;
      background: transparent !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
    }

    .user-bar{
      position:absolute;
      left: calc(var(--frame-inset) + var(--userbar-pad) + env(safe-area-inset-left));
      top:  calc(var(--frame-inset) + var(--userbar-pad) + env(safe-area-inset-top) + var(--vv-top));
      display:flex;
      gap: 10px;
      row-gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      max-width: calc(100% - (var(--frame-inset) * 2) - 12px);
      z-index: 13;
      isolation: isolate;
    }
    .user-bar::before{
      content:"";
      position:absolute;
      inset:-10px -12px;
      border-radius: 999px;
      background:
        radial-gradient(260px 120px at 18% 28%, rgba(255,255,255,0.12), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(0,0,0,0.58), rgba(0,0,0,0.34));
      border: 1px solid rgba(255,244,210,0.28);
      box-shadow: 0 18px 44px rgba(0,0,0,0.36), inset 0 1px 0 rgba(255,255,255,0.08);
      backdrop-filter: blur(var(--panel-blur));
      -webkit-backdrop-filter: blur(var(--panel-blur));
      z-index: -1;
      pointer-events:none;
    }

    .user-pill{
      padding: 10px 14px;
      border-radius: 999px;
      background:
        radial-gradient(240px 90px at 24% 20%, rgba(255,255,255,0.10), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(0,0,0,0.56), rgba(0,0,0,0.30));
      border: 1px solid rgba(255,244,210,0.30);
      backdrop-filter: blur(var(--panel-blur));
      -webkit-backdrop-filter: blur(var(--panel-blur));
      font-size: 15px; /* âœ…(1) æ”¾å¤§ */
      letter-spacing: .06em;
      white-space:nowrap;
      box-shadow: 0 14px 28px rgba(0,0,0,0.24);
      font-weight: 900;
    }

    .btn-switch{
      border: 1px solid rgba(255,244,210,0.32);
      background:
        radial-gradient(220px 80px at 22% 22%, rgba(255,255,255,0.10), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(0,0,0,0.54), rgba(0,0,0,0.28));
      padding: 10px 14px;
      border-radius: 999px;
      cursor:pointer;
      backdrop-filter: blur(var(--panel-blur));
      -webkit-backdrop-filter: blur(var(--panel-blur));
      box-shadow: 0 14px 28px rgba(0,0,0,0.24);
      letter-spacing:.08em;
      font-weight: 900;
      font-size: 15px; /* âœ…(1) æ”¾å¤§ */
    }
    .btn-switch:hover{ background:
        radial-gradient(220px 80px at 22% 22%, rgba(255,255,255,0.12), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(0,0,0,0.62), rgba(0,0,0,0.34));
    }
    .btn-export{ opacity: .98; }

    /* ===== å°è¦½æŒ‰éµå€ ===== */
    .nav-area{
      position:absolute;
      inset: var(--frame-inset);
      z-index: 7;
      pointer-events:auto;
      contain: layout paint;
    }

    .nav-area::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 0;
      background:
        radial-gradient(720px 520px at 18% 58%, rgba(255,255,255,0.10), rgba(0,0,0,0) 74%),
        radial-gradient(720px 520px at 82% 58%, rgba(255,255,255,0.10), rgba(0,0,0,0) 74%),
        radial-gradient(980px 640px at 50% 92%, rgba(246,211,122,0.09), rgba(0,0,0,0) 74%);
      mix-blend-mode: screen;
      opacity: 0.16;
    }

    .nav-btn{
      display:flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;

      border-radius: 999px;
      border: 1px solid var(--btn-border);

      container-type: inline-size;

      background:
        radial-gradient(340px 130px at 24% 20%, rgba(255,255,255,var(--btn-glass-a)), rgba(0,0,0,0) 64%),
        radial-gradient(380px 160px at 76% 26%, rgba(246,211,122,var(--btn-glass-b)), rgba(0,0,0,0) 72%),
        linear-gradient(180deg, var(--btn-body-a), var(--btn-body-b));

      box-shadow:
        0 16px 46px rgba(0,0,0,0.28),
        0 0 34px rgba(246,211,122,0.12),
        inset 0 1px 0 rgba(255,255,255,0.08),
        inset 0 -10px 18px rgba(0,0,0,0.06);

      backdrop-filter: blur(var(--btn-blur));
      -webkit-backdrop-filter: blur(var(--btn-blur));

      user-select:none;
      -webkit-tap-highlight-color: transparent;

      position: relative;
      overflow: hidden;
      z-index: 1;

      /* âœ…ä¿è­‰æ–‡å­—æ°¸é ç™½ï¼ˆé¿å…ä»»ä½•æƒ…æ³è®Šé»‘ç³Šï¼‰ */
      color: var(--btn-text);
    }

    .nav-btn::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(240px 80px at 30% 18%, rgba(255,255,255,0.070), rgba(0,0,0,0) 60%),
        radial-gradient(320px 110px at 70% 24%, rgba(246,211,122,0.075), rgba(0,0,0,0) 68%);
      opacity: .26;
      pointer-events:none;
    }
    .nav-btn::after{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.00) 46%),
        radial-gradient(240px 120px at 40% 12%, rgba(255,255,255,0.08), rgba(0,0,0,0) 70%);
      opacity: .16;
      mix-blend-mode: screen;
      pointer-events:none;
    }

    .nav-btn span{
      padding: 0 18px;
      position:relative;
      z-index: 1;

      font-size: var(--btn-fs, clamp(1.18rem, 2.6vw, 1.92rem)); /* âœ…(2) æ”¾å¤§ */
      color: inherit !important;
      -webkit-text-fill-color: inherit;

      -webkit-text-stroke: var(--btn-stroke-w) var(--btn-stroke);
      text-shadow:
        0 1px 0 rgba(0,0,0,0.22),
        0 9px 18px var(--btn-shadowA),
        0 0 12px rgba(255,255,255,0.09),
        0 0 12px var(--btn-glowA);

      letter-spacing: .06em; /* âœ…(2) å­—è·ç•¥æ”¶ï¼Œæ¸…æ™°åº¦æ›´å¥½ */
      font-weight: 900;
      font-family:"æ¨™æ¥·é«”","Noto Serif TC","Microsoft JhengHei",serif;
      line-height: 1.12;

      white-space: normal;
      text-align: center;
      text-wrap: balance;

      max-width: 92%;
      overflow-wrap: anywhere;
      word-break: keep-all;
      line-break: strict;
    }

    /* âœ…(1)(2) æ–‡å­—å¢Šç‰‡ï¼šä»»ä½•åº•åœ–éƒ½èƒ½æ¸…æ¥šè¾¨è­˜ */
    .nav-btn span::before{
      content:"";
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      width: calc(100% + 18px);
      height: calc(100% + 12px);
      border-radius: 14px;
      background: var(--btn-text-plate);
      opacity: var(--btn-text-plate-op);
      z-index: -1;
      box-shadow: 0 10px 22px rgba(0,0,0,0.20);
      pointer-events:none;
    }

    .nav-btn span.latin{
      font-family:"Noto Sans TC","Microsoft JhengHei","Noto Serif TC",sans-serif;
      letter-spacing: .05em;
      font-weight: 900;
    }
    .nav-btn span.latin-only{ letter-spacing: .04em; }

    @supports (width: 1cqw){
      .nav-btn span{
        font-size: var(--btn-fs, clamp(1.18rem, 5.2cqw, 1.92rem));
      }
    }

    .nav-btn:hover{
      border-color: var(--btn-border-hi);
      box-shadow:
        0 20px 54px rgba(0,0,0,0.32),
        0 0 40px rgba(246,211,122,0.15),
        inset 0 1px 0 rgba(255,255,255,0.10),
        inset 0 -10px 18px rgba(0,0,0,0.08);
    }
    .nav-btn:focus{
      outline:none;
      border-color: var(--btn-border-hi);
      box-shadow:
        0 0 0 2px rgba(246,211,122,0.14),
        0 20px 54px rgba(0,0,0,0.32),
        0 0 40px rgba(246,211,122,0.15);
    }

    .nav-area.sides .nav-btn{
      position:absolute;
      transform: none !important;
      left: auto;
      right: auto;
      top: 0;
      transition: box-shadow .18s ease, border-color .18s ease;
      will-change: top, left, right;
    }

    .nav-area.stack{
      display:flex;
      flex-direction: column;
      gap: 14px;
      justify-content:flex-start;
      padding-top: 120px;
      padding-bottom: 140px;
      padding-left: 16px;
      padding-right: 16px;
      overflow: hidden;
      -webkit-overflow-scrolling: touch;
    }
    .nav-area.stack .nav-btn{
      position:relative !important;
      left:auto !important;
      top:auto !important;
      right:auto !important;
      transform:none !important;
      width: 100% !important;
      min-height: 52px; /* âœ…(2) æ”¾å¤§ */
      border-radius: 18px;
      backdrop-filter: blur(var(--btn-blur-m));
      -webkit-backdrop-filter: blur(var(--btn-blur-m));
    }

    @media (max-width: 900px){
      .hero-inner{ min-height: 540px; }

      .user-bar{
        left: calc(var(--frame-inset) + 12px + env(safe-area-inset-left));
        right: calc(var(--frame-inset) + 12px + env(safe-area-inset-right));
        max-width: none;
      }
      .user-pill{ flex: 1 1 auto; min-width: 220px; }

      :root{
        --mantra-size: clamp(1.02rem, 3.2vw, 1.38rem);
        --zen-fixed-x: clamp(56px, 12vw, 140px);
        --axis-top: clamp(86px, 12vh, 170px);
      }
      .zw-side-col{ padding: 8px 10px; opacity: var(--side-op); }
      .zw-top-axis{ opacity: var(--axis-op); }

      .nav-btn{ --btn-stroke-w: 1.90px; }
    }

    /* ===== ç™»å…¥é®ç½© ===== */
    .login-overlay{
      position:fixed; inset:0; z-index: 3000;
      display:none; align-items:center; justify-content:center;
      background:
        radial-gradient(900px 560px at 50% 45%, rgba(0,0,0,0.30), rgba(0,0,0,0.66)),
        radial-gradient(1200px 760px at 50% 10%, rgba(246,211,122,0.10), rgba(0,0,0,0)),
        rgba(0,0,0,0.52);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .login-box{
      width: min(520px, calc(100vw - 36px));
      border-radius: 22px;
      padding: 22px 22px 18px;
      background: linear-gradient(180deg, var(--login-solid-top), var(--login-solid-bot));
      border: 1px solid var(--login-border);
      box-shadow: 0 26px 90px rgba(0,0,0,0.58), inset 0 1px 0 rgba(255,255,255,0.06);
    }

    /* âœ…(ç™»å…¥è¡¨æ–‡å­—) æ¨™é¡Œ/æŒ‰éµï¼šæ›´äº® + æ›´ç²—æé‚Šï¼Œé¿å…ä¸æ¸…æ¥š */
    .login-box .crystal-ui{
      color: rgba(255,255,255,0.995) !important;
      -webkit-text-stroke: 1.75px rgba(0,0,0,0.95) !important;
      text-shadow:
        0 1px 0 rgba(0,0,0,0.22),
        0 12px 22px rgba(0,0,0,0.78),
        0 0 16px rgba(255,235,185,0.14) !important;
      letter-spacing: .10em;
      font-weight: 900;
    }

    .login-title{ font-size: 1.56rem; margin-bottom: 10px; text-align:center; }
    .login-sub{
      text-align:center; min-height: 18px; font-size: 14px; opacity:.82; margin-bottom: 14px;
      color: rgba(255,238,190,0.88); letter-spacing:.06em;
      -webkit-text-stroke: 0.60px rgba(0,0,0,0.55);
      text-shadow: 0 6px 16px rgba(0,0,0,0.46);
    }
    .login-field{ display:flex; flex-direction: column; gap: 8px; margin: 12px 0; }
    .login-field label{
      font-size: 14px; letter-spacing: .12em; color: rgba(255,238,190,0.88);
      -webkit-text-stroke: 0.55px rgba(0,0,0,0.55);
      text-shadow: 0 6px 14px rgba(0,0,0,0.42);
      font-weight: 800;
    }
    .login-pwd-wrapper{ display:flex; gap: 10px; align-items:center; }
    .login-pwd-input{
      flex:1; padding: .78rem .96rem; border-radius:999px;
      border:1px solid rgba(246,211,122,0.78);
      background:
        linear-gradient(180deg, var(--login-field-bg2), rgba(0,0,0,0.00)),
        linear-gradient(180deg, var(--login-field-bg), rgba(0,0,0,0.44));
      color: var(--login-ink); caret-color: var(--login-ink);
      -webkit-text-stroke: .78px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 5px 10px var(--login-shadow-a);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 12px 20px rgba(0,0,0,0.24);
      outline:none;
      font-size: 15px;
      font-weight: 800;
    }
    .login-pwd-input:focus{
      border-color: rgba(255,244,210,0.96);
      box-shadow: 0 0 0 2px rgba(246,211,122,0.18), 0 0 22px rgba(246,211,122,0.22), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .btn-eye-login{
      width: 44px; height: 44px; border-radius: 999px;
      border:1px solid rgba(246,211,122,0.58);
      background: rgba(0,0,0,0.26);
      color: rgba(255,238,190,0.94);
      cursor:pointer;
      box-shadow: 0 12px 22px rgba(0,0,0,0.26);
    }
    .login-error{
      min-height: 18px; color: rgba(255,190,160,0.98); font-size: 14px; letter-spacing: .06em; margin-top: 6px; text-align:center;
      -webkit-text-stroke: 0.50px rgba(0,0,0,0.45);
      text-shadow: 0 8px 16px rgba(0,0,0,0.48);
    }
    .login-actions{ display:flex; gap: 12px; justify-content:center; margin-top: 14px; }
    .btn-login, .btn-secondary{
      border-radius: 999px; padding: 12px 18px;
      border: 1px solid rgba(246,211,122,0.58);
      background: rgba(0,0,0,0.24);
      cursor:pointer; letter-spacing: .12em;
      box-shadow: 0 16px 34px rgba(0,0,0,0.32);
      font-size: 15px;
      font-weight: 900;
    }
    .btn-login:hover, .btn-secondary:hover{ background: rgba(0,0,0,0.30); }

    /* ===== è‡ªè£½ä¸‹æ‹‰ ===== */
    .select-wrap{ position:relative; width:100%; }
    .select-wrap select{ position:absolute; inset:0; opacity:0; pointer-events:none; }
    .select-display{
      width:100%; display:flex; align-items:center; justify-content:flex-start; text-align:left;
      padding: .78rem 2.60rem .78rem .96rem;
      border-radius:999px; border:1px solid rgba(246,211,122,0.78);
      background:
        linear-gradient(180deg, var(--login-field-bg2), rgba(0,0,0,0.00)),
        linear-gradient(180deg, var(--login-field-bg), rgba(0,0,0,0.44));
      color: var(--login-ink);
      -webkit-text-stroke: .78px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 5px 10px var(--login-shadow-a);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 12px 20px rgba(0,0,0,0.24);
      cursor:pointer; user-select:none; position:relative; appearance:none;
      backdrop-filter:none; -webkit-backdrop-filter:none;
      font-size: 15px;
      font-weight: 900;
    }
    .select-display::after{
      content:"â–¾";
      position:absolute; right: .95rem; top: 50%; transform: translateY(-50%);
      opacity:.92; font-size: 1.10rem;
      -webkit-text-stroke: .55px rgba(0,0,0,0.55);
      text-shadow: 0 2px 10px rgba(0,0,0,0.38);
      pointer-events:none;
    }
    .select-menu{
      position:absolute; left:0; right:0; top: calc(100% + 10px);
      max-height: 280px; overflow:auto;
      border-radius: 16px; border: 1px solid rgba(246,211,122,0.62);
      background: rgba(8,5,3,0.98);
      box-shadow: 0 22px 60px rgba(0,0,0,0.46), 0 0 24px rgba(246,211,122,0.10);
      display:none; z-index: 4005; padding: 6px;
    }
    .select-menu.open{ display:block; }
    .select-option{
      padding: .70rem .96rem; border-radius: 12px; cursor:pointer;
      color: rgba(255,244,210,0.98); letter-spacing:.06em;
      -webkit-text-stroke: .55px rgba(0,0,0,0.40);
      text-shadow: 0 2px 10px rgba(0,0,0,0.38);
      user-select:none; border: 1px solid transparent;
      font-weight: 900;
    }
    .select-option:hover{ background: rgba(255,244,210,0.10); }
    .select-option[aria-selected="true"]{ background: rgba(246,211,122,0.14); border-color: rgba(246,211,122,0.20); }
    .select-option.active{ background: rgba(255,244,210,0.14); border-color: rgba(255,244,210,0.22); outline: none; }
  </style>

  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <div class="login-title crystal-ui">Tasun è³‡æ–™ Â· ç™»å…¥</div>
      <div class="login-sub" id="loginSub"></div>

      <form id="loginForm">
        <div class="login-field">
          <label for="username">ä½¿ç”¨è€…åç¨±</label>

          <div class="select-wrap" id="usernameWrap">
            <select id="username" name="username" autocomplete="username"></select>
            <button type="button" class="select-display" id="usernameDisplay" aria-haspopup="listbox" aria-expanded="false">
              è«‹é¸æ“‡ä½¿ç”¨è€…
            </button>
            <div class="select-menu" id="usernameMenu" role="listbox" aria-label="ä½¿ç”¨è€…åç¨±æ¸…å–®"></div>
          </div>
        </div>

        <div class="login-field">
          <label for="password">å¯†ç¢¼</label>
          <div class="login-pwd-wrapper">
            <input id="password" name="password" type="password" autocomplete="current-password" class="login-pwd-input" />
            <button type="button" class="btn-eye-login" id="btnTogglePwd">ğŸ‘</button>
          </div>
        </div>

        <div class="login-error" id="loginError"></div>

        <div class="login-actions">
          <button type="submit" class="btn-login crystal-ui">ç™»å…¥</button>
          <button type="button" class="btn-secondary crystal-ui" id="btnForceRelogin">åˆ‡æ›/é‡æ–°ç™»å…¥</button>
        </div>
      </form>
    </div>
  </div>

  <main class="hero">
    <div class="hero-inner" id="heroInner">
      <div class="ripple-film" aria-hidden="true"></div>
      <div class="mist-film" aria-hidden="true"></div>

      <div class="lotus-stage" id="lotusStage" aria-hidden="true">
        <div class="spotlight" aria-hidden="true"></div>
        <div class="zen-visual" aria-hidden="true">
          <img id="zenImg"
               src="ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png"
               data-base="ä½›æ•™ç¦ªæ„ä¸»è¦–è¦º.png"
               alt=""
               loading="eager"
               decoding="async"
               fetchpriority="high"
               crossorigin="anonymous">
        </div>
      </div>

      <div class="zen-words" aria-hidden="true">
        <div class="zw-top-axis zw-plate axis" id="zwTopAxis">
          <span class="zw-axis-text zen-crystal" id="zwAxisText">ç©º ç„¡ æ˜</span>
        </div>

        <div class="zw-side-col zw-plate side zen-crystal" id="zwLeft">ç©ºå¯§ç„¡æˆ‘</div>
        <div class="zw-side-col zw-plate side zen-crystal" id="zwRight">æ¸…æ˜å¯§éœ</div>
        <div class="zw-bottom-line zw-plate bottom zen-crystal" id="zwBottomLine">ç©ºç„¡ã€€æ˜éœ</div>
      </div>

      <div class="user-bar" id="userBar">
        <div class="user-pill crystal-ui" id="userInfo" data-text="ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥">ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥</div>
        <button class="btn-switch crystal-ui" id="btnSwitchUser" type="button">åˆ‡æ›å¸³è™Ÿ</button>
        <button class="btn-switch btn-export crystal-ui" id="btnExport" type="button">åŒ¯å‡ºå‚™ä»½</button>
      </div>

      <div class="site-title-wrapper" id="titleWrap">
        <div class="site-title crystal-ui">Tasun è³‡æ–™</div>
      </div>

      <div class="nav-area" id="navArea"></div>
    </div>
  </main>

  <script>
  (function(){
    "use strict";

    function runIndexApp(){
      (function(){
        "use strict";

        try{
          const v = new URL(location.href).searchParams.get("v") || "";
          console.info("[Tasun index]", "APP_VER=", (window.TASUN_APP_VER||""), "url_v=", v);
        }catch(e){}

        const Core = window.TasunCore || null;
        const withV = (Core && Core.withV) ? Core.withV : (window.__withV || ((u)=>u));
        const safeJsonParse = (Core && Core.jsonParse) ? Core.jsonParse : ((s,f)=>{ try{return JSON.parse(s);}catch(e){return f;} });
        const clamp = (Core && Core.clamp) ? Core.clamp : ((n,a,b)=>Math.max(a,Math.min(b,n)));
        const lerp  = (Core && Core.lerp)  ? Core.lerp  : ((a,b,t)=>a+(b-a)*t);

        const rafDebounce = (Core && Core.rafDebounce) ? Core.rafDebounce : (fn=>{
          let r=0; return function(){ try{ cancelAnimationFrame(r); }catch(e){} r=requestAnimationFrame(()=>{ try{ fn(); }catch(e){} }); };
        });
        const onFontsReady = (Core && Core.onFontsReady) ? Core.onFontsReady : (cb=>{
          if(document.fonts && document.fonts.ready) document.fonts.ready.then(cb);
          else setTimeout(cb, 180);
        });

        const $ = (sel) => document.querySelector(sel);

        const AUTH_KEY    = "tasunAuthTable_v1";
        const CURRENT_KEY = "tasunCurrentUser_v1";
        const SESSION_KEY = "tasunSessionLogin_v1";

        const NAV_KEY     = "tasunNavButtons_v1";
        const ROUTE_KEY   = "tasunNavRoutes_v1";

        const BACKUP_RING_KEY = "tasunBackupRing_v1";
        const BACKUP_RING_MAX = 10;

        const METRO_ID    = "btn2";
        const METRO_HREF  = "æ±æ±å·¥ç¨‹ç®¡ç†è¡¨.html";

        const FIXED_ROUTES = {
          "æ·é‹æ±æ±ç·šäº‹é …ç´€éŒ„": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
          "æ·é‹æ±æ±ç·šäº‹é …è¨˜éŒ„": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
          "æ·é‹æ±æ±ç·šäº‹é …ç´€éŒ„.html": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
          "æ·é‹æ±æ±ç·šäº‹é …è¨˜éŒ„.html": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
          "æ·é‹æ±æ±ç·šè¨˜äº‹": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
          "æ·é‹æ±æ±ç·šè¨˜äº‹.html": "æ·é‹æ±æ±ç·šè¨˜äº‹.html",
        };

        const LEGACY_BUTTON_KEYS = ["btn1","btn2","btn3","btn4","btn5"];

        const loginOverlay = $("#loginOverlay");
        const loginForm    = $("#loginForm");
        const loginError   = $("#loginError");
        const loginSub     = $("#loginSub");
        const userInfo     = $("#userInfo");
        const btnSwitch    = $("#btnSwitchUser");
        const btnExport    = $("#btnExport");
        const btnTogglePwd = $("#btnTogglePwd");
        const btnForceRelogin = $("#btnForceRelogin");

        const navArea      = $("#navArea");
        const titleWrap    = $("#titleWrap");
        const userBar      = $("#userBar");
        const zwTopAxis    = $("#zwTopAxis");
        const zwAxisText   = $("#zwAxisText");
        const zwBottomLine = $("#zwBottomLine");
        const zwLeft       = $("#zwLeft");
        const zwRight      = $("#zwRight");
        const zenImg       = document.getElementById("zenImg");

        const usernameWrap = document.getElementById("usernameWrap");
        const usernameSel = document.getElementById("username");
        const usernameDisplay = document.getElementById("usernameDisplay");
        const usernameMenu = document.getElementById("usernameMenu");

        /* =========================
           âœ… CloudKit
           ========================= */
        const CLOUD_RES_URL = "tasun-resources.json";
        const CLOUD_RESOURCE_KEY = "index-config";

        const CLOUD_KEYS = [AUTH_KEY, NAV_KEY, ROUTE_KEY];
        const CLOUD_KEY_SET = new Set(CLOUD_KEYS);

        let cloudCtrl = null;
        let cloudMounted = false;
        let cloudApplying = false;
        let cloudSaveTimer = 0;

        /* âœ…(æ•ˆèƒ½ä¿®æ­£) Cloud UI bar æƒæï¼šé¿å… querySelectorAll("body *") å¤§é‡é…ç½® â†’ æ”¹æˆã€Œå°¾ç«¯å°ç¯„åœã€æƒæ */
        function patchCloudUiBarAuto(){
          const WANT = { tried:0 };
          const MAX_TRY = 80;

          function findBar(){
            try{
              const byId =
                document.getElementById("tasunCloudBar") ||
                document.getElementById("tasunCloudUI") ||
                document.getElementById("tasunCloudUi") ||
                document.getElementById("tasun-cloud-ui");
              if(byId) return byId;

              const bySel = document.querySelector("[data-tasun-cloud],[data-cloud-kit],[data-cloudbar],.tasun-cloud-ui,.tasun-cloud-bar,.cloud-bar");
              if(bySel) return bySel;
            }catch(e){}

            try{
              const all = document.body ? document.body.getElementsByTagName("*") : null;
              if(!all || !all.length) return null;

              // âœ…åªæƒæœ€å¾Œ 240 å€‹ç¯€é»ï¼ˆé›²ç«¯ bar é€šå¸¸åœ¨ body å°¾ç«¯æ’å…¥ï¼‰
              const limit = 240;
              let n = 0;
              for(let i=all.length-1; i>=0 && n<limit; i--, n++){
                const el = all[i];
                if(!el) continue;
                const t = (el.textContent || "").trim();
                if(!t) continue;
                if(!t.includes("é›²ç«¯")) continue;

                const hasSync = (function(){
                  try{
                    const btns = el.querySelectorAll("button, a");
                    for(const b of btns){
                      if(((b.textContent||"").trim()).includes("åŒæ­¥")) return true;
                    }
                  }catch(e){}
                  return false;
                })();
                if(hasSync) return el;
              }
            }catch(e){}

            return null;
          }

          function sanitize(bar){
            if(!bar) return;

            try{
              bar.style.background = "rgba(0,0,0,0.50)";
              bar.style.border = "1px solid rgba(255,244,210,0.32)";
              bar.style.borderRadius = "999px";
              bar.style.padding = "8px 10px";
              bar.style.backdropFilter = "blur(10px)";
              bar.style.webkitBackdropFilter = "blur(10px)";
              bar.style.boxShadow = "0 16px 44px rgba(0,0,0,0.34), inset 0 1px 0 rgba(255,255,255,0.08)";
              bar.style.color = "rgba(255,255,255,0.96)";
              bar.style.letterSpacing = ".08em";
              bar.style.fontFamily = '"Noto Serif TC","Microsoft JhengHei",serif';
              bar.style.webkitTextStroke = "1.15px rgba(0,0,0,0.90)";
              bar.style.textShadow = "0 10px 22px rgba(0,0,0,0.68)";
            }catch(e){}

            try{
              Array.from(bar.querySelectorAll("button, a")).forEach(b=>{
                const txt = (b.textContent||"").trim();
                if(/é–å®š|è§£é–/.test(txt)){
                  b.style.display = "none";
                }else{
                  b.style.borderRadius = "999px";
                  b.style.border = "1px solid rgba(255,244,210,0.36)";
                  b.style.background = "rgba(0,0,0,0.28)";
                  b.style.color = "rgba(255,255,255,0.96)";
                  b.style.padding = "6px 10px";
                  b.style.boxShadow = "0 10px 22px rgba(0,0,0,0.24)";
                  b.style.webkitTextStroke = "1.10px rgba(0,0,0,0.90)";
                  b.style.textShadow = "0 10px 18px rgba(0,0,0,0.66)";
                }
              });
            }catch(e){}

            function fixText(){
              try{
                const leafs = Array.from(bar.querySelectorAll("*"))
                  .filter(x => x.childElementCount === 0 && (x.textContent||"").includes("é›²ç«¯"));
                const statusEl = leafs.sort((a,b)=>(a.textContent||"").length - (b.textContent||"").length)[0] || bar;

                let t = String(statusEl.textContent || "");
                if(t.includes("é–å®šå¤±æ•—")) t = t.replaceAll("é–å®šå¤±æ•—", "è‡ªå‹•åˆä½µ");
                if(t.includes("åŒæ­¥å¤±æ•—")) t = t.replaceAll("åŒæ­¥å¤±æ•—", "é›¢ç·šï¼ˆå¯æŒ‰åŒæ­¥é‡è©¦ï¼‰");
                statusEl.textContent = t;
              }catch(e){}
            }

            fixText();

            try{
              const mo = new MutationObserver(()=>fixText());
              mo.observe(bar, { childList:true, characterData:true, subtree:true });
            }catch(e){}
          }

          (function loop(){
            WANT.tried++;
            const bar = findBar();
            if(bar){ sanitize(bar); return; }
            if(WANT.tried < MAX_TRY){
              setTimeout(loop, 220);
            }
          })();
        }

        function loadScriptOnce(src){
          return new Promise((resolve)=>{
            try{
              const id = "tasunScript__" + src;
              if(document.getElementById(id)) return resolve(true);
              const s = document.createElement("script");
              s.id = id;
              s.src = src;
              s.async = true;
              s.onload = ()=>resolve(true);
              s.onerror = ()=>resolve(false);
              document.head.appendChild(s);
            }catch(e){
              resolve(false);
            }
          });
        }

        function hrefToDom(href){
          const h = String(href || "").trim();
          if(!h) return "#";
          if(/^https?:\/\//i.test(h)) return h;
          if(/^mailto:/i.test(h)) return h;
          return withV(encodeURI(h));
        }
        function labelToFile(label){
          let s = String(label || "").trim();
          if(!s) return "#";
          if(s.endsWith(".html")) return s;
          s = s.replace(/[\\\/:*?"<>|]/g, "").trim();
          s = s.replace(/\s+/g, "");
          return s + ".html";
        }

        function shouldIncludeKey(k){
          const key = String(k || "");
          return (
            key.startsWith("tasun") ||
            key.includes("æ±æ±") ||
            key.includes("æ·é‹") ||
            key.includes("æ°´ç’°") ||
            key.includes("å¯©æŸ¥") ||
            key.includes("æ–‡ä»¶") ||
            key.includes("è³‡æ–™åº«")
          );
        }

        function collectBackupPayload(reason){
          const now = new Date();
          const keys = [];
          for(let i=0;i<localStorage.length;i++){
            const k = localStorage.key(i);
            if(shouldIncludeKey(k)) keys.push(k);
          }
          keys.sort((a,b)=>a.localeCompare(b, "zh-Hant"));

          const data = {};
          keys.forEach(k => {
            const raw = localStorage.getItem(k);
            const parsed = safeJsonParse(raw, null);
            data[k] = (parsed === null && raw !== "null" && raw !== null) ? raw : parsed;
          });

          const sess = safeJsonParse(sessionStorage.getItem(SESSION_KEY) || "null", null);

          return {
            meta: {
              app: "Tasun index.html",
              reason: String(reason || "manual"),
              ts: now.toISOString(),
              href: location.href,
              cacheV: (window.__CACHE_V || "")
            },
            session: sess,
            data
          };
        }

        function storeBackupRing(payload){
          try{
            const arr = safeJsonParse(localStorage.getItem(BACKUP_RING_KEY) || "[]", []);
            const next = Array.isArray(arr) ? arr : [];
            next.unshift(payload);
            next.length = Math.min(next.length, BACKUP_RING_MAX);
            localStorage.setItem(BACKUP_RING_KEY, JSON.stringify(next));
          }catch(e){}
        }

        function downloadJson(payload){
          const ts = new Date().toISOString().replace(/[:.]/g, "-");
          const filename = `Tasunå‚™ä»½_${ts}.json`;
          const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json;charset=utf-8" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          a.style.display = "none";
          document.body.appendChild(a);
          a.click();
          setTimeout(() => {
            URL.revokeObjectURL(url);
            a.remove();
          }, 0);
        }

        let _exportTimer = 0;
        let _pendingReason = "";
        let _exportOnceExit = false;

        function exportBackupNow(reason, opts){
          const o = opts || {};
          const payload = collectBackupPayload(reason);
          storeBackupRing(payload);
          if(o.download){
            try{ downloadJson(payload); }catch(e){}
          }
        }

        function scheduleExport(reason){
          const r = String(reason || "auto");
          _pendingReason = _pendingReason ? (_pendingReason + " | " + r) : r;
          clearTimeout(_exportTimer);
          _exportTimer = setTimeout(() => {
            const rr = _pendingReason || "auto";
            _pendingReason = "";
            exportBackupNow(rr, { download:false });
          }, 350);
        }

        function tryExportOnExit(){
          if(_exportOnceExit) return;
          _exportOnceExit = true;
          exportBackupNow("exit/pagehide", { download:false });
        }

        function buildCloudPayloadFromLocal(){
          const rows = [];
          const keys = CLOUD_KEYS.slice().sort((a,b)=>a.localeCompare(b,"zh-Hant"));
          keys.forEach((k, idx)=>{
            const raw = localStorage.getItem(k);
            rows.push({ k, id: idx + 1, v: (raw == null ? "" : String(raw)) });
          });
          return { db: rows, counter: rows.length };
        }

        function scheduleCloudSave(reason, readOnly){
          if(readOnly) return;
          if(!cloudCtrl || typeof cloudCtrl.saveMerged !== "function") return;
          if(cloudApplying) return;

          clearTimeout(cloudSaveTimer);
          cloudSaveTimer = setTimeout(()=>{
            Promise.resolve(cloudCtrl.saveMerged({ lock: false, mode: "merge" })).catch(()=>{});
          }, 650);
        }

        let _cloudRetryTimer = 0;
        function startCloudSelfHeal(){
          if(_cloudRetryTimer) return;
          _cloudRetryTimer = setInterval(()=>{
            if(!cloudCtrl || typeof cloudCtrl.pullNow !== "function") return;
            Promise.resolve(cloudCtrl.pullNow()).catch(()=>{});
          }, 30000);

          window.addEventListener("online", ()=>{
            try{ cloudCtrl && cloudCtrl.pullNow && cloudCtrl.pullNow().catch(()=>{}); }catch(e){}
          }, { passive:true });

          document.addEventListener("visibilitychange", ()=>{
            if(document.visibilityState === "visible"){
              try{ cloudCtrl && cloudCtrl.pullNow && cloudCtrl.pullNow().catch(()=>{}); }catch(e){}
            }
          }, { passive:true });
        }

        async function mountCloudKitForUser(user){
          if(cloudMounted) return;
          cloudMounted = true;

          const role = String(user?.level || "read").toLowerCase();
          const readOnly = (role === "read");

          const ok = await loadScriptOnce(withV("tasun-cloud-kit.js"));
          if(!ok || !window.TasunCloudKit || typeof window.TasunCloudKit.mount !== "function"){
            return;
          }

          try{
            window.TasunCore = window.TasunCore || {};
            window.TasunCore.Auth = window.TasunCore.Auth || {};
            window.TasunCore.Auth.current = function(){
              return { username: String(user?.username || ""), role: String(user?.level || "") };
            };
          }catch(e){}

          try{
            window.TasunCloudKit.init({
              appVer: window.TASUN_APP_VER || "",
              resourcesUrl: withV(CLOUD_RES_URL),
              ui: {
                enabled: true,
                hideLockButtons: true,
                position: "bottom-right"
              },
              lock: { enabled:false, auto:false }
            });

            cloudCtrl = window.TasunCloudKit.mount({
              resourceKey: CLOUD_RESOURCE_KEY,
              pk: "k",
              idField: "id",
              counterField: "counter",
              merge: { conflictPolicy: "stash-remote", lock: "none" },
              watch: { intervalSec: 10 },
              getLocal: () => buildCloudPayloadFromLocal(),
              apply: (payload) => {
                if(!payload || !Array.isArray(payload.db)) return;

                cloudApplying = true;
                try{
                  payload.db.forEach(row=>{
                    const k = String(row?.k || "").trim();
                    if(!k || !CLOUD_KEY_SET.has(k)) return;
                    const v = (row?.v == null) ? "" : String(row.v);
                    if(localStorage.getItem(k) !== v){
                      localStorage.setItem(k, v);
                    }
                  });
                }finally{
                  cloudApplying = false;
                }

                try{
                  ROUTES = loadRoutes();
                  NAV_ARR = loadNavButtonsSeedIfMissing();
                  AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
                  buildMainButtonsDOM();
                  if(CURRENT_USER){
                    refreshButtonsForCurrentUser();
                  }else{
                    resetButtonsForLogout();
                  }
                  scheduleAll();
                }catch(e){}
              }
            });

            try{ cloudCtrl.pullNow && cloudCtrl.pullNow().catch(()=>{}); }catch(e){}
            cloudCtrl.__readOnly__ = readOnly;

            patchCloudUiBarAuto();
            startCloudSelfHeal();

          }catch(e){}
        }

        (function patchLocalStorageOnce(){
          try{
            if(localStorage.__tasun_patched__) return;
            Object.defineProperty(localStorage, "__tasun_patched__", { value: true, enumerable:false });

            const _set = localStorage.setItem.bind(localStorage);
            const _remove = localStorage.removeItem.bind(localStorage);

            localStorage.setItem = function(k, v){
              _set(k, v);
              if(shouldIncludeKey(k)) scheduleExport("save:setItem:" + k);

              if(CLOUD_KEY_SET.has(String(k))){
                const ro = !!(cloudCtrl && cloudCtrl.__readOnly__);
                scheduleCloudSave("cloud:setItem:" + k, ro);
              }
            };
            localStorage.removeItem = function(k){
              _remove(k);
              if(shouldIncludeKey(k)) scheduleExport("save:removeItem:" + k);

              if(CLOUD_KEY_SET.has(String(k))){
                const ro = !!(cloudCtrl && cloudCtrl.__readOnly__);
                scheduleCloudSave("cloud:removeItem:" + k, ro);
              }
            };
          }catch(e){}
        })();

        window.addEventListener("storage", (e) => {
          if(!e || !e.key) return;
          if(shouldIncludeKey(e.key)) scheduleExport("storage:" + e.key);
        });

        window.addEventListener("pagehide", tryExportOnExit, { passive:true });
        document.addEventListener("visibilitychange", () => {
          if(document.visibilityState === "hidden") tryExportOnExit();
        }, { passive:true });

        function applyFixedRoutes(obj){
          const out = (obj && typeof obj === "object") ? { ...obj } : {};
          Object.keys(FIXED_ROUTES).forEach(k => { out[k] = FIXED_ROUTES[k]; });
          out[METRO_ID] = METRO_HREF;
          out["systemBtn"] = out["systemBtn"] || "æ¬Šé™è¡¨.html";
          return out;
        }

        function loadRoutes(){
          const seed = applyFixedRoutes({
            "btn3": "https://www.dropbox.com/",
            "systemBtn": "æ¬Šé™è¡¨.html",
            [METRO_ID]: METRO_HREF
          });

          const raw = localStorage.getItem(ROUTE_KEY);
          if(!raw){
            localStorage.setItem(ROUTE_KEY, JSON.stringify(seed, null, 2));
            return seed;
          }

          const parsed = safeJsonParse(raw, null);
          const base = (parsed && typeof parsed === "object") ? parsed : {};
          const merged = applyFixedRoutes({ ...base, ...seed });

          if(JSON.stringify(base) !== JSON.stringify(merged)){
            localStorage.setItem(ROUTE_KEY, JSON.stringify(merged, null, 2));
          }
          return merged;
        }

        function loadNavButtonsSeedIfMissing(){
          const seed = [
            { id:"btn1", label:"è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨" },
            { id:"btn2", label:"æ·é‹æ±æ­¢æ±æ¹–ç·š" },
            { id:"btn3", label:"é›²ç«¯æª”æ¡ˆ" },
            { id:"btn4", label:"å·¥ç¨‹è³‡æ–™åº«" },
            { id:"btn5", label:"è³‡æ–™åº«" }
          ];
          const raw = localStorage.getItem(NAV_KEY);
          if(!raw){
            localStorage.setItem(NAV_KEY, JSON.stringify(seed));
            return seed;
          }
          const arr = safeJsonParse(raw, null);
          if(Array.isArray(arr) && arr.length) return arr;
          localStorage.setItem(NAV_KEY, JSON.stringify(seed));
          return seed;
        }

        function resolveHref(cfg, routes){
          const id = String(cfg?.id || "").trim();
          const label = String(cfg?.label || "").trim();

          if(label && FIXED_ROUTES[label]) return FIXED_ROUTES[label];
          if(id === METRO_ID) return METRO_HREF;
          if(routes && routes[id]) return routes[id];
          if(routes && label && routes[label]) return routes[label];

          const guess = labelToFile(label);
          if(FIXED_ROUTES[guess]) return FIXED_ROUTES[guess];
          return guess;
        }

        function getDefaultAuthTableLegacy(btnCount){
          const keys = Array.from({length: btnCount}, (_, i) => `btn${i+1}`);
          const mkAll = () => Object.fromEntries(keys.map(k => [k, true]));
          const mkOnlyLast = () => Object.fromEntries(keys.map((k, i) => [k, i === btnCount - 1]));
          return [
            { user:"alex",  pass:"Tasun08040224", role:"admin", ...mkAll() },
            { user:"JOYCE", pass:"09220224",      role:"admin", ...mkAll() },
            { user:"tasun", pass:"tasun08040224", role:"write", ...mkAll() },
            { user:"wu",    pass:"123456",        role:"read",  ...mkOnlyLast() }
          ];
        }

        function normalizeRowFromStorage(row, btnCount){
          const username = (row?.username ?? row?.user ?? row?.name ?? row?.account ?? "").toString().trim();
          const password = (row?.password ?? row?.pass ?? "").toString();
          const level    = (row?.level ?? row?.role ?? "read").toString().trim().toLowerCase();

          const buttons = [];
          for(let i=0;i<btnCount;i++){
            const k = `btn${i+1}`;
            buttons[i] = !!row?.[k];
          }
          return { username, password, level, buttons };
        }

        function loadAuthTable(btnCount){
          const raw = localStorage.getItem(AUTH_KEY);
          if(!raw){
            const legacy = getDefaultAuthTableLegacy(btnCount);
            localStorage.setItem(AUTH_KEY, JSON.stringify(legacy));
            return legacy.map(r => normalizeRowFromStorage(r, btnCount));
          }
          const parsed = safeJsonParse(raw, null);
          const arr = Array.isArray(parsed) ? parsed : (parsed && Array.isArray(parsed.users) ? parsed.users : null);
          if(Array.isArray(arr)){
            const mapped = arr.map(r => normalizeRowFromStorage(r, btnCount)).filter(x => x.username);
            if(mapped.length) return mapped;
          }
          const legacy = getDefaultAuthTableLegacy(btnCount);
          localStorage.setItem(AUTH_KEY, JSON.stringify(legacy));
          return legacy.map(r => normalizeRowFromStorage(r, btnCount));
        }

        function setSession(user){
          try{ sessionStorage.setItem(SESSION_KEY, JSON.stringify({ user: user.username, role: user.level, t: Date.now() })); }catch(e){}
        }
        function clearSession(){ try{ sessionStorage.removeItem(SESSION_KEY); }catch(e){} }
        function getSession(){
          const obj = safeJsonParse(sessionStorage.getItem(SESSION_KEY) || "null", null);
          if(!obj || typeof obj !== "object") return null;
          const u = String(obj.user || "").trim();
          const r = String(obj.role || "").trim().toLowerCase();
          if(!u) return null;
          return { user: u, role: r, t: Number(obj.t || 0) };
        }

        function fitButtonHeights(btns, baseH){
          btns.forEach(btn => {
            const span = btn.querySelector("span");
            if(!span) return;
            btn.style.height = "auto";
            const need = Math.ceil(span.scrollHeight + 34); /* âœ…(2) çµ¦å­—æ›´å¤šå‘¼å¸ç©ºé–“ */
            const h = Math.max(baseH, need);
            btn.style.height = h + "px";
          });
        }

        /* âœ…(2) æ”¾å¤§ç­–ç•¥ï¼šç”¨ã€Œé«˜åº¦/3.1ã€ç•¶åŸºæº–ï¼ˆåŸæœ¬å¤ªå°ï¼‰ */
        function setButtonFontScale(btn, w, h){
          const span = btn.querySelector("span");
          if(!span) return;

          const ww = Math.max(1, w);
          const hh = Math.max(1, h);

          let fs = hh / 3.10;
          if(span.classList.contains("latin")) fs *= 0.96;

          fs = clamp(fs, 16, 36);
          btn.style.setProperty("--btn-fs", `${Math.round(fs)}px`);

          for(let i=0;i<6;i++){
            const sw = span.scrollWidth;
            const sh = span.scrollHeight;
            if(sw <= ww * 0.92 && sh <= hh * 0.76) break;

            fs = Math.max(15, fs - 1.6);
            btn.style.setProperty("--btn-fs", `${Math.round(fs)}px`);
          }
        }

        function isVisibleEl(el){
          if(!el) return false;
          const cs = getComputedStyle(el);
          if(cs.display === "none" || cs.visibility === "hidden" || cs.opacity === "0") return false;
          const r = el.getBoundingClientRect();
          return r.width > 0 && r.height > 0;
        }

        function getVVBottomInset(){
          try{
            const vv = window.visualViewport;
            if(!vv) return 0;
            return Math.max(0, window.innerHeight - (vv.height + vv.offsetTop));
          }catch(e){ return 0; }
        }

        let BTN_CONFIGS = [];
        let mainNavBtns = [];
        let AUTH_TABLE = [];
        let ROUTES = loadRoutes();
        let NAV_ARR = loadNavButtonsSeedIfMissing();

        const ROLE_MAP = {
          "btn1": ["admin","write","read"],
          "btn2": ["admin","write","read"],
          "btn3": ["admin","write","read"],
          "btn4": ["admin","write"],
          "btn5": ["admin","write","read"],
          "systemBtn": ["admin"]
        };

        const SYSTEM_BTN = { id:"systemBtn", label:"ç³»çµ± / æ¬Šé™", roles:["admin"] };

        function isRoleAllowed(cfg, level){
          if(!cfg || !Array.isArray(cfg.roles)) return true;
          return cfg.roles.includes(level);
        }
        function isAllowedByAuth(user, cfg){
          if(cfg && cfg.id === "systemBtn") return true;
          const flags = Array.isArray(user.buttons) ? user.buttons : [];
          const m = String(cfg?.id || "").match(/^btn(\d+)$/i);
          if(!m) return true;
          const idx = parseInt(m[1], 10) - 1;
          return (flags[idx] === undefined) ? true : !!flags[idx];
        }

        function buildMainButtonsDOM(){
          ROUTES = loadRoutes();
          NAV_ARR = loadNavButtonsSeedIfMissing();

          BTN_CONFIGS = NAV_ARR.map(x => {
            const id = String(x?.id || "").trim();
            const label = String(x?.label || "").trim();
            const roles = ROLE_MAP[id] || ["admin","write","read"];
            const target = (id === "btn3") ? "_blank" : "";
            return { id, label, roles, target };
          }).concat([SYSTEM_BTN]);

          mainNavBtns = [];
          navArea.innerHTML = "";

          BTN_CONFIGS.forEach((cfg) => {
            const a = document.createElement("a");
            a.className = "nav-btn";
            a.id = cfg.id || "";

            const span = document.createElement("span");
            span.textContent = cfg.label;

            const hasLatin = /[A-Za-z]/.test(span.textContent);
            const hasCJK   = /[\u3400-\u9FFF]/.test(span.textContent);
            if(hasLatin) span.classList.add("latin");
            if(hasLatin && !hasCJK) span.classList.add("latin-only");

            a.appendChild(span);

            const finalHref = resolveHref(cfg, ROUTES);
            a.setAttribute("href", hrefToDom(finalHref));

            const t = cfg.target || "";
            if(t){
              a.target = t;
              if(t === "_blank") a.rel = "noopener noreferrer";
            }

            a.style.display = "none";
            navArea.appendChild(a);
            mainNavBtns.push(a);
          });
        }

        function resetButtonsForLogout(){
          mainNavBtns.forEach(btn => btn.style.display = "none");
          navArea.classList.remove("stack","sides");
          scheduleAll();
        }

        function refreshButtonsForCurrentUser(){
          if(!CURRENT_USER) return;

          mainNavBtns.forEach((btn, index) => {
            const cfg = BTN_CONFIGS[index];
            const okRole = isRoleAllowed(cfg, CURRENT_USER.level);
            const okAuth = isAllowedByAuth(CURRENT_USER, cfg);

            btn.style.display = (okRole && okAuth) ? "flex" : "none";

            const finalHref = resolveHref(cfg, ROUTES);
            btn.setAttribute("href", hrefToDom(finalHref));
          });

          scheduleAll();
        }

        /* =========================
           âœ…(æ•ˆèƒ½) æ–‡å­—äº®åº¦ã€Œè¼•é‡è‡ªé©æ‡‰ã€
           - åªåœ¨ã€Œåœ–è¼‰å…¥/è¦–çª—å°ºå¯¸è®Šæ›´ã€æ™‚é‡ç®—ä¸€æ¬¡
           - ä¸å†å°æ¯é¡†æŒ‰éµåš getImageDataï¼ˆé¿å…åƒè¨˜æ†¶é«”/å¡æ­»ï¼‰
           ========================= */
        let _toneCanvas = null;
        let _toneCtx = null;
        let _toneDirty = true;
        let _tone = { top:0.42, left:0.42, right:0.42, bottom:0.42 };

        function ensureToneCanvas(){
          if(_toneCanvas && _toneCtx) return true;
          try{
            _toneCanvas = document.createElement("canvas");
            _toneCanvas.width = 64;
            _toneCanvas.height = 64;
            _toneCtx = _toneCanvas.getContext("2d", { willReadFrequently:true });
            return !!_toneCtx;
          }catch(e){
            _toneCanvas = null; _toneCtx = null;
            return false;
          }
        }

        function computeToneIfNeeded(){
          if(!_toneDirty) return;
          _toneDirty = false;

          try{
            if(!zenImg || !zenImg.complete || !zenImg.naturalWidth) return;
            if(!ensureToneCanvas()) return;

            const cw = _toneCanvas.width, ch = _toneCanvas.height;
            _toneCtx.clearRect(0,0,cw,ch);
            _toneCtx.drawImage(zenImg, 0, 0, cw, ch);

            const img = _toneCtx.getImageData(0,0,cw,ch).data;

            function lumAt(px, py){
              const x = Math.max(0, Math.min(cw-1, px|0));
              const y = Math.max(0, Math.min(ch-1, py|0));
              const i = (y*cw + x)*4;
              const r = img[i], g = img[i+1], b = img[i+2];
              return (0.2126*r + 0.7152*g + 0.0722*b) / 255;
            }

            _tone.top    = (lumAt(32,10) + lumAt(20,12) + lumAt(44,12)) / 3;
            _tone.left   = (lumAt(16,34) + lumAt(18,40) + lumAt(20,30)) / 3;
            _tone.right  = (lumAt(48,34) + lumAt(46,40) + lumAt(44,30)) / 3;
            _tone.bottom = (lumAt(32,54) + lumAt(26,52) + lumAt(38,52)) / 3;
          }catch(e){}
        }

        function applyBtnContrast(btn, lum){
          // èƒŒæ™¯è¶Šäº® â†’ å¢Šç‰‡æ›´ä¸é€æ˜ã€æé‚Šæ›´å¼·
          const bright = lum >= 0.58;
          btn.style.setProperty("--btn-text", "rgba(255,255,255,0.999)");
          btn.style.setProperty("--btn-stroke", bright ? "rgba(0,0,0,0.98)" : "rgba(0,0,0,0.94)");
          btn.style.setProperty("--btn-stroke-w", bright ? "2.15px" : "2.05px");
          btn.style.setProperty("--btn-shadowA", bright ? "rgba(0,0,0,0.92)" : "rgba(0,0,0,0.88)");
          btn.style.setProperty("--btn-text-plate-op", bright ? "0.44" : "0.34");
        }

        function applyUiContrastByTop(){
          // è®“ã€Œä½¿ç”¨è€…åˆ—/æ¨™é¡Œã€åœ¨äº®èƒŒæ™¯ä»æ¸…æ¥š
          const bright = _tone.top >= 0.58;
          try{
            if(userBar){
              userBar.dataset.tone = bright ? "light" : "dark";
            }
          }catch(e){}
          try{
            if(titleWrap){
              titleWrap.dataset.tone = bright ? "light" : "dark";
            }
          }catch(e){}
        }

        function applyAdaptiveTonesLite(){
          computeToneIfNeeded();

          applyUiContrastByTop();

          if(!navArea) return;
          const rect = navArea.getBoundingClientRect();
          const midX = rect.left + rect.width/2;

          mainNavBtns.forEach(btn=>{
            if(btn.style.display === "none") return;
            const r = btn.getBoundingClientRect();
            const cx = r.left + r.width/2;
            const lum = (cx < midX) ? _tone.left : _tone.right;
            applyBtnContrast(btn, lum);
          });
        }

        function layoutButtons(){
          if(!navArea) return;

          const rect = navArea.getBoundingClientRect();
          const H = Math.max(1, rect.height);
          const W = Math.max(1, rect.width);

          const visible = mainNavBtns.filter(b => b.style.display !== "none");
          if(!visible.length) return;

          navArea.style.paddingTop = "";
          navArea.style.paddingBottom = "";
          navArea.style.paddingLeft = "";
          navArea.style.paddingRight = "";
          navArea.style.gap = "";
          navArea.style.overflow = "";

          const isMobile = window.matchMedia("(max-width: 900px)").matches;

          if(isMobile || W < 980){
            navArea.classList.remove("sides");
            navArea.classList.add("stack");

            const vvBottom = getVVBottomInset();

            const ub = userBar ? userBar.getBoundingClientRect() : null;
            const tw = titleWrap ? titleWrap.getBoundingClientRect() : null;
            const ax = zwTopAxis ? zwTopAxis.getBoundingClientRect() : null;
            const bl = zwBottomLine ? zwBottomLine.getBoundingClientRect() : null;

            let topSafe = Math.max(
              112,
              ub ? (ub.bottom - rect.top) + 16 : 0,
              tw ? (tw.bottom - rect.top) + 16 : 0,
              ax ? (ax.bottom - rect.top) + 16 : 0
            );

            let bottomSafe = H - Math.max(16, 10 + vvBottom);
            if(bl){
              bottomSafe = Math.min(bottomSafe, (bl.top - rect.top) - 12);
            }

            bottomSafe = Math.max(bottomSafe, topSafe + 140);
            const avail = Math.max(1, bottomSafe - topSafe);

            const padX = clamp(W * 0.04, 14, 28);
            navArea.style.paddingLeft = Math.round(padX) + "px";
            navArea.style.paddingRight = Math.round(padX) + "px";

            const scales = [1.00, 0.94, 0.88, 0.82, 0.76, 0.70, 0.64, 0.58];
            let chosen = null;

            function measureTotal(gap){
              const hs = visible.map(b => b.getBoundingClientRect().height || 52);
              return hs.reduce((a,b)=>a+b,0) + gap * (visible.length - 1);
            }

            for(const s of scales){
              const gapY = clamp(14 * s, 8, 14);
              const baseH = clamp(86 * s, 52, 88); /* âœ…(2) æ”¾å¤§ */

              navArea.style.gap = Math.round(gapY) + "px";

              visible.forEach(btn=>{
                btn.style.width = "100%";
                btn.style.left = "";
                btn.style.right = "";
                btn.style.top = "";
                btn.style.height = baseH + "px";
              });

              fitButtonHeights(visible, baseH);

              visible.forEach(btn=>{
                const br = btn.getBoundingClientRect();
                setButtonFontScale(btn, br.width || (W - padX*2), br.height || baseH);
              });

              const total = measureTotal(Math.round(gapY));
              if(total <= avail){
                chosen = { s, gapY: Math.round(gapY), total };
                break;
              }
            }

            if(!chosen){
              const gapY = 8;
              const baseH = 52;

              navArea.style.gap = gapY + "px";
              visible.forEach(btn=>{
                btn.style.width = "100%";
                btn.style.height = baseH + "px";
              });
              fitButtonHeights(visible, baseH);
              visible.forEach(btn=>{
                const br = btn.getBoundingClientRect();
                setButtonFontScale(btn, br.width || (W - padX*2), br.height || baseH);
              });

              const total = measureTotal(gapY);
              if(total > avail + 8){
                navArea.style.overflow = "auto";
              }else{
                navArea.style.overflow = "hidden";
              }
              chosen = { s: 0.58, gapY, total };
            }else{
              navArea.style.overflow = "hidden";
            }

            const slack = Math.max(0, avail - (chosen.total || 0));
            const pushDown = Math.min(32, Math.round(slack * 0.18));

            navArea.style.paddingTop = Math.round(topSafe + pushDown) + "px";
            navArea.style.paddingBottom = Math.round(H - bottomSafe) + "px";

            return;
          }

          navArea.classList.remove("stack");
          navArea.classList.add("sides");

          const left = [];
          const right = [];
          visible.forEach((btn, i) => (i % 2 === 0 ? left : right).push(btn));

          const ub = userBar ? userBar.getBoundingClientRect() : null;
          const tw = titleWrap ? titleWrap.getBoundingClientRect() : null;
          const ax = zwTopAxis ? zwTopAxis.getBoundingClientRect() : null;
          const bl = zwBottomLine ? zwBottomLine.getBoundingClientRect() : null;

          const topSafe = Math.max(
            86,
            ub ? (ub.bottom - rect.top) + 18 : 0,
            tw ? (tw.bottom - rect.top) + 20 : 0,
            ax ? (ax.bottom - rect.top) + 20 : 0
          );

          let bottomSafe = H - clamp(H * 0.12, 92, 150);
          if(bl){
            bottomSafe = Math.min(bottomSafe, (bl.top - rect.top) - 12);
          }
          bottomSafe = Math.max(bottomSafe, topSafe + 170);

          const edgePad = 32;
          const gapToZen = 22;

          const lz = isVisibleEl(zwLeft) ? zwLeft.getBoundingClientRect() : null;
          const rz = isVisibleEl(zwRight) ? zwRight.getBoundingClientRect() : null;

          let corridorLeft = (lz ? (lz.right - rect.left) : (W * 0.44)) + gapToZen;
          let corridorRight = (rz ? (rz.left - rect.left) : (W * 0.56)) - gapToZen;

          corridorLeft = clamp(corridorLeft, W * 0.34, W * 0.49);
          corridorRight = clamp(corridorRight, W * 0.51, W * 0.66);

          const leftAreaL = edgePad;
          const leftAreaR = Math.max(leftAreaL + 10, corridorLeft - edgePad);
          const rightAreaL = Math.min(W - edgePad - 10, corridorRight + edgePad);
          const rightAreaR = W - edgePad;

          const leftAvailW = Math.max(0, leftAreaR - leftAreaL);
          const rightAvailW = Math.max(0, rightAreaR - rightAreaL);

          if(leftAvailW < 260 || rightAvailW < 260){
            navArea.classList.remove("sides");
            navArea.classList.add("stack");
            return;
          }

          const availY = Math.max(1, bottomSafe - topSafe);

          const baseH0 = clamp(H * 0.118, 74, 112); /* âœ…(2) æ”¾å¤§ */
          const gapY0  = clamp(H * 0.050, 16, 26);

          const wTarget = clamp(W * 0.24, 340, 560);

          function applySideWidths(scale){
            const s = clamp(scale, 0.72, 1.0);

            const wL = Math.min(leftAvailW - 4, Math.round(wTarget * s));
            const wR = Math.min(rightAvailW - 4, Math.round(wTarget * s));

            left.forEach(btn => { btn.style.width = wL + "px"; });
            right.forEach(btn => { btn.style.width = wR + "px"; });

            const baseH = Math.max(64, Math.round(baseH0 * s));
            fitButtonHeights(visible, baseH);

            visible.forEach(btn=>{
              const bw = btn.getBoundingClientRect().width || wTarget;
              const bh = btn.getBoundingClientRect().height || baseH;
              setButtonFontScale(btn, bw, bh);
            });

            return { wL, wR, baseH, gapY: Math.max(14, Math.round(gapY0 * s)) };
          }

          function totalHeight(btns, gapY){
            if(!btns.length) return 0;
            const hs = btns.map(b => (b.getBoundingClientRect().height || baseH0));
            return hs.reduce((a,b)=>a+b,0) + gapY * (btns.length - 1);
          }

          function placeSide(btns, side, width, gapY){
            if(!btns.length) return true;

            const total = totalHeight(btns, gapY);
            if(total > availY) return false;

            const yStart = topSafe + Math.max(0, Math.min((availY - total) * 0.22, 52));
            let y = yStart;

            let x;
            if(side === "L"){
              x = leftAreaL + Math.max(0, (leftAvailW - width) * 0.5);
            }else{
              x = rightAreaL + Math.max(0, (rightAvailW - width) * 0.5);
            }

            for(const btn of btns){
              const bh = btn.getBoundingClientRect().height || baseH0;

              btn.style.left = (side === "L") ? (Math.round(x) + "px") : "";
              btn.style.right = (side === "R") ? (Math.round(W - (x + width)) + "px") : "";
              btn.style.top = Math.round(y) + "px";

              y += bh + gapY;
            }
            return true;
          }

          const scales = [1.00, 0.94, 0.88, 0.82, 0.76];
          let placed = false;

          for(const s of scales){
            const m = applySideWidths(s);

            const need = Math.max(totalHeight(left, m.gapY), totalHeight(right, m.gapY));
            if(need > availY) continue;

            const okL = placeSide(left, "L", m.wL, m.gapY);
            const okR = placeSide(right, "R", m.wR, m.gapY);
            if(okL && okR){ placed = true; break; }
          }

          if(!placed){
            navArea.classList.remove("sides");
            navArea.classList.add("stack");
            visible.forEach(btn=>{
              btn.style.left = "";
              btn.style.right = "";
              btn.style.top = "";
            });
          }
        }

        /* =========================
           Username pickerï¼ˆåŸåŠŸèƒ½ä¿ç•™ï¼‰
           ========================= */
        let _userActiveIndex = -1;
        let _typeBuf = "";
        let _typeTimer = 0;

        function menuItems(){ return Array.from(usernameMenu ? usernameMenu.querySelectorAll(".select-option") : []); }
        function isMenuOpen(){ return !!(usernameMenu && usernameMenu.classList.contains("open")); }
        function closeUsernameMenu(){
          if(!usernameMenu) return;
          usernameMenu.classList.remove("open");
          if(usernameDisplay) usernameDisplay.setAttribute("aria-expanded", "false");
          _userActiveIndex = -1;
          _typeBuf = "";
        }
        function openUsernameMenu(){
          if(!usernameMenu || !usernameDisplay) return;
          if(usernameDisplay.disabled) return;

          usernameMenu.classList.add("open");
          usernameDisplay.setAttribute("aria-expanded", "true");

          const items = menuItems();
          if(!items.length) return;

          const idx = items.findIndex(it => (it.dataset.value || "") === (usernameSel.value || ""));
          setActiveIndex(idx >= 0 ? idx : 0, true);
        }
        function toggleUsernameMenu(){ if(isMenuOpen()) closeUsernameMenu(); else openUsernameMenu(); }

        function syncUsernameDisplay(){
          if(!usernameSel || !usernameDisplay) return;
          const opt = usernameSel.options[usernameSel.selectedIndex];
          const txt = opt ? String(opt.textContent || "").trim() : "";
          if(!txt || (opt && opt.disabled)) usernameDisplay.textContent = "è«‹é¸æ“‡ä½¿ç”¨è€…";
          else usernameDisplay.textContent = txt;
        }

        function selectByValue(val){
          if(!val) return;
          usernameSel.value = val;
          syncUsernameDisplay();
          const items = menuItems();
          items.forEach(it => it.setAttribute("aria-selected", (it.dataset.value === val) ? "true" : "false"));
        }

        function setActiveIndex(nextIndex, scrollIntoView){
          const items = menuItems();
          if(!items.length) { _userActiveIndex = -1; return; }

          const n = items.length;
          let idx = nextIndex;
          if(idx < 0) idx = 0;
          if(idx >= n) idx = n - 1;

          _userActiveIndex = idx;
          items.forEach((it, i) => it.classList.toggle("active", i === idx));

          if(scrollIntoView){
            try{ items[idx].scrollIntoView({ block:"nearest" }); }catch(e){}
          }
        }

        function buildUsernameMenu(){
          if(!usernameMenu || !usernameSel || !usernameDisplay) return;
          usernameMenu.innerHTML = "";

          const opts = Array.from(usernameSel.options || []);
          const usable = opts.filter(o => !o.disabled && String(o.value||"").trim());

          if(!usable.length){
            usernameDisplay.textContent = "ï¼ˆå°šç„¡ä½¿ç”¨è€…ï¼Œè«‹å…ˆåˆ°ã€Œç³»çµ± / æ¬Šé™ã€æ–°å¢ï¼‰";
            usernameDisplay.disabled = true;
            closeUsernameMenu();
            return;
          }

          usernameDisplay.disabled = false;

          usable.forEach((o, i) => {
            const item = document.createElement("div");
            item.className = "select-option";
            item.setAttribute("role", "option");
            item.dataset.value = o.value;
            item.textContent = o.textContent;

            const selected = (o.value === usernameSel.value);
            item.setAttribute("aria-selected", selected ? "true" : "false");

            item.addEventListener("mouseenter", () => { if(isMenuOpen()) setActiveIndex(i, false); });
            item.addEventListener("click", () => {
              selectByValue(o.value);
              closeUsernameMenu();
              usernameDisplay.focus();
            });

            usernameMenu.appendChild(item);
          });
        }

        function refreshUsernamePicker(){
          if(!usernameSel) return;

          const opt = usernameSel.options[usernameSel.selectedIndex];
          if(opt && opt.disabled){
            const first = Array.from(usernameSel.options).find(o => !o.disabled && String(o.value||"").trim());
            if(first) usernameSel.value = first.value;
          }

          syncUsernameDisplay();
          buildUsernameMenu();
        }

        if(usernameDisplay){
          usernameDisplay.addEventListener("click", toggleUsernameMenu);

          usernameDisplay.addEventListener("keydown", (e) => {
            if(usernameDisplay.disabled) return;

            const key = e.key;

            if(key === "ArrowDown" || key === "ArrowUp"){
              e.preventDefault();
              if(!isMenuOpen()) openUsernameMenu();
              const items = menuItems();
              if(!items.length) return;

              const dir = (key === "ArrowDown") ? 1 : -1;
              const next = (_userActiveIndex < 0) ? 0 : (_userActiveIndex + dir);
              setActiveIndex(next, true);
              return;
            }

            if(key === "Enter"){
              e.preventDefault();
              if(!isMenuOpen()){ openUsernameMenu(); return; }
              const items = menuItems();
              if(!items.length) return;

              const idx = (_userActiveIndex >= 0) ? _userActiveIndex : 0;
              const val = items[idx]?.dataset?.value || "";
              if(val) selectByValue(val);
              closeUsernameMenu();
              return;
            }

            if(key === "Escape"){ e.preventDefault(); closeUsernameMenu(); return; }

            if(key && key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey){
              if(!isMenuOpen()) openUsernameMenu();
              _typeBuf += key.toLowerCase();
              clearTimeout(_typeTimer);
              _typeTimer = setTimeout(()=>{ _typeBuf=""; }, 650);

              const items = menuItems();
              const idx = items.findIndex(it => String(it.textContent||"").trim().toLowerCase().startsWith(_typeBuf));
              if(idx >= 0) setActiveIndex(idx, true);
            }
          });
        }

        document.addEventListener("click", (e) => {
          if(!usernameWrap || !usernameMenu) return;
          if(isMenuOpen() && !usernameWrap.contains(e.target)) closeUsernameMenu();
        });
        document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeUsernameMenu(); });

        function populateUserSelect(){
          AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
          usernameSel.innerHTML = "";

          if(!AUTH_TABLE.length){
            const opt = document.createElement("option");
            opt.value = "";
            opt.textContent = "ï¼ˆå°šç„¡ä½¿ç”¨è€…ï¼Œè«‹å…ˆåˆ°ã€Œç³»çµ± / æ¬Šé™ã€æ–°å¢ï¼‰";
            opt.disabled = true;
            opt.selected = true;
            usernameSel.appendChild(opt);
            refreshUsernamePicker();
            return;
          }

          const ph = document.createElement("option");
          ph.value = "";
          ph.textContent = "è«‹é¸æ“‡ä½¿ç”¨è€…";
          ph.disabled = true;
          ph.selected = true;
          usernameSel.appendChild(ph);

          const names = Array.from(new Set(AUTH_TABLE.map(r => r.username).filter(Boolean)));
          names.sort((a,b)=>a.localeCompare(b, "zh-Hant"));
          names.forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            opt.textContent = name;
            usernameSel.appendChild(opt);
          });

          refreshUsernamePicker();
        }

        function showLogin(){
          document.body.classList.add("locked");
          loginOverlay.style.display = "flex";
          loginError.textContent = "";
          loginSub.textContent = "";
          $("#password").value = "";

          populateUserSelect();
          resetButtonsForLogout();

          userInfo.textContent = "ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥";
          userInfo.setAttribute("data-text", "ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥");

          autoEnterIfSessionValid();
          scheduleAll();

          setTimeout(() => { try{ usernameDisplay && usernameDisplay.focus(); }catch(e){} }, 0);
        }

        let CURRENT_USER = null;

        function autoEnterIfSessionValid(){
          const sess = getSession();
          if(!sess) return;

          const u = AUTH_TABLE.find(r => r.username === sess.user);
          if(!u){ clearSession(); return; }
          if(String(u.level||"").toLowerCase() !== String(sess.role||"").toLowerCase()){
            clearSession(); return;
          }

          loginSub.textContent = `å·²ç™»å…¥ï¼š${u.username}ï¼ˆ${u.level}ï¼‰â€¦ æ­£åœ¨é€²å…¥`;
          setTimeout(() => {
            if(!getSession()) return;
            applyUser(u);
          }, 150);
        }

        function applyUser(user){
          document.body.classList.remove("locked");
          loginOverlay.style.display = "none";
          loginSub.textContent = "";

          setSession(user);
          localStorage.setItem(CURRENT_KEY, JSON.stringify({ user: user.username, role: user.level }));

          CURRENT_USER = user;

          const t = `ç›®å‰ä½¿ç”¨è€…ï¼š${user.username} (${user.level})`;
          userInfo.textContent = t;
          userInfo.setAttribute("data-text", t);

          refreshButtonsForCurrentUser();
          scheduleExport("login:applyUser");

          mountCloudKitForUser(user).catch(()=>{});

          scheduleAll();
        }

        const scheduleLayout = rafDebounce(layoutButtons);

        // âœ…(æ•ˆèƒ½) tone å¥—ç”¨ä¸æœƒæ¯æ¬¡éƒ½è®€åƒç´ ï¼Œåªåœ¨ dirty æ™‚é‡ç®—
        const scheduleTone  = rafDebounce(applyAdaptiveTonesLite);

        function scheduleAll(){
          scheduleLayout();
          requestAnimationFrame(() => { scheduleTone(); });
        }

        AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
        buildMainButtonsDOM();
        showLogin();

        if(zenImg){
          zenImg.addEventListener("load", () => {
            _toneDirty = true;
            scheduleAll();
          }, { once:false });
        }

        requestAnimationFrame(() => {
          document.body.classList.remove("booting");
          _toneDirty = true;
          scheduleAll();
          onFontsReady(() => { _toneDirty = true; scheduleAll(); });
        });

        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const username = usernameSel.value;
          const password = $("#password").value;

          if(!username){ loginError.textContent = "è«‹å…ˆé¸æ“‡ä½¿ç”¨è€…åç¨±ã€‚"; return; }
          const user = AUTH_TABLE.find(row => row.username === username && row.password === password);
          if(!user){ loginError.textContent = "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚"; return; }

          loginError.textContent = "";
          applyUser(user);
          $("#password").value = "";
        });

        btnForceRelogin.addEventListener("click", () => {
          clearSession();
          loginSub.textContent = "è«‹é‡æ–°è¼¸å…¥å¯†ç¢¼ç™»å…¥";
          loginError.textContent = "";
          const pwd = $("#password");
          pwd.value = "";
          pwd.focus();
          scheduleAll();
        });

        btnSwitch.addEventListener("click", () => {
          clearSession();
          localStorage.removeItem(CURRENT_KEY);
          CURRENT_USER = null;
          showLogin();
          scheduleExport("switchUser");
          scheduleAll();
        });

        btnTogglePwd.addEventListener("click", () => {
          const pwd = $("#password");
          pwd.type = (pwd.type === "password") ? "text" : "password";
        });

        btnExport.addEventListener("click", () => {
          exportBackupNow("manual:button", { download:true });
        });

        // âœ…(æ•ˆèƒ½) resize / vv resize æœƒè®“ tone dirtyï¼Œä½†ä»ç”± rafDebounce åˆä½µåŸ·è¡Œ
        window.addEventListener("resize", () => { _toneDirty = true; scheduleAll(); }, { passive:true });
        if(window.visualViewport){
          window.visualViewport.addEventListener("resize", () => { _toneDirty = true; scheduleAll(); }, { passive:true });
          // âœ…ä¸è¦åœ¨ scroll æ™‚ç¡¬åš dirtyï¼ˆé¿å…åœ°å€åˆ—æ»‘å‹•é€ æˆå¤§é‡è§¸ç™¼ï¼‰
          window.visualViewport.addEventListener("scroll", () => { scheduleAll(); }, { passive:true });
        }
      })();
    }

    if(window.TasunLoader && typeof window.TasunLoader.ready === "function"){
      window.TasunLoader.ready(runIndexApp, 8000);
    }else if(window.TasunCore && typeof window.TasunCore.ready === "function"){
      window.TasunCore.ready(runIndexApp, 8000);
    }else{
      setTimeout(runIndexApp, 0);
    }
  })();
  </script>
</body>
</html>
