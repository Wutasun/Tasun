<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun Ë≥áÊñôÈ¶ñÈ†Å ¬∑ Á©∫ÁÑ°Êòé</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --gold:#f6d37a;
      --gold2:#e6c061;
      --gold-soft: rgba(246,211,122,.75);
      --panel: rgba(0,0,0,.38);
      --stroke: rgba(246,211,122,.28);
      --shadow: rgba(0,0,0,.55);
      --blur: 18px;

      --safe: clamp(14px, 2.2vw, 22px);

      --btn-h: clamp(56px, 7.2vh, 68px);
      --btn-r: 999px;
      --btn-w: clamp(240px, 26vw, 440px);

      --lotus-size: clamp(260px, 34vw, 520px);
      --stage-shift: clamp(-8px, -1.2vh, -22px);
      --title-top: calc(var(--safe) + 18px);
      --arc-gap: clamp(10px, 1.4vh, 18px);

      --txt-lg: clamp(22px, 2.6vw, 40px);
      --txt-md: clamp(16px, 2.0vw, 30px);
      --txt-sm: clamp(13px, 1.45vw, 20px);

      --side-gap: clamp(18px, 2.2vw, 34px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Noto Serif TC", system-ui, -apple-system, "Microsoft JhengHei", sans-serif;
      color: var(--gold);
      overflow-x:hidden;
      background:
        radial-gradient(circle at 20% 10%, rgba(246,211,122,.16) 0, transparent 42%),
        radial-gradient(circle at 80% 88%, rgba(246,211,122,.14) 0, transparent 46%),
        radial-gradient(circle at 50% 60%, rgba(246,211,122,.06) 0, transparent 55%),
        linear-gradient(180deg, #070604 0%, #050302 55%, #040202 100%);
    }

    .frame{
      position:relative;
      min-height:100vh;
      padding: var(--safe);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .shell{
      width:min(1280px, 96vw);
      min-height: min(720px, 88vh);
      border-radius: 26px;
      background:
        radial-gradient(circle at 50% 15%, rgba(246,211,122,.11) 0, rgba(0,0,0,.08) 55%, rgba(0,0,0,.20) 100%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.16));
      box-shadow: 0 18px 60px rgba(0,0,0,.55), inset 0 0 0 1px rgba(246,211,122,.10);
      position:relative;
      overflow:hidden;
    }

    .shell::before{
      content:"";
      position:absolute; inset:-2px;
      pointer-events:none;
      background:
        radial-gradient(90% 42% at 50% -6%,
          rgba(246,211,122,.34) 0%,
          rgba(246,211,122,.14) 32%,
          rgba(246,211,122,.06) 56%,
          rgba(0,0,0,0) 78%),
        radial-gradient(circle at 50% 56%,
          rgba(246,211,122,.20) 0%,
          rgba(246,211,122,.16) 22%,
          rgba(246,211,122,.10) 38%,
          rgba(246,211,122,.04) 52%,
          rgba(0,0,0,0) 62%),
        radial-gradient(circle at 50% 55%,
          rgba(0,0,0,0) 0%,
          rgba(0,0,0,.16) 62%,
          rgba(0,0,0,.52) 100%);
      mix-blend-mode: screen;
      opacity: .70;
    }

    .shell::after{
      content:"";
      position:absolute; inset:-2px;
      pointer-events:none;
      background:
        radial-gradient(60% 50% at 50% 45%,
          rgba(255,255,255,.09) 0%,
          rgba(255,255,255,.04) 38%,
          rgba(0,0,0,0) 70%),
        conic-gradient(from 220deg at 50% 6%,
          rgba(255,255,255,.06),
          rgba(255,255,255,0) 18%,
          rgba(255,255,255,.05) 36%,
          rgba(255,255,255,0) 52%,
          rgba(255,255,255,.04) 70%,
          rgba(255,255,255,0) 86%,
          rgba(255,255,255,.05));
      opacity:.28;
      filter: blur(12px);
      mix-blend-mode: screen;
    }

    .topbar{
      position:absolute;
      left: var(--safe);
      right: var(--safe);
      top: var(--safe);
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content:space-between;
      z-index:5;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,.40);
      border: 1px solid rgba(246,211,122,.22);
      color: var(--gold);
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      white-space:nowrap;
      max-width: 100%;
    }

    .btn{
      cursor:pointer;
      user-select:none;
      appearance:none;
      outline:none;
      font: inherit;
      color: var(--gold);
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,.28);
      padding: 10px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.18));
      box-shadow: 0 10px 28px rgba(0,0,0,.38), inset 0 0 0 1px rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn:hover{ filter: brightness(1.05); }
    .btn:active{ transform: translateY(1px); }

    .title{
      position:absolute;
      top: var(--title-top);
      left: 0; right:0;
      text-align:center;
      z-index:4;
      pointer-events:none;
      padding: 0 18px;
    }
    .title h1{
      margin: 0;
      font-size: clamp(40px, 5.4vw, 78px);
      letter-spacing: .12em;
      color: var(--gold);
      text-shadow:
        0 6px 22px rgba(0,0,0,.62),
        0 0 26px rgba(246,211,122,.22);
      font-weight: 700;
    }

    .center{
      position:absolute;
      inset: 112px var(--safe) var(--safe) var(--safe);
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap: clamp(14px, 2.2vw, 44px);
      align-items:center;
      justify-items:center;
      z-index:3;
      padding: clamp(16px, 2.8vw, 34px);
    }

    .col{
      width:100%;
      display:flex;
      flex-direction:column;
      gap: clamp(18px, 4.6vh, 52px);
      align-items:center;
      justify-content:center;
      min-width: min(420px, 100%);
    }

    .nav-btn{
      width: var(--btn-w);
      max-width: 100%;
      min-height: var(--btn-h);
      padding: 16px 22px;
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,.26);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.22));
      box-shadow:
        0 14px 40px rgba(0,0,0,.48),
        inset 0 0 0 1px rgba(255,255,255,.04);
      color: var(--gold);
      text-decoration:none;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      letter-spacing:.10em;
      font-size: clamp(15px, 1.5vw, 19px);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .nav-btn:hover{ filter:brightness(1.06); }
    .nav-btn:active{ transform: translateY(1px); }

    .stage{
      position:relative;
      width: var(--lotus-size);
      max-width: 92vw;
      aspect-ratio: 1/1.05;
      display:flex;
      align-items:center;
      justify-content:center;
      transform: translateY(var(--stage-shift));
      isolation:isolate;
      pointer-events:none;
    }

    .stage::before{
      content:"";
      position:absolute;
      inset: 5% 14%;
      border-radius: 36px;
      background:
        radial-gradient(120% 80% at 50% 18%,
          rgba(246,211,122,.18) 0%,
          rgba(246,211,122,.08) 36%,
          rgba(0,0,0,0) 70%),
        linear-gradient(180deg,
          rgba(246,211,122,.10) 0%,
          rgba(0,0,0,.10) 46%,
          rgba(0,0,0,0) 100%);
      filter: blur(2px);
      opacity:.40;
      z-index:0;
      mix-blend-mode: screen;
      mask-image: radial-gradient(circle at 50% 45%, #000 0 58%, transparent 82%);
      -webkit-mask-image: radial-gradient(circle at 50% 45%, #000 0 58%, transparent 82%);
    }

    .stage::after{
      content:"";
      position:absolute;
      inset:-10% -12%;
      background:
        radial-gradient(circle at 50% 45%,
          rgba(246,211,122,.16) 0%,
          rgba(246,211,122,.08) 24%,
          rgba(0,0,0,0) 55%),
        radial-gradient(circle at 50% 72%,
          rgba(0,0,0,0) 0%,
          rgba(0,0,0,.26) 62%,
          rgba(0,0,0,.55) 100%);
      opacity:.24;
      filter: blur(12px);
      z-index:0;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    /* ========== ‚úÖ ÁÖôÈúß 7 Â±§ÁñäÂä†ÔºöÊõ¥Á¥∞Êõ¥Â§öÊ¢ù ========== */
    .smoke{
      position:absolute;
      top: -6%;
      left: 50%;
      transform: translateX(-50%);
      width: 82%;
      height: 78%;
      z-index: 3;
      opacity: .62;
      pointer-events:none;
      filter: blur(.15px);
    }

    .sm{
      position:absolute;
      inset:0;
      background: url("smoke.png") center/contain no-repeat;
      mix-blend-mode: screen;
      transform-origin: 50% 92%;
      filter: contrast(1.10) saturate(1.06);
    }

    /* ÊØè‰∏ÄÂ±§ÔºöÁ∏ÆÊîæ/ÂÅèÁßª/ÈÄèÊòéÂ∫¶/Ê®°Á≥äÈÉΩ‰∏çÂêå ‚Üí Â§öËÇ°È¶ôÁÖôÈúß */
    .sm.s1{ opacity:.34; transform: translateX(-7%) translateY(0%)  scale(.92) rotate(-2deg); filter: blur(.85px) contrast(1.14); }
    .sm.s2{ opacity:.28; transform: translateX( 6%) translateY(1%)  scale(.96) rotate( 2deg); filter: blur(.65px) contrast(1.12); }
    .sm.s3{ opacity:.24; transform: translateX(-2%) translateY(-1%) scale(.88) rotate( 0deg); filter: blur(1.05px) contrast(1.16); }
    .sm.s4{ opacity:.20; transform: translateX( 2%) translateY(2%)  scale(.82) rotate(-3deg) scaleX(-1); filter: blur(1.20px) contrast(1.18); }
    .sm.s5{ opacity:.18; transform: translateX(-10%)translateY(3%)  scale(.78) rotate( 3deg); filter: blur(1.35px) contrast(1.20); }
    .sm.s6{ opacity:.16; transform: translateX( 10%)translateY(-2%) scale(.74) rotate(-1deg) scaleX(-1); filter: blur(1.55px) contrast(1.22); }
    .sm.s7{ opacity:.14; transform: translateX( 0%) translateY(4%)  scale(.70) rotate( 1deg); filter: blur(1.80px) contrast(1.25); }

    /* ÊâãÊ©üÔºöÁÖôÈúßÂÜçÊî∂Á¥∞ÔºàÊõ¥ÂÉèÁ∑öÊ¢ùÔºâ */
    @media (max-width: 980px){
      .smoke{ opacity:.55; width: 84%; filter: blur(.10px); }
      .sm.s1{ opacity:.30; }
      .sm.s7{ opacity:.12; }
    }

    .lotus{
      position:absolute;
      bottom: -4%;
      left: 50%;
      transform: translateX(-50%);
      width: 92%;
      height: auto;
      z-index: 4;
      filter:
        drop-shadow(0 22px 36px rgba(0,0,0,.55))
        drop-shadow(0 0 18px rgba(246,211,122,.16));
    }

    .waterFade{
      position:absolute;
      left: 50%;
      bottom: -6%;
      transform: translateX(-50%);
      width: 98%;
      height: 44%;
      z-index: 5;
      pointer-events:none;
      background:
        radial-gradient(80% 60% at 50% 35%,
          rgba(0,0,0,0) 0%,
          rgba(0,0,0,.22) 52%,
          rgba(0,0,0,.58) 100%),
        linear-gradient(180deg,
          rgba(0,0,0,0) 0%,
          rgba(0,0,0,.22) 40%,
          rgba(0,0,0,.52) 100%);
      opacity:.55;
      mix-blend-mode: multiply;
      mask-image: radial-gradient(circle at 50% 25%, #000 0 58%, transparent 88%);
      -webkit-mask-image: radial-gradient(circle at 50% 25%, #000 0 58%, transparent 88%);
    }

    .txt3d{
      color: rgba(246,211,122,.84);
      text-shadow:
        0 2px 0 rgba(160,120,40,.22),
        0 8px 18px rgba(0,0,0,.60),
        0 0 20px rgba(246,211,122,.14);
      letter-spacing: .18em;
      font-weight: 700;
      transform: translateZ(0);
      filter: saturate(1.05);
    }

    .arcHolder{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      top: calc(6% + var(--arc-gap));
      width: 78%;
      height: 30%;
      z-index: 6;
      pointer-events:none;
    }
    .arcHolder span{
      position:absolute;
      left: 50%;
      top: 62%;
      transform-origin: 0 0;
      font-size: var(--txt-lg);
      white-space:nowrap;
      opacity:.90;
    }

    .words{
      position:absolute;
      inset:0;
      z-index: 6;
      pointer-events:none;
    }

    .w-mid{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 22%;
      display:flex;
      gap: clamp(28px, 4vw, 70px);
      font-size: var(--txt-md);
      opacity:.88;
      letter-spacing:.28em;
    }

    .w-left{
      position:absolute;
      left: calc(50% - (var(--lotus-size) / 2) - var(--side-gap));
      top: calc(50% - (var(--lotus-size) / 2) + 10px);
      display:flex;
      flex-direction:column;
      gap: clamp(14px, 1.8vw, 22px);
      font-size: var(--txt-md);
      opacity:.84;
      align-items:center;
    }

    .w-right{
      position:absolute;
      right: calc(50% - (var(--lotus-size) / 2) - var(--side-gap));
      top: calc(50% - (var(--lotus-size) / 2) + 10px);
      display:flex;
      flex-direction:column;
      gap: clamp(14px, 1.8vw, 22px);
      font-size: var(--txt-md);
      opacity:.84;
      align-items:center;
    }

    .w-bottom{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 4%;
      display:flex;
      gap: clamp(18px, 3.2vw, 46px);
      font-size: var(--txt-md);
      opacity:.86;
      letter-spacing:.30em;
    }

    @media (max-width: 980px){
      .center{
        grid-template-columns: 1fr;
        gap: 14px;
      }
      .col{
        min-width: 0;
        gap: 14px;
      }
      .nav-btn{
        width: min(520px, 100%);
      }
      .stage{
        width: min(520px, 92vw);
      }

      .w-left{
        left: calc(50% - (var(--lotus-size) / 2) - clamp(12px, 2vw, 18px));
        top: calc(50% - (var(--lotus-size) / 2) + 12px);
        font-size: var(--txt-sm);
        gap: clamp(10px, 1.2vw, 14px);
        opacity:.74;
      }
      .w-right{
        right: calc(50% - (var(--lotus-size) / 2) - clamp(12px, 2vw, 18px));
        top: calc(50% - (var(--lotus-size) / 2) + 12px);
        font-size: var(--txt-sm);
        gap: clamp(10px, 1.2vw, 14px);
        opacity:.74;
      }
      .w-mid{
        top: 23%;
        font-size: var(--txt-sm);
        opacity:.78;
        gap: clamp(22px, 4.2vw, 44px);
      }
      .w-bottom{
        font-size: var(--txt-sm);
        opacity:.78;
        bottom: 5%;
      }
      .arcHolder{
        top: calc(5% + var(--arc-gap));
        width: 90%;
      }
    }

    @media (max-width: 560px){
      .topbar{ gap: 10px; }
      .pill{ padding: 8px 12px; }
      .btn{ padding: 9px 12px; }
      :root{ --title-top: calc(var(--safe) + 10px); }
      .w-left{ left: calc(50% - (var(--lotus-size) / 2) - 12px); }
      .w-right{ right: calc(50% - (var(--lotus-size) / 2) - 12px); }
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="shell" id="shell">
      <div class="topbar">
        <div class="pill" id="whoPill">ÁõÆÂâç‰ΩøÁî®ËÄÖÔºö‚Äî</div>
        <button class="btn" id="switchBtn">ÂàáÊèõÂ∏≥Ëôü</button>
      </div>

      <div class="title">
        <h1>Tasun Ë≥áÊñô</h1>
      </div>

      <div class="center">
        <div class="col" id="leftCol">
          <a class="nav-btn" data-key="btn1" href="ËáªÈºéÁÆ°ÁêÜË°®.html">ËáªÈºéÊôÇ‰ª£Â§ßÂªàÁÆ°ÁêÜË°®</a>
          <a class="nav-btn" data-key="btn3" href="https://www.dropbox.com/" target="_blank" rel="noopener">Èõ≤Á´ØÊ™îÊ°à</a>
          <a class="nav-btn" data-key="btn5" href="Ë≥áÊñôÂ∫´.html">Ë≥áÊñôÂ∫´</a>
        </div>

        <div class="stage" aria-hidden="true">
          <!-- ‚úÖ 7 Â±§È¶ôÁÖôÈúß -->
          <div class="smoke" aria-hidden="true">
            <span class="sm s1"></span>
            <span class="sm s2"></span>
            <span class="sm s3"></span>
            <span class="sm s4"></span>
            <span class="sm s5"></span>
            <span class="sm s6"></span>
            <span class="sm s7"></span>
          </div>

          <div class="arcHolder txt3d" id="arcText" aria-hidden="true"></div>

          <div class="words" aria-hidden="true">
            <div class="w-mid txt3d"><span>Á©∫</span><span>ÁÑ°</span><span>Êòé</span></div>

            <div class="w-left txt3d">
              <span>Á©∫</span><span>Èùà</span><span>ÁÑ°</span><span>Êàë</span>
            </div>

            <div class="w-right txt3d">
              <span>Ê∏Ö</span><span>Êòé</span><span>ÂØß</span><span>Èùú</span>
            </div>

            <div class="w-bottom txt3d">
              <span>Á©∫</span><span>ÁÑ°</span><span>Êòé</span><span>Èùú</span>
            </div>
          </div>

          <img class="lotus" src="ÈÄèÊòéÁéªÁíÉËìÆËä±.png" alt="" />
          <div class="waterFade" aria-hidden="true"></div>
        </div>

        <div class="col" id="rightCol">
          <a class="nav-btn" data-key="btn2" href="ÁîÑÈºéquality.html">Áº∫Â§± / ÂìÅË≥™</a>
          <a class="nav-btn" data-key="btn4" href="Â∑•Á®ãË≥áÊñôÂ∫´.html">Â∑•Á®ãË≥áÊñôÂ∫´</a>
          <a class="nav-btn" data-key="btn6" data-admin-only="1" href="Ê¨äÈôêË°®.html">Á≥ªÁµ± / Ê¨äÈôê</a>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="loginCard">
      <h2>Tasun Ë≥áÊñô ¬∑ ÁôªÂÖ•</h2>

      <div class="row">
        <label for="userSel">Â∏≥ËôüÔºà‰∏ãÊãâÈÅ∏ÂñÆÔºâ</label>
        <select id="userSel"></select>
      </div>

      <div class="row">
        <label for="pw">ÂØÜÁ¢º</label>
        <div class="pwWrap">
          <input id="pw" type="password" placeholder="Ëº∏ÂÖ•ÂØÜÁ¢º" autocomplete="current-password" />
          <button class="pwToggle" id="pwToggle" type="button" title="È°ØÁ§∫/Èö±Ëóè">üëÅ</button>
        </div>
      </div>

      <div class="loginActions">
        <button class="btn" id="loginBtn">ÁôªÂÖ•</button>
        <button class="btn" id="closeLoginBtn" style="opacity:.9">ÈóúÈñâ</button>
      </div>

      <div class="hint" id="hint">Ë´ãÈÅ∏ÊìáÂ∏≥Ëôü‰∏¶Ëº∏ÂÖ•ÂØÜÁ¢º„ÄÇ</div>
    </div>
  </div>

<script>
(() => {
  const AUTH_KEY    = 'tasunAuthTable_v1';
  const CURRENT_KEY = 'tasunCurrentUser_v1';
  const BTN_META_KEY= 'tasunButtonMeta_v1';

  const BUTTON_DEFS = [
    { key:'btn1', name:'ËáªÈºéÊôÇ‰ª£Â§ßÂªàÁÆ°ÁêÜË°®', href:'ËáªÈºéÁÆ°ÁêÜË°®.html' },
    { key:'btn2', name:'Áº∫Â§± / ÂìÅË≥™',       href:'ÁîÑÈºéquality.html' },
    { key:'btn3', name:'Èõ≤Á´ØÊ™îÊ°à',           href:'https://www.dropbox.com/' },
    { key:'btn4', name:'Â∑•Á®ãË≥áÊñôÂ∫´',         href:'Â∑•Á®ãË≥áÊñôÂ∫´.html' },
    { key:'btn5', name:'Ë≥áÊñôÂ∫´',             href:'Ë≥áÊñôÂ∫´.html' },
    { key:'btn6', name:'Á≥ªÁµ± / Ê¨äÈôê',         href:'Ê¨äÈôêË°®.html' },
  ];

  function ensureButtonMeta(){
    localStorage.setItem(BTN_META_KEY, JSON.stringify(BUTTON_DEFS));
  }

  function seedAuthIfMissing(){
    let auth;
    try{ auth = JSON.parse(localStorage.getItem(AUTH_KEY) || 'null'); }catch(e){ auth = null; }
    if(Array.isArray(auth) && auth.length) return;

    const seed = [
      { user:'alex',  pass:'Tasun08040224', role:'admin', btn1:true, btn2:true, btn3:true, btn4:true, btn5:true, btn6:true },
      { user:'tasun', pass:'tasun08040224', role:'write', btn1:true, btn2:true, btn3:false,btn4:true, btn5:false,btn6:false },
      { user:'wu',    pass:'123456',        role:'read',  btn1:true, btn2:false,btn3:false,btn4:false,btn5:false,btn6:false },
      { user:'JOYCE', pass:'09220224',      role:'admin', btn1:true, btn2:true, btn3:true, btn4:true, btn5:true, btn6:true },
    ];
    localStorage.setItem(AUTH_KEY, JSON.stringify(seed));
  }

  function readAuth(){
    try{
      const a = JSON.parse(localStorage.getItem(AUTH_KEY) || '[]');
      return Array.isArray(a) ? a : [];
    }catch(e){ return []; }
  }

  function readCurrent(){
    try{
      const c = JSON.parse(localStorage.getItem(CURRENT_KEY) || 'null');
      return c && typeof c === 'object' ? c : null;
    }catch(e){ return null; }
  }

  function setCurrent(userObj){
    localStorage.setItem(CURRENT_KEY, JSON.stringify(userObj));
  }

  function bool(v){
    return v === true || v === 1 || v === '1' || v === 'true';
  }

  function applyPermissions(current){
    const whoPill = document.getElementById('whoPill');
    const buttons = document.querySelectorAll('.nav-btn');

    if(!current){
      whoPill.textContent = 'ÁõÆÂâç‰ΩøÁî®ËÄÖÔºö‚Äî';
      buttons.forEach(b => b.style.display = 'none');
      return;
    }

    whoPill.textContent = `ÁõÆÂâç‰ΩøÁî®ËÄÖÔºö${current.user} (${current.role})`;

    const auth = readAuth();
    const row = auth.find(x => (x.user||'').toLowerCase() === (current.user||'').toLowerCase());
    const role = (current.role||'read').toLowerCase();

    buttons.forEach(b => {
      const key = b.dataset.key;
      const adminOnly = b.dataset.adminOnly === '1';

      if(adminOnly){
        b.style.display = (role === 'admin') ? '' : 'none';
        return;
      }

      if(role === 'admin'){
        b.style.display = '';
        return;
      }

      const allowed = row ? bool(row[key]) : false;
      b.style.display = allowed ? '' : 'none';
    });
  }

  function renderArcText(){
    const text = 'Á©∫ÁÑ°Êòé';
    const holder = document.getElementById('arcText');
    holder.innerHTML = '';

    const angles = [-22, 0, 22];

    for(let i=0;i<text.length;i++){
      const sp = document.createElement('span');
      sp.className = 'txt3d';
      sp.textContent = text[i];
      holder.appendChild(sp);
    }

    const stage = document.querySelector('.stage');
    const w = stage.getBoundingClientRect().width;
    const r = Math.max(86, Math.min(170, w * 0.28));

    [...holder.querySelectorAll('span')].forEach((sp,i)=>{
      sp.style.transform = `rotate(${angles[i]}deg) translate(${r}px) rotate(${-angles[i]}deg)`;
    });
  }

  const overlay = document.getElementById('overlay');
  const userSel = document.getElementById('userSel');
  const pw      = document.getElementById('pw');
  const hint    = document.getElementById('hint');
  const loginBtn= document.getElementById('loginBtn');
  const closeLoginBtn = document.getElementById('closeLoginBtn');
  const switchBtn = document.getElementById('switchBtn');
  const pwToggle = document.getElementById('pwToggle');

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function openLogin(){
    const auth = readAuth();
    userSel.innerHTML = auth.map(a => `<option value="${escapeHtml(a.user)}">${escapeHtml(a.user)}</option>`).join('');
    pw.value = '';
    hint.textContent = 'Ë´ãÈÅ∏ÊìáÂ∏≥Ëôü‰∏¶Ëº∏ÂÖ•ÂØÜÁ¢º„ÄÇ';
    overlay.classList.add('show');
    setTimeout(()=> pw.focus(), 120);
  }

  function closeLogin(){
    overlay.classList.remove('show');
  }

  function doLogin(){
    const auth = readAuth();
    const u = (userSel.value || '').trim();
    const p = (pw.value || '').trim();

    const row = auth.find(a => (a.user||'').toLowerCase() === u.toLowerCase());
    if(!row){
      hint.textContent = 'Êâæ‰∏çÂà∞Ê≠§Â∏≥Ëôü„ÄÇ';
      return;
    }
    if(String(row.pass||'') !== p){
      hint.textContent = 'ÂØÜÁ¢ºÈåØË™§„ÄÇ';
      return;
    }

    setCurrent({ user: row.user, role: (row.role||'read') });
    applyPermissions(readCurrent());
    closeLogin();
  }

  pwToggle.addEventListener('click', () => {
    pw.type = (pw.type === 'password') ? 'text' : 'password';
    pwToggle.textContent = (pw.type === 'password') ? 'üëÅ' : 'üôà';
  });

  loginBtn.addEventListener('click', doLogin);
  closeLoginBtn.addEventListener('click', closeLogin);
  switchBtn.addEventListener('click', openLogin);
  pw.addEventListener('keydown', (e) => { if(e.key === 'Enter') doLogin(); });

  ensureButtonMeta();
  seedAuthIfMissing();

  renderArcText();
  window.addEventListener('resize', renderArcText);

  const cur = readCurrent();
  if(cur){
    applyPermissions(cur);
  }else{
    applyPermissions(null);
    openLogin();
  }

  window.addEventListener('storage', (e) => {
    if(e.key === AUTH_KEY || e.key === CURRENT_KEY){
      applyPermissions(readCurrent());
    }
  });

})();
</script>
</body>
</html>
