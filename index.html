<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun è³‡æ–™é¦–é  Â· ç©ºç„¡æ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --gold:#f6d37a;
      --gold-soft: rgba(246,211,122,0.78);
      --panel-border: rgba(246,211,122,0.35);
      --bg1:#050302;
      --bg2:#0a0b0c;

      --pill-bg: radial-gradient(circle at 0% 0%, rgba(246,211,122,0.18), rgba(0,0,0,0.88));
      --btn-bg: radial-gradient(circle at 0% 0%, rgba(246,211,122,0.22), rgba(0,0,0,0.92));
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      min-height:100vh;
      font-family:"Noto Serif TC","Microsoft JhengHei",serif;
      color:var(--gold);
      background:
        radial-gradient(circle at 50% 18%, rgba(255, 228, 170, 0.18), rgba(0,0,0,0.98)),
        radial-gradient(circle at 15% 85%, rgba(246, 211, 122, 0.08), rgba(0,0,0,0.92));
      overflow-x:hidden;
    }

    .wrap{
      width:min(1400px, 96vw);
      margin: 14px auto 24px;
      border-radius: 26px;
      border: 1px solid rgba(246,211,122,0.22);
      box-shadow: 0 0 30px rgba(0,0,0,0.65), 0 0 26px rgba(246,211,122,0.10);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.85));
      padding: 14px 14px 18px;
      position: relative;
    }

    /* top-left bar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .leftbar{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .pill{
      padding: .34rem .95rem;
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,.55);
      background: var(--pill-bg);
      color: var(--gold-soft);
      font-size: .86rem;
      white-space: nowrap;
      letter-spacing: .08em;
    }
    .btn{
      border: 1px solid rgba(246,211,122,0.72);
      background: var(--btn-bg);
      color: var(--gold);
      border-radius: 999px;
      padding: 0.44rem 1.05rem;
      cursor: pointer;
      letter-spacing: 0.10em;
      text-indent: 0.10em;
      box-shadow: 0 8px 16px rgba(0,0,0,0.75);
      white-space: nowrap;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    /* hero */
    .hero{
      position: relative;
      border-radius: 24px;
      overflow:hidden;
      border: 1px solid rgba(246,211,122,0.14);
      background:
        radial-gradient(circle at 50% 20%, rgba(246,211,122,0.20), rgba(0,0,0,0.88));
      padding: 18px 14px 16px;
    }
    .title{
      text-align:center;
      font-size: clamp(28px, 4.6vw, 54px);
      letter-spacing:.25em;
      text-indent:.25em;
      text-shadow: 0 0 18px rgba(246,211,122,.45);
      margin-top: 2px;
      margin-bottom: 10px;
    }

    .center-stage{
      position: relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px 10px 22px;
      min-height: 420px;
    }

    /* lotus block (ç°¡åŒ–ç‰ˆï¼šä¸ä¾è³´å¤–éƒ¨åœ–ç‰‡ä¹Ÿèƒ½æœ‰ç¦ªé¢¨) */
    .lotus{
      width:min(560px, 82vw);
      aspect-ratio: 1.55/1;
      border-radius: 26px;
      border: 1px solid rgba(246,211,122,0.18);
      background:
        radial-gradient(circle at 50% 55%, rgba(246,211,122,0.26), rgba(0,0,0,0.88)),
        radial-gradient(circle at 50% 75%, rgba(255, 180, 60, 0.22), rgba(0,0,0,0.00));
      box-shadow:
        0 0 30px rgba(0,0,0,0.65),
        0 0 28px rgba(246,211,122,0.14);
      position: relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .lotus::before{
      content:"";
      position:absolute;
      inset: 16% 12% 20% 12%;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 55%, rgba(255, 205, 120, 0.35), rgba(0,0,0,0));
      filter: blur(2px);
    }
    .lotus-words{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 18px;
      color: rgba(246,211,122,0.88);
      text-shadow: 0 0 14px rgba(246,211,122,0.35);
      font-size: clamp(22px, 3.4vw, 42px);
      letter-spacing: .35em;
      text-indent: .35em;
      pointer-events:none;
    }

    /* buttons grid around lotus */
    .nav-area{
      position:absolute;
      inset: 0;
      display:grid;
      grid-template-columns: 1fr min(560px, 82vw) 1fr;
      grid-template-rows: 1fr;
      align-items:center;
      justify-items:center;
      padding: 12px 8px;
      gap: 14px;
      pointer-events:none;
    }
    .nav-col{
      width: min(340px, 40vw);
      display:flex;
      flex-direction:column;
      gap: 18px;
      pointer-events:auto;
    }
    .nav-col.right{ align-items:flex-start; }
    .nav-col.left{ align-items:flex-end; }

    .nav-btn{
      width: 100%;
      max-width: 320px;
      padding: 0.95rem 1.15rem;
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,0.55);
      background: radial-gradient(circle at 0% 0%, rgba(246,211,122,0.22), rgba(0,0,0,0.92));
      color: rgba(246,211,122,0.92);
      letter-spacing: .12em;
      text-indent: .12em;
      font-size: clamp(14px, 1.55vw, 18px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.75);
      cursor:pointer;
      text-align:center;
      user-select:none;
    }
    .nav-btn[hidden]{ display:none !important; }

    .footer-words{
      text-align:center;
      margin-top: 10px;
      color: rgba(246,211,122,0.70);
      letter-spacing: .55em;
      text-indent: .55em;
      font-size: clamp(14px, 1.7vw, 20px);
      opacity:.92;
    }

    /* login overlay */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: radial-gradient(circle at 50% 18%, rgba(255, 228, 170, 0.32), rgba(0, 0, 0, 0.98));
      z-index: 5000;
    }
    .login-box{
      width: min(560px, 92vw);
      border-radius: 20px;
      border: 1px solid rgba(246, 211, 122, 0.35);
      background: radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.22), rgba(0, 0, 0, 0.95));
      box-shadow: 0 0 28px rgba(0,0,0,0.92), 0 0 26px rgba(246,211,122,0.18);
      padding: 18px 18px 14px;
      color: var(--gold-soft);
    }
    .login-title{
      text-align:center;
      font-size: 1.15rem;
      letter-spacing:.18em;
      text-indent:.18em;
      margin-bottom: 10px;
      color: rgba(246,211,122,0.92);
      text-shadow: 0 0 16px rgba(246,211,122,.35);
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top: 10px;
      flex-wrap:wrap;
    }
    .in{
      flex:1;
      width: 100%;
      padding: .55rem .8rem;
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,0.45);
      background: rgba(0,0,0,0.82);
      color: var(--gold);
      outline:none;
    }
    .in:focus{ border-color: rgba(255, 238, 190, 0.9); box-shadow: 0 0 12px rgba(246, 211, 122, 0.65); }
    .msg{
      margin-top: 10px;
      min-height: 1.2rem;
      font-size: .88rem;
      color: rgba(255, 220, 190, 0.95);
      white-space: pre-line;
    }
    .hint{
      margin-top: 8px;
      font-size: .85rem;
      color: rgba(246,211,122,0.78);
      line-height: 1.6;
    }

    @media (max-width: 860px){
      .center-stage{ min-height: 520px; }
      .nav-area{
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        gap: 12px;
      }
      .nav-col{
        width: min(520px, 92vw);
        max-width: 520px;
        align-items:center !important;
      }
      .nav-col.left{ order: 1; }
      .nav-col.right{ order: 3; }
      .lotus{ order: 2; }
      .nav-btn{ max-width: 520px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="leftbar">
        <div class="pill" id="who">ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥</div>
        <button class="btn" id="btnSwitch" type="button">åˆ‡æ›å¸³è™Ÿ</button>
      </div>
      <div class="leftbar">
        <div class="pill" id="cloudPill">é›²ç«¯ï¼šâ€”</div>
        <button class="btn" id="btnOpenPerm" type="button">ç³»çµ± / æ¬Šé™</button>
      </div>
    </div>

    <div class="hero">
      <div class="title">Tasun è³‡æ–™</div>

      <div class="center-stage">
        <div class="nav-area">
          <div class="nav-col left" id="navLeft"></div>

          <div class="lotus" aria-hidden="true">
            <div class="lotus-words">
              <span>ç©º</span><span>ç„¡</span><span>æ˜</span>
            </div>
          </div>

          <div class="nav-col right" id="navRight"></div>
        </div>
      </div>

      <div class="footer-words">ç©º ç„¡ æ˜ éœ</div>
    </div>
  </div>

  <!-- Login Overlay -->
  <div class="overlay" id="loginOverlay" aria-hidden="true">
    <div class="login-box">
      <div class="login-title">ç™»å…¥é©—è­‰</div>

      <div class="row">
        <select class="in" id="selUser"></select>
      </div>

      <div class="row">
        <input class="in" id="pw" type="password" placeholder="è¼¸å…¥å¯†ç¢¼" autocomplete="current-password" />
        <button class="btn" id="pwEye" type="button">ğŸ‘</button>
      </div>

      <div class="row" style="justify-content:flex-end;">
        <button class="btn" id="btnLogin" type="button">ç™»å…¥</button>
      </div>

      <div class="msg" id="loginMsg"></div>

      <div class="hint">
        âœ” ç™»å…¥ç‹€æ…‹åªæœƒè¨˜ä½åˆ°ã€Œé—œé–‰ç€è¦½å™¨ã€ç‚ºæ­¢ã€‚<br>
        âœ” Dropbox å°æ‡‰å¸³è™Ÿï¼ˆæç¤ºï¼‰ï¼š<b>tasun_8@hotmail.com</b>
      </div>
    </div>
  </div>

<script>
  // ==========================
  // Storage keysï¼ˆèˆ‡æ¬Šé™è¡¨ä¸€è‡´ï¼‰
  // ==========================
  const AUTH_KEY    = "tasunAuthTable_v1";
  const NAV_KEY     = "tasunNavButtons_v1";

  // é€™å€‹ã€Œç›®å‰ç™»å…¥è€…ã€ï¼šç”¨ sessionStorageï¼ˆé—œæ‰ç€è¦½å™¨å°±æ¶ˆå¤±ï¼‰
  const CURRENT_KEY = "tasunCurrentUser_v1";

  // é›²ç«¯ç‹€æ…‹ï¼ˆé¡¯ç¤ºç”¨ï¼‰
  const CLOUD_TS_KEY = "tasunCloudUpdatedAt_v1";

  // ==========================
  // UI refs
  // ==========================
  const who = document.getElementById("who");
  const cloudPill = document.getElementById("cloudPill");
  const btnSwitch = document.getElementById("btnSwitch");
  const btnOpenPerm = document.getElementById("btnOpenPerm");

  const navLeft = document.getElementById("navLeft");
  const navRight = document.getElementById("navRight");

  const loginOverlay = document.getElementById("loginOverlay");
  const selUser = document.getElementById("selUser");
  const pw = document.getElementById("pw");
  const pwEye = document.getElementById("pwEye");
  const btnLogin = document.getElementById("btnLogin");
  const loginMsg = document.getElementById("loginMsg");

  // ==========================
  // helpers
  // ==========================
  function safeJsonParse(s, fallback){
    try{ return JSON.parse(s); }catch(e){ return fallback; }
  }

  function loadNav(){
    const raw = localStorage.getItem(NAV_KEY);
    let arr = safeJsonParse(raw || "[]", []);
    if(Array.isArray(arr) && arr.length) return arr;

    // é è¨­ 5 é¡†ï¼ˆç¬¬ 6 é¡†ã€Œç³»çµ±/æ¬Šé™ã€å›ºå®š admin æ‰é¡¯ç¤ºï¼Œä¸”ä¸åœ¨ NAV_KEYï¼‰
    arr = [
      { id:"btn1", label:"è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨", href:"è‡»é¼ç®¡ç†è¡¨.html", target:"", roles:["admin","write","read"] },
      { id:"btn2", label:"ç¼ºå¤± / å“è³ª",        href:"ç”„é¼quality.html", target:"", roles:["admin","write","read"] },
      { id:"btn3", label:"é›²ç«¯æª”æ¡ˆ",          href:"https://www.dropbox.com/", target:"_blank", roles:["admin","write","read"] },
      { id:"btn4", label:"å·¥ç¨‹è³‡æ–™åº«",        href:"å·¥ç¨‹è³‡æ–™åº«.html", target:"", roles:["admin","write"] },
      { id:"btn5", label:"è³‡æ–™åº«",            href:"#", target:"", roles:["admin","write","read"] }
    ];
    localStorage.setItem(NAV_KEY, JSON.stringify(arr));
    return arr;
  }

  function loadAuth(btnCount){
    const raw = localStorage.getItem(AUTH_KEY);
    let arr = safeJsonParse(raw || "null", null);

    // æ²’è³‡æ–™å°±å»ºç«‹é è¨­
    if(!Array.isArray(arr)){
      arr = [
        { username:"alex",  password:"Tasun08040224", level:"admin", buttons: Array(btnCount).fill(true) },
        { username:"tasun", password:"tasun08040224", level:"write", buttons: Array(btnCount).fill(true) },
        { username:"wu",    password:"123456",        level:"read",  buttons: (()=>{ const a=Array(btnCount).fill(false); if(btnCount) a[btnCount-1]=true; return a; })() }
      ];
      localStorage.setItem(AUTH_KEY, JSON.stringify(arr));
    }

    // è£œé½Š buttons é•·åº¦
    return arr.map(r=>{
      const b = Array.isArray(r.buttons) ? r.buttons.slice() : [];
      const out = [];
      for(let i=0;i<btnCount;i++) out[i] = !!b[i];
      return {
        username: String(r.username||""),
        password: String(r.password||""),
        level: String(r.level||"read"),
        buttons: out
      };
    });
  }

  function getCurrentUser(){
    // âœ… åªè¨˜åˆ°é—œé–‰ç€è¦½å™¨ï¼šè®€ sessionStorage
    const cu = safeJsonParse(sessionStorage.getItem(CURRENT_KEY) || "null", null);
    if(cu && cu.username) return cu;

    // ç›¸å®¹ï¼šå¦‚æœèˆŠç‰ˆæœ¬å­˜ localStorage
    const cu2 = safeJsonParse(localStorage.getItem(CURRENT_KEY) || "null", null);
    if(cu2 && cu2.username) return cu2;

    return null;
  }

  function setCurrentUser(obj){
    sessionStorage.setItem(CURRENT_KEY, JSON.stringify(obj));
    // æ¸…æ‰ localStorage ç‰ˆæœ¬ï¼Œé¿å…æ··äº‚
    localStorage.removeItem(CURRENT_KEY);
  }

  function clearCurrentUser(){
    sessionStorage.removeItem(CURRENT_KEY);
    localStorage.removeItem(CURRENT_KEY);
  }

  function roleOf(user){
    return String((user && (user.level || user.role)) || "").toLowerCase();
  }

  function isAdmin(){
    const cu = getCurrentUser();
    return roleOf(cu) === "admin";
  }

  function setCloudPill(){
    const ts = localStorage.getItem(CLOUD_TS_KEY);
    if(ts){
      const d = new Date(Number(ts));
      if(!isNaN(d.getTime())){
        cloudPill.textContent = "é›²ç«¯ï¼šæœ€è¿‘åŒæ­¥ " + d.toLocaleString();
        return;
      }
    }
    cloudPill.textContent = "é›²ç«¯ï¼šâ€”";
  }

  // ==========================
  // render nav
  // ==========================
  function render(){
    const nav = loadNav();
    const auth = loadAuth(nav.length);

    // ç™»å…¥ä¸‹æ‹‰é¸å–®
    selUser.innerHTML = "";
    auth.forEach(a=>{
      const opt = document.createElement("option");
      opt.value = a.username;
      opt.textContent = a.username + " (" + a.level + ")";
      selUser.appendChild(opt);
    });

    // ç›®å‰ä½¿ç”¨è€…
    const cu = getCurrentUser();
    if(!cu){
      who.textContent = "ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥";
    }else{
      who.textContent = `ç›®å‰ä½¿ç”¨è€…ï¼š${cu.username} (${roleOf(cu)})`;
    }

    setCloudPill();

    // æ¬Šé™é å…¥å£ï¼šadmin æ‰å¯é¡¯ç¤ºï¼ˆä½ åŸæœ¬ç¬¬6é¡†è¦å‰‡ï¼‰
    btnOpenPerm.disabled = !isAdmin();

    // è‹¥æœªç™»å…¥ï¼Œå…ˆé–ç•«é¢ï¼ˆé¡¯ç¤ºç™»å…¥æ¡†ï¼‰
    if(!cu){
      showLogin("è«‹å…ˆç™»å…¥å¾Œæ‰èƒ½é€²å…¥é¦–é ã€‚");
      // æ¸…æ‰æŒ‰éˆ•
      navLeft.innerHTML = "";
      navRight.innerHTML = "";
      return;
    }

    // ä¾ç…§ NAV + æ¬Šé™è¡¨ buttons + roles ä¾†é¡¯ç¤º
    const userRow = auth.find(a => a.username === cu.username) || null;
    const uLevel = roleOf(cu);

    const visible = nav.map((n, i)=>{
      // roles å…ˆæ“‹
      const roleOk = Array.isArray(n.roles) ? n.roles.includes(uLevel) : true;
      // buttons å†æ“‹ï¼ˆæ¬Šé™è¡¨æ‰“å‹¾ï¼‰
      const buttonOk = userRow ? !!userRow.buttons[i] : true;
      return roleOk && buttonOk;
    });

    // æŒ‰éˆ•æ’åˆ—ï¼šå·¦ä¸Šâ†’å³ä¸Šâ†’å·¦ä¸­â†’å³ä¸­â†’å·¦ä¸‹â†’å³ä¸‹â€¦
    const items = [];
    nav.forEach((n, i)=>{
      if(!visible[i]) return;
      items.push(n);
    });

    navLeft.innerHTML = "";
    navRight.innerHTML = "";

    items.forEach((n, idx)=>{
      const b = document.createElement("button");
      b.className = "nav-btn";
      b.textContent = n.label || n.id;
      b.addEventListener("click", ()=>{
        if(n.href){
          if(n.target === "_blank"){
            window.open(n.href, "_blank", "noopener");
          }else{
            location.href = n.href;
          }
        }
      });

      // idx 0 left, 1 right, 2 left, 3 right...
      if(idx % 2 === 0){
        navLeft.appendChild(b);
      }else{
        navRight.appendChild(b);
      }
    });

    // è‹¥æŸå´å¤ªå°‘ï¼Œè£œé½Šè®“è¦–è¦ºå‡è¡¡ï¼ˆå¯é¸ï¼šä¸è£œä¹Ÿè¡Œï¼‰
  }

  // ==========================
  // login overlay
  // ==========================
  function showLogin(text){
    loginMsg.textContent = text || "";
    loginOverlay.style.display = "flex";
    loginOverlay.setAttribute("aria-hidden","false");
    setTimeout(()=> pw.focus(), 50);
  }
  function hideLogin(){
    loginOverlay.style.display = "none";
    loginOverlay.setAttribute("aria-hidden","true");
    pw.value = "";
    loginMsg.textContent = "";
  }

  pwEye.addEventListener("click", ()=> pw.type = (pw.type === "password") ? "text" : "password");

  function doLogin(){
    const nav = loadNav();
    const auth = loadAuth(nav.length);

    const u = String(selUser.value || "").trim();
    const p = String(pw.value || "");

    const row = auth.find(a => a.username === u);
    if(!row){
      loginMsg.textContent = "æ‰¾ä¸åˆ°æ­¤å¸³è™Ÿã€‚";
      return;
    }
    if(row.password !== p){
      loginMsg.textContent = "å¯†ç¢¼éŒ¯èª¤ã€‚";
      return;
    }

    setCurrentUser({ username: row.username, level: row.level });
    hideLogin();
    render();
  }

  btnLogin.addEventListener("click", doLogin);
  pw.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doLogin(); });

  btnSwitch.addEventListener("click", ()=>{
    clearCurrentUser();
    render();
  });

  btnOpenPerm.addEventListener("click", ()=>{
    if(!isAdmin()) return;
    location.href = "æ¬Šé™è¡¨.html";
  });

  // boot
  (function boot(){
    render();
    // è‹¥æœªç™»å…¥ï¼Œå¼·åˆ¶é–‹å•Ÿç™»å…¥æ¡†
    if(!getCurrentUser()){
      showLogin("è«‹é¸æ“‡å¸³è™Ÿä¸¦è¼¸å…¥å¯†ç¢¼ç™»å…¥ã€‚");
    }
  })();
</script>
</body>
</html>
