<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun è³‡æ–™é¦–é  Â· ç©ºç„¡æ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ä¸­æ–‡ç¶²é å­—å‹ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --gold: #f6d37a;
      --gold-soft: rgba(246, 211, 122, 0.75);
      --panel-border: rgba(246, 211, 122, 0.35);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Noto Serif TC","æ¨™æ¥·é«”","Microsoft JhengHei",serif;
      background: #050302;
      color: var(--gold);
      overflow-x: hidden;
    }

    body.locked {
      overflow: hidden;
    }

    /* ==========================
       ç™»å…¥é®ç½©èˆ‡ç™»å…¥æ¡†
       ========================== */
    .login-overlay {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 50% 18%, rgba(255, 228, 170, 0.35), rgba(0, 0, 0, 0.98));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .login-box {
      width: min(380px, 90vw);
      padding: 2.4rem 2.6rem 2.2rem;
      border-radius: 18px;
      background:
        radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.28), rgba(0, 0, 0, 0.94));
      border: 1px solid var(--panel-border);
      box-shadow:
        0 0 24px rgba(0, 0, 0, 0.9),
        0 0 32px rgba(246, 211, 122, 0.25);
      color: var(--gold-soft);
    }

    .login-title {
      text-align: center;
      font-size: 1.4rem;
      letter-spacing: 0.2em;
      text-indent: 0.2em;
      margin-bottom: 1.6rem;
      text-shadow:
        0 0 8px rgba(246, 211, 122, 0.8),
        0 0 18px rgba(246, 211, 122, 0.5);
    }

    .login-field {
      margin-bottom: 1rem;
    }

    .login-field label {
      display: block;
      font-size: 0.85rem;
      letter-spacing: 0.18em;
      text-indent: 0.18em;
      margin-bottom: 0.3rem;
      color: var(--gold-soft);
    }

    .login-field input,
    .login-field select {
      width: 100%;
      padding: 0.55rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(246, 211, 122, 0.5);
      background: rgba(0, 0, 0, 0.8);
      color: var(--gold);
      outline: none;
    }

    .login-field select {
      appearance: none;
    }

    .login-field input:focus,
    .login-field select:focus {
      border-color: rgba(255, 238, 190, 0.9);
      box-shadow: 0 0 12px rgba(246, 211, 122, 0.7);
    }

    /* å¯†ç¢¼æ¬„ï¼šinput + é¡¯ç¤ºæŒ‰éˆ• */
    .login-pwd-wrapper {
      display: flex;
      align-items: center;
      gap: 0.45rem;
    }

    .login-pwd-input {
      flex: 1 1 auto;
    }

    .btn-eye-login {
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(246, 211, 122, 0.8);
      background: rgba(0, 0, 0, 0.85);
      color: var(--gold);
      font-size: 0.8rem;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    }

    .btn-eye-login:hover {
      background: rgba(246, 211, 122, 0.2);
    }

    .login-error {
      min-height: 1.1rem;
      margin-bottom: 0.4rem;
      font-size: 0.8rem;
      color: #ffb3b3;
      text-align: center;
    }

    .login-actions {
      margin-top: 0.8rem;
      display: flex;
      justify-content: center;
    }

    .btn-login {
      padding: 0.55rem 2.8rem;
      border-radius: 999px;
      border: 1px solid rgba(246, 211, 122, 0.9);
      background: radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.36), rgba(0, 0, 0, 0.98));
      color: var(--gold);
      font-size: 0.95rem;
      letter-spacing: 0.22em;
      text-indent: 0.22em;
      cursor: pointer;
      box-shadow:
        0 10px 18px rgba(0, 0, 0, 0.95),
        0 0 18px rgba(246, 211, 122, 0.5);
      transition:
        transform 0.15s ease-out,
        box-shadow 0.2s ease-out,
        background 0.2s ease-out,
        border-color 0.2s ease-out;
    }

    .btn-login:hover {
      transform: translateY(-1px);
      box-shadow:
        0 12px 22px rgba(0, 0, 0, 0.98),
        0 0 22px rgba(246, 211, 122, 0.8);
      border-color: #fff4cf;
      background: radial-gradient(circle at 0% 0%, rgba(255, 244, 208, 0.45), rgba(0, 0, 0, 0.97));
    }

    /* ==========================
       ä¸»è¦–è¦ºï¼šè“®èŠ±ï¼‹ç¦ªå­¸æ–‡å­—
       ========================== */
    .hero {
      position: relative;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      color: var(--gold);
    }

    /* è“®èŠ±ç«‹æ–¼æ°´ä¸­ï¼‹ä½›å…‰æ™®ç…§ */
    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(
          circle at 50% 12%,
          rgba(255, 237, 180, 0.85) 0,
          rgba(255, 237, 180, 0.40) 18%,
          rgba(255, 237, 180, 0.08) 40%,
          rgba(255, 237, 180, 0.0) 60%
        ),
        radial-gradient(
          ellipse at 50% 70%,
          rgba(255, 210, 140, 0.65) 0,
          rgba(255, 210, 140, 0.32) 22%,
          rgba(255, 210, 140, 0.06) 50%,
          rgba(255, 210, 140, 0.0) 70%
        ),
        radial-gradient(
          ellipse at 50% 78%,
          rgba(255, 255, 255, 0.32) 0,
          rgba(255, 255, 255, 0.18) 6%,
          rgba(255, 255, 255, 0.0) 24%
        ),
        linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.0) 38%,
          rgba(255, 240, 200, 0.13) 65%,
          rgba(0, 0, 0, 0.60) 100%
        ),
        url("é¦–é åœ–ç‰‡.png") center 72% / auto 105% no-repeat;
      z-index: -2;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(
          circle at 50% 72%,
          rgba(0, 0, 0, 0.0) 0,
          rgba(0, 0, 0, 0.28) 60%,
          rgba(0, 0, 0, 0.55) 100%
        ),
        linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.88) 0%,
          rgba(0, 0, 0, 0.62) 26%,
          rgba(0, 0, 0, 0.45) 52%,
          rgba(0, 0, 0, 0.55) 100%
        );
      z-index: -1;
    }

    .hero-inner {
      position: relative;
      width: 100vw;
      height: 100vh;
      padding: clamp(1.2rem, 2vw, 1.8rem);
    }

    /* ä½¿ç”¨è€…é¡¯ç¤ºåˆ— */
    .user-bar {
      position: fixed;
      top: 0.8rem;
      left: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      z-index: 10;
    }

    .user-pill {
      padding: 0.4rem 1.6rem;
      border-radius: 999px;
      border: 1px solid rgba(246, 211, 122, 0.7);
      background: radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.25), rgba(0, 0, 0, 0.92));
      font-size: 0.95rem;
      letter-spacing: 0.18em;
      text-indent: 0.18em;
      box-shadow:
        0 4px 10px rgba(0, 0, 0, 0.9),
        0 0 14px rgba(246, 211, 122, 0.35);
    }

    .btn-switch {
      padding: 0.35rem 1.4rem;
      border-radius: 999px;
      border: 1px solid rgba(246, 211, 122, 0.85);
      background: radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.4), rgba(0, 0, 0, 0.96));
      color: var(--gold);
      font-size: 0.9rem;
      letter-spacing: 0.16em;
      text-indent: 0.16em;
      cursor: pointer;
      box-shadow:
        0 6px 12px rgba(0,0,0,0.95),
        0 0 16px rgba(246, 211, 122, 0.5);
      transition:
        transform 0.15s ease-out,
        box-shadow 0.2s ease-out,
        background 0.2s ease-out;
    }

    .btn-switch:hover {
      transform: translateY(-1px);
      background: radial-gradient(circle at 0% 0%, rgba(255, 244, 208, 0.45), rgba(0, 0, 0, 0.97));
      box-shadow:
        0 9px 16px rgba(0, 0, 0, 0.97),
        0 0 22px rgba(246, 211, 122, 0.8);
    }

    /* ä¸Šæ–¹ Tasun æ¨™é¡Œ */
    .site-title-wrapper {
      position: absolute;
      top: 9%;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      letter-spacing: 0.38em;
      text-indent: 0.38em;
    }

    .site-title {
      font-size: clamp(3.0rem, 4.2vw, 3.8rem);
      text-shadow:
        0 0 18px rgba(246, 211, 122, 0.9),
        0 0 36px rgba(246, 211, 122, 0.7),
        0 0 58px rgba(246, 211, 122, 0.45);
    }

    /* ç™¼å…‰æ–‡å­—ç¾¤ */
    .hero-text {
      position: absolute;
      color: var(--gold);
      text-shadow:
        0 0 10px rgba(246, 211, 122, 0.9),
        0 0 24px rgba(246, 211, 122, 0.7),
        0 0 40px rgba(246, 211, 122, 0.45);
      white-space: nowrap;
      z-index: 0;
    }

    .hero-title {
      top: 36%;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(2.3rem, 3.2vw, 2.8rem);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2.2em;
    }

    .hero-left,
    .hero-right {
      top: 63%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: clamp(1.7rem, 2.4vw, 2.1rem);
    }

    .hero-left  { left: 34%; }
    .hero-right { right: 34%; }

    .hero-left span,
    .hero-right span {
      line-height: 1.3;
      letter-spacing: 0.12em;
    }

    .char-space {
      margin-top: 0.8em;
      margin-bottom: 0.3em;
    }

    .hero-bottom {
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(1.6rem, 2.2vw, 2rem);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.9em;
    }

    .hero-bottom span {
      letter-spacing: 0.16em;
    }

    /* ========== æŒ‰éˆ•å€åŸŸ ========== */
    .nav-area {
      position: absolute;
      inset: 0;
    }

    /* åŸºæœ¬æŒ‰éˆ•é€ å‹ï¼ˆä½ç½®ç”± JS + class æ§åˆ¶ï¼‰ */
    .nav-btn {
      position: absolute;
      padding: 1.05rem 2.9rem;
      border-radius: 999px;
      border: 1px solid rgba(246, 211, 122, 0.9);
      background: radial-gradient(circle at 0% 0%, rgba(246, 211, 122, 0.34), rgba(0,0,0,0.9));
      color: var(--gold);
      font-size: 1.18rem;
      letter-spacing: 0.24em;
      text-indent: 0.24em;
      text-decoration: none;
      white-space: nowrap;
      cursor: pointer;
      box-shadow:
        0 12px 24px rgba(0,0,0,0.95),
        0 0 22px rgba(246, 211, 122, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      transition:
        transform 0.2s ease-out,
        box-shadow 0.2s ease-out,
        border-color 0.2s ease-out,
        background 0.25s ease-out,
        opacity 0.2s ease-out;
      z-index: 1;
    }

    .nav-btn span { position: relative; z-index: 1; }

    .nav-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 15% 0%, rgba(255,255,255,0.45), transparent 55%);
      opacity: 0;
      transition: opacity 0.25s ease-out;
      z-index: 0;
    }

    .nav-btn:hover {
      transform: translateY(-3px);
      box-shadow:
        0 16px 30px rgba(0,0,0,0.95),
        0 0 28px rgba(246, 211, 122, 0.75);
      border-color: rgba(255, 235, 180, 0.98);
      background: radial-gradient(circle at 0% 0%, rgba(255, 240, 200, 0.38), rgba(0,0,0,0.92));
    }

    .nav-btn:hover::before { opacity: 1; }

    .nav-btn:active {
      transform: translateY(-1px);
      box-shadow:
        0 9px 18px rgba(0,0,0,0.9),
        0 0 20px rgba(246, 211, 122, 0.7);
    }

    /* å·¦å³ & å‚ç›´åˆ†å±¤ï¼Œç”± JS åŠ  class æ§åˆ¶ */
    .nav-left  { left: 16%; }
    .nav-right { right: 16%; }

    .top    { top: 30%; }
    .middle { top: 50%; }
    .bottom { top: 70%; }

    /* ç³»çµ± / æ¬Šé™ï¼šå›ºå®šå³ä¸‹è§’ */
    .nav-system {
      right: 14%;
      bottom: 12%;
    }

    /* ==========================
       æ‰‹æ©Ÿç‰ˆï¼ˆæŒ‰éˆ•è‡ªå‹•æ’ç‰ˆï¼‰
       ========================== */
    @media (max-width: 900px) {
      .hero-inner {
        width: 100vw;
        height: auto;
        min-height: 100vh;
        padding: 1.2rem 0.75rem 2.2rem;
      }

      .site-title-wrapper { top: 7%; }

      .hero-title {
        top: 34%;
        font-size: 2.0rem;
      }

      .hero-left { left: 24%; font-size: 1.5rem; }
      .hero-right { right: 24%; font-size: 1.5rem; }

      .hero-bottom {
        bottom: 8%;
        font-size: 1.5rem;
      }

      /* æ‰‹æ©Ÿï¼šæŒ‰éˆ•æ”¹ç‚ºå½ˆæ€§ä½ˆå±€ï¼Œæ”¾åœ¨è“®èŠ±ä¸‹æ–¹ï¼Œä¸é‡ç–Š */
      .nav-area {
        position: static;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.9rem;
        width: 100%;
        max-width: 100%;
        margin: min(56vh, 430px) auto 0.8rem;
        padding: 0 0.6rem 0;
      }

      .nav-btn {
        position: relative;
        flex: 0 1 calc(50% - 0.9rem);
        max-width: 320px;
        font-size: clamp(0.9rem, 2.4vw, 1.1rem);
        padding: 0.8rem 1.2rem;
        letter-spacing: 0.2em;
      }

      /* æ¸…æ‰æ¡Œæ©Ÿç”¨çš„å®šä½ classï¼ˆé¿å…å¹²æ“¾ï¼‰ */
      .nav-left,
      .nav-right,
      .top,
      .middle,
      .bottom,
      .nav-system {
        top: auto;
        bottom: auto;
        left: auto;
        right: auto;
      }
    }
  </style>
</head>
<body class="locked">
  <!-- ç™»å…¥é®ç½© -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <div class="login-title">Tasun è³‡æ–™ Â· ç™»å…¥</div>
      <form id="loginForm">
        <div class="login-field">
          <label for="username">ä½¿ç”¨è€…åç¨±</label>
          <select id="username" name="username" autocomplete="username"></select>
        </div>
        <div class="login-field">
          <label for="password">å¯†ç¢¼</label>
          <div class="login-pwd-wrapper">
            <input id="password" name="password" type="password"
                   autocomplete="current-password" class="login-pwd-input" />
            <button type="button" class="btn-eye-login" id="btnTogglePwd">ğŸ‘</button>
          </div>
        </div>
        <div class="login-error" id="loginError"></div>
        <div class="login-actions">
          <button type="submit" class="btn-login">ç™»å…¥</button>
        </div>
      </form>
    </div>
  </div>

  <main class="hero">
    <div class="hero-inner">

      <!-- ä½¿ç”¨è€…è³‡è¨Šåˆ— -->
      <div class="user-bar">
        <div class="user-pill" id="userInfo">ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥</div>
        <button class="btn-switch" id="btnSwitchUser">åˆ‡æ›å¸³è™Ÿ</button>
      </div>

      <!-- ä¸Šæ–¹ Tasun æ¨™é¡Œ -->
      <div class="site-title-wrapper">
        <div class="site-title">Tasun è³‡æ–™</div>
      </div>

      <!-- ä¸­å¤®ä¸»é¡Œï¼šç©º ç„¡ æ˜ -->
      <div class="hero-text hero-title">
        <span>ç©º</span>
        <span>ç„¡</span>
        <span>æ˜</span>
      </div>

      <!-- å·¦ï¼šç©º / éˆ / ç©º / ç„¡ / æˆ‘ -->
      <div class="hero-text hero-left">
        <span>ç©º</span>
        <span>éˆ</span>
        <span class="char-space"></span>
        <span>ç„¡</span>
        <span>æˆ‘</span>
      </div>

      <!-- å³ï¼šæ¸… / æ˜ / ç©º / å¯§ / éœ -->
      <div class="hero-text hero-right">
        <span>æ¸…</span>
        <span>æ˜</span>
        <span class="char-space"></span>
        <span>å¯§</span>
        <span>éœ</span>
      </div>

      <!-- ä¸‹ï¼šç©º ç„¡ æ˜ éœ -->
      <div class="hero-text hero-bottom">
        <span>ç©º</span>
        <span>ç„¡</span>
        <span>æ˜</span>
        <span>éœ</span>
      </div>

      <!-- ===== æŒ‰éˆ•å€ï¼ˆæ¡Œæ©Ÿï¼šå·¦å³ï¼›æ‰‹æ©Ÿï¼šè‡ªå‹•æ’ç‰ˆï¼‰ ===== -->
      <div class="nav-area">

        <!-- å·¦å´æŒ‰éˆ•ï¼šæŒ‰éˆ•1ï½3 -->
        <a class="nav-btn nav-left"
           data-side="left"
           data-button-id="btn1"
           href="è‡»é¼ç®¡ç†è¡¨.html"
           data-roles="admin,write,read">
          <span>è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨</span>
        </a>

        <a class="nav-btn nav-left"
           data-side="left"
           data-button-id="btn2"
           href="ç”„é¼quality.html"
           data-roles="admin,write,read">
          <span>ç¼ºå¤± / å“è³ª</span>
        </a>

        <a class="nav-btn nav-left"
           data-side="left"
           data-button-id="btn3"
           href="https://www.dropbox.com/"
           target="_blank" rel="noopener noreferrer"
           data-roles="admin,write,read">
          <span>é›²ç«¯æª”æ¡ˆ</span>
        </a>

        <!-- å³å´æŒ‰éˆ•ï¼šæŒ‰éˆ•4ï½5 -->
        <a class="nav-btn nav-right"
           data-side="right"
           data-button-id="btn4"
           href="å·¥ç¨‹è³‡æ–™åº«.html"
           data-roles="admin,write,read">
          <span>å·¥ç¨‹è³‡æ–™åº«</span>
        </a>

        <a class="nav-btn nav-right"
           data-side="right"
           data-button-id="btn5"
           href="è³‡æ–™åº«.html"
           data-roles="admin,write,read">
          <span>è³‡æ–™åº«</span>
        </a>

        <!-- ç³»çµ± / æ¬Šé™ï¼ˆç¬¬6é¡†ï¼Œå›ºå®š admin å³ä¸‹è§’ï¼‰ -->
        <a class="nav-btn nav-system"
           data-button-id="system"
           href="æ¬Šé™è¡¨.html"
           data-roles="admin">
          <span>ç³»çµ± / æ¬Šé™</span>
        </a>
      </div>

    </div>
  </main>

  <script>
    // èˆ‡ã€Œæ¬Šé™è¡¨.htmlã€å…±ç”¨çš„ localStorage key
    const AUTH_KEY      = "tasunAuthTable_v1";
    const CURRENT_KEY   = "tasunCurrentUser_v1";
    const BTN_LABEL_KEY = "tasunButtonLabels_v1";

    const loginOverlay = document.getElementById("loginOverlay");
    const loginForm    = document.getElementById("loginForm");
    const loginError   = document.getElementById("loginError");
    const userInfo     = document.getElementById("userInfo");
    const btnSwitch    = document.getElementById("btnSwitchUser");
    const btnTogglePwd = document.getElementById("btnTogglePwd");

    // å–å¾—æ‰€æœ‰ nav-btnï¼Œä¸¦ä¾ data-button-id å»ºç«‹é˜²å‘† map
    const allNavBtns = Array.from(document.querySelectorAll(".nav-btn"));
    const buttonMap = {};
    allNavBtns.forEach(btn => {
      const id = btn.dataset.buttonId;
      if (id) buttonMap[id] = btn;
    });

    const systemButton = buttonMap["system"] || null;

    // ä¸€èˆ¬äº”é¡†æŒ‰éˆ•ï¼ˆbtn1~btn5ï¼‰ï¼ŒæŒ‰ç…§ id æ’åºï¼Œåšç‚ºã€Œå›ºå®šé †åºã€
    const userButtons =
      Object.keys(buttonMap)
        .filter(id => id !== "system")
        .sort()              // btn1, btn2, ...
        .map(id => buttonMap[id]);

    /* ============================
       æŒ‰éˆ•åç¨±ï¼šè®€å– / å¥—ç”¨é¡¯ç¤ºæ–‡å­—
       ============================ */

    function normalizeButtonText(text) {
      return (text || "").replace(/\s+/g, " ").trim();
    }

    function loadButtonLabels() {
      const defaults = userButtons.map(btn =>
        normalizeButtonText(btn.textContent)
      );

      const raw = localStorage.getItem(BTN_LABEL_KEY);
      if (!raw) return defaults;

      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) {
          const out = [];
          for (let i = 0; i < defaults.length; i++) {
            out[i] = typeof parsed[i] === "string" && parsed[i].trim()
              ? parsed[i].trim()
              : defaults[i];
          }
          return out;
        }
      } catch (e) {}
      return defaults;
    }

    function applyButtonLabels(labels) {
      labels.forEach((label, i) => {
        const btn = userButtons[i];
        if (!btn) return;
        const span = btn.querySelector("span");
        if (span) span.textContent = label;
      });
    }

    const buttonLabels = loadButtonLabels();

    /* ============================
       æ¬Šé™è¡¨ï¼šè®€å– tasunAuthTable_v1
       ============================ */

    function getDefaultAuthTable() {
      return [
        {
          username: "alex",
          password: "Tasun08040224",
          level: "admin",
          buttons: [true, true, true, true, true]   // äº”é¡†éƒ½é¡¯ç¤º
        },
        {
          username: "tasun",
          password: "tasun08040224",
          level: "write",
          buttons: [true, true, true, true, true]
        },
        {
          username: "wu",
          password: "123456",
          level: "read",
          buttons: [false, false, false, false, true] // åªé¡¯ç¤ºã€Œè³‡æ–™åº«ã€
        }
      ];
    }

    function loadAuthTable() {
      const raw = localStorage.getItem(AUTH_KEY);
      if (!raw) {
        const defaults = getDefaultAuthTable();
        localStorage.setItem(AUTH_KEY, JSON.stringify(defaults));
        return defaults;
      }
      try {
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
      } catch (e) {}
      const defaults = getDefaultAuthTable();
      localStorage.setItem(AUTH_KEY, JSON.stringify(defaults));
      return defaults;
    }

    const AUTH_TABLE = loadAuthTable();

    /* ============================
       æ¡Œæ©Ÿç‰ˆæŒ‰éˆ•ä½ç½®æ’åº
       ============================ */

    function layoutDesktopButtons() {
      // åªé‡å°ã€Œç›®å‰æœ‰é¡¯ç¤ºã€çš„ä¸€èˆ¬æŒ‰éˆ•ï¼ˆäº”é¡†ï¼‰åšæ’åˆ—
      const visible = userButtons.filter(btn => btn.style.display !== "none");

      const left  = visible.filter(btn => btn.dataset.side === "left");
      const right = visible.filter(btn => btn.dataset.side === "right");

      function applyColumn(btns) {
        // å…ˆæ¸…é™¤èˆŠçš„ top/middle/bottom
        btns.forEach(btn => {
          btn.classList.remove("top", "middle", "bottom");
        });

        const n = btns.length;
        if (n === 1) {
          btns[0].classList.add("middle");
        } else if (n === 2) {
          btns[0].classList.add("top");
          btns[1].classList.add("bottom");
        } else if (n >= 3) {
          btns[0].classList.add("top");
          btns[1].classList.add("middle");
          btns[2].classList.add("bottom");
        }
      }

      applyColumn(left);
      applyColumn(right);
    }

    /* ============================
       è§’è‰²èˆ‡ç™»å…¥å¥—ç”¨
       ============================ */

    function roleAllowed(btn, level) {
      const rolesAttr = btn.dataset.roles || "";
      const roles = rolesAttr.split(",").map(r => r.trim());
      return roles.includes(level);
    }

    function applyUser(user, labels) {
      document.body.classList.remove("locked");
      loginOverlay.style.display = "none";

      // é¡¯ç¤ºç›®å‰ç™»å…¥è€…
      userInfo.textContent = `ç›®å‰ä½¿ç”¨è€…ï¼š${user.username} (${user.level})`;

      // å¥—ç”¨æŒ‰éˆ•é¡¯ç¤ºåç¨±
      if (Array.isArray(labels)) {
        applyButtonLabels(labels);
      }

      // å…ˆå…¨éƒ¨éš±è—
      allNavBtns.forEach(btn => {
        btn.style.display = "none";
      });

      // ä¸€èˆ¬äº”é¡†æŒ‰éˆ•ï¼šä¾æ¬Šé™è¡¨ + è§’è‰²é¡¯ç¤º
      userButtons.forEach((btn, index) => {
        const allowedByAuth =
          Array.isArray(user.buttons) && index < user.buttons.length
            ? !!user.buttons[index]
            : true;
        const allowedByRole = roleAllowed(btn, user.level);

        if (allowedByAuth && allowedByRole) {
          btn.style.display = "flex";
        }
      });

      // ç³»çµ± / æ¬Šé™ï¼šå›ºå®šåªæœ‰ admin é¡¯ç¤º
      if (systemButton) {
        systemButton.style.display =
          user.level === "admin" && roleAllowed(systemButton, user.level)
            ? "flex"
            : "none";
      }

      // é‡æ–°æ’æ¡Œæ©Ÿç‰ˆä½ç½®
      layoutDesktopButtons();
    }

    function findUser(username, password) {
      const trimmedName = (username || "").trim();
      return AUTH_TABLE.find(
        row => row.username === trimmedName && row.password === password
      );
    }

    // å°‡æ¬Šé™è¡¨å¸³è™Ÿå¡«å…¥ç™»å…¥ä¸‹æ‹‰é¸å–®ï¼ˆåªé¡¯ç¤ºå¸³è™Ÿï¼Œä¸é¡¯ç¤ºæ‹¬è™Ÿï¼‰
    function populateUserSelect() {
      const select = document.getElementById("username");
      if (!select) return;
      select.innerHTML = "";
      AUTH_TABLE.forEach(row => {
        const opt = document.createElement("option");
        opt.value = row.username;
        opt.textContent = row.username;
        select.appendChild(opt);
      });
    }

    populateUserSelect();

    /* ============================
       ç™»å…¥ / ç™»å‡º / é¡¯ç¤ºå¯†ç¢¼
       ============================ */

    loginForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const user = findUser(username, password);

      if (!user) {
        loginError.textContent = "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
        return;
      }

      loginError.textContent = "";
      // è¨˜éŒ„ç›®å‰ç™»å…¥è€…ï¼Œçµ¦ æ¬Šé™è¡¨.html ä½¿ç”¨ï¼ˆå¦‚æœæœªä¾†è¦ç”¨ï¼‰
      localStorage.setItem(
        CURRENT_KEY,
        JSON.stringify({ username: user.username, level: user.level })
      );

      applyUser(user, buttonLabels);
    });

    btnSwitch.addEventListener("click", function () {
      // ç™»å‡ºï¼šæ¸…é™¤ç›®å‰ç™»å…¥è€… + é‚„åŸç•«é¢
      localStorage.removeItem(CURRENT_KEY);

      document.body.classList.add("locked");
      loginOverlay.style.display = "flex";
      loginError.textContent = "";
      loginForm.reset();
      populateUserSelect();
      allNavBtns.forEach(btn => (btn.style.display = "none"));
      userInfo.textContent = "ç›®å‰ä½¿ç”¨è€…ï¼šæœªç™»å…¥";
    });

    // å¯†ç¢¼é¡¯ç¤º/éš±è—æŒ‰éˆ•
    btnTogglePwd.addEventListener("click", function () {
      const pwdInput = document.getElementById("password");
      if (!pwdInput) return;
      pwdInput.type = pwdInput.type === "password" ? "text" : "password";
    });

    // é è¨­ï¼šä¸€é–‹å§‹éš±è—æ‰€æœ‰æŒ‰éˆ•ï¼Œç­‰ç™»å…¥å¾Œå†é¡¯ç¤º
    (function init() {
      allNavBtns.forEach(btn => (btn.style.display = "none"));
    })();
  </script>
</body>
</html>
