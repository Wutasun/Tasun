<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun Ë≥áÊñôÈ¶ñÈ†Å ¬∑ Á©∫ÁÑ°Êòé</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- ‚úÖ‚úÖ‚úÖ Âº∑Âà∂„ÄåÊúÄÊñ∞Áâà‰∏ÄËá¥„ÄçÔºöÊîπ APP_VER Â∞±ÊúÉËÆìÊâÄÊúâË£ùÁΩÆÁ´ãÂàªÊõ¥Êñ∞Âà∞Êñ∞ÁâàÊú¨ -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <script>
  (function () {
    /**
     * ‚úÖ‰Ω†ÊØèÊ¨°Êõ¥Êñ∞ index.htmlÔºàÊàñÊÉ≥Âº∑Âà∂ÊâÄÊúâ‰∫∫ÂêåÊ≠•ÔºâÂè™Ë¶ÅÊîπÈÄôÂÄãÂ≠ó‰∏≤Âç≥ÂèØ„ÄÇ
     * Âª∫Ë≠∞Ê†ºÂºèÔºöYYYYMMDDHHmm Êàñ YYYY-MM-DD-Â∫èËôü
     */
    const APP_VER = "20260126_01";   // ‚Üê‚Üê‚Üê ÊØèÊ¨°ÊîπÁâàË´ãÊîπÈÄôË£°ÔºàÈùûÂ∏∏ÈáçË¶ÅÔºâ
    const VER_KEY = "tasun_app_ver_index_v1";
    const TAB_GUARD = "tasun_tab_replaced_once_v1";

    const u = new URL(location.href);

    // Ë®òÈåÑÁõÆÂâçÁúãÈÅéÁöÑÁâàÊú¨ÔºàÊñπ‰æøÂà§Êñ∑ÊòØÂê¶ÂçáÁâàÔºâ
    const last = localStorage.getItem(VER_KEY) || "";
    if (last !== APP_VER) {
      localStorage.setItem(VER_KEY, APP_VER);
      // ÂçáÁâàÊôÇÔºåÂÖÅË®±Êú¨ÂàÜÈ†ÅÈáçÊñ∞ replace ‰∏ÄÊ¨°
      try { sessionStorage.removeItem(TAB_GUARD); } catch(e){}
    }

    // ËÆìÂÖ®Á´ôË≥áÊ∫ê‰∏ÄÂæãË∑üËëó APP_VERÔºàÂêåÁâàÊú¨ÁöÑ‰∫∫‰∏ÄÂÆöÊãøÂà∞Âêå‰∏ÄÊâπÊ™îÊ°àÔºâ
    window.__CACHE_V = APP_VER;

    window.__withV = function(url){
      const vv = (window.__CACHE_V || "").trim();
      if(!vv) return url;
      try{
        const uu = new URL(url, document.baseURI);
        if (uu.origin === location.origin) uu.searchParams.set("v", vv);
        return uu.toString();
      }catch(e){ return url; }
    };

    // ‚úÖËã•Á∂≤ÂùÄ v ‰∏çÊòØ APP_VER ‚Üí Âº∑Âà∂Â∞éÂêëÂêåÁâàÊú¨ URLÔºàÈÅøÂÖçÂêÉÂà∞ËàäÂø´ÂèñÔºâ
    const curV = (u.searchParams.get("v") || "").trim();
    const alreadyReplaced = (() => {
      try { return sessionStorage.getItem(TAB_GUARD) === "1"; } catch(e){ return false; }
    })();

    if (curV !== APP_VER && !alreadyReplaced) {
      try { sessionStorage.setItem(TAB_GUARD, "1"); } catch(e){}
      u.searchParams.set("v", APP_VER);
      location.replace(u.toString());
      return;
    }
  })();
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link id="preloadZen" rel="preload" as="image" href="‰ΩõÊïôÁ¶™ÊÑè‰∏ªË¶ñË¶∫.png">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <script>
  (function(){
    const pre = document.getElementById("preloadZen");
    if(!pre || !window.__withV) return;
    pre.href = window.__withV(pre.getAttribute("href") || pre.href);
  })();
  </script>

  <style>
    :root{
      /* ===== ‚úÖÊï¥È´îÊõ¥„ÄåÂÖâÊòé„ÄçÔºöÂ∫ïÂúñ‰∏çÈªë„ÄÅ‰∏äÊñπÊîπÊàê„ÄåÊ∑°ÈúßÂÜ∑ÁôΩ„Äç‰∏çÂÅèÈªÉ ===== */
      --gold:#f6d37a;

      /* ‚úÖÊï¥È´îÊõùÂÖâÔºöÊòé‰∫Æ‰ΩÜ‰∏çÂà∫Áúº */
      --exposure: 1.05;
      --ambient-op: 0.44;

      /* Â§ñÊ°ÜÁïôÁôΩ */
      --outer-side: clamp(14px, 2.0vw, 56px);

      /* ÂÖßÊ°ÜÔºàËàûÂè∞Ôºâ */
      --frame-inset: clamp(18px, 1.6vw, 28px);
      --frame-radius: clamp(22px, 2vw, 34px);

      --stage-top: var(--frame-inset);
      --glass-inset: var(--frame-inset);

      /* ‚úÖËìÆËä±Êõ¥„ÄåÊ∏ÖÊæà„Äç‰ΩÜ‰∏çË¶ÅÂ§™‰∫Æ */
      --zen-opacity: 0.98;
      --zen-scale: 1.00;
      --zen-contrast: 1.22;
      --zen-bright: 1.08;
      --zen-sat: 1.05;
      --zen-posX: 50%;
      --zen-posY: 50%;

      /* ‚úÖÊ∂≤ÂåñÊ≥¢Á¥ãÔºöÂÜçËºï‰∏ÄÈªûÔºåÈÅøÂÖçÊ¥óÂ≠ó */
      --ripple-op: .006;
      --ripple-speed: 24s;

      /* Â∑¶Âè≥ÁéªÁíÉÔºöÊõ¥Ê∑°Êõ¥‰πæÊ∑® */
      --sideglass-w: clamp(120px, 8.0vw, 200px);
      --sideglass-op: .105;
      --sideglass-hi: rgba(255,255,255,.12);
      --sideglass-hi2: rgba(255,255,255,.05);
      --sideglass-gold: rgba(246,211,122,.075);
      --sideglass-dark: rgba(20,14,10,.002);

      /* ‚úÖÂéªÈúßÂåñÔºöÊï¥È´î blur ÂÜçÈôçÔºàËÆìËä±Áì£ÂΩ¢ÊÖãÊõ¥Ê∏ÖÊô∞Ôºâ */
      --stage-blur: 4.5px;
      --panel-blur: 4.5px;
      --btn-blur: 3.6px;
      --btn-blur-m: 3.8px;

      /* Ê®ôÈ°å */
      --title-top: calc(0.9rem + env(safe-area-inset-top));
      --title-shift: clamp(44px, 6.6vh, 104px);
      --title-size: clamp(2.65rem, 4.9vw, 4.15rem);

      /* ‚úÖ‰∏äÊñπ„ÄåÁ©∫/ÁÑ°/Êòé„ÄçÔºöÁî± JS Ëá™ÂãïÁÆó */
      --axis-top: clamp(140px, 18vh, 320px);
      --axis-gap: clamp(96px, 12vw, 240px);

      /* ‚úÖÂ∑¶Âè≥Á∏±ÊéíÔºàË≤ºËøëËìÆËä±Êú¨È´îÔºâÔºöÁî± JS ÂêåÊ≠•‰ΩçÁΩÆ */
      --zen-side-cx: 320px;
      --zen-side-cy: 50%;

      /* ===== ‚úÖÈªÉÊ∞¥Êô∂ÔºöÊõ¥Ê∑±Èáë„ÄÅÊõ¥Èä≥Âà©Ôºå‰ΩÜ„Äå‰∏çÁôºÈªë„Äç ===== */
      --crystalA: #ffffff;
      --crystalB: #fff2cf;
      --crystalC: #cf8a1f;
      --crystalD: #7a3d12;

      --txt-gold-strong: rgba(255, 226, 160, 0.998);
      --txt-stroke: rgba(112, 60, 18, 0.64);
      --txt-shadow-1: rgba(28, 14, 6, 0.24);
      --txt-shadow-2: rgba(28, 14, 6, 0.16);
      --txt-glow: rgba(255, 224, 150, 0.12);
      --txt-hi: rgba(255,255,255,0.10);

      /* ‚úÖÊåâÈçµÁéªÁíÉÔºöÊõ¥Ê∑°Êõ¥Ëºï */
      --btn-glass-a: 0.038;
      --btn-glass-b: 0.018;
      --btn-border: rgba(246, 211, 122, 0.38);

      --btn-spotA: rgba(255,255,255,.09);
      --btn-spotB: rgba(246,211,122,.06);
      --btn-spot-op: .22;

      /* ‚úÖ‰∏≠Â§ÆÊäïÂ∞ÑÁáàÔºöÈôçÂº∑Â∫¶ÈÅøÂÖçÊ¥óÁôΩËä±Áì£Ëº™Âªì */
      --lotus-spot-op: .26;

      /* ‚úÖÂúñÊ®ôÁ§∫2ÔºöÁÖôÈúßÊõ¥Ê∑°„ÄÅÊõ¥ÂÜ∑ÁôΩ„ÄÅblur Êõ¥Â§ß„ÄÅÊºÇÁßªÊõ¥ÊÖ¢Êõ¥ËºïÔºàÊùüÁãÄÔºâ */
      --mist-op: .22;
      --mist-a: rgba(235,245,255,0.18);
      --mist-b: rgba(225,238,250,0.12);
      --mist-c: rgba(255,255,255,0.06);
      --mist-beam: rgba(240,248,255,0.10);
      --mist-blur: 22px;
      --mist-speed: 44s;

      /* ÊâãÊ©ü nav ÂÆâÂÖ®ÂçÄ */
      --nav-top-m: calc(var(--frame-inset) + 96px);
      --nav-bottom-m: calc(var(--frame-inset) + 18px);

      /* ===== ‚úÖÁôªÂÖ•ÂçÄÂ∞àÁî® ===== */
      --login-border: rgba(246,211,122,0.62);
      --login-border2: rgba(255,244,210,0.22);

      --login-solid-top: rgba(34, 22, 12, 0.96);
      --login-solid-bot: rgba(15, 10, 6, 0.97);
      --login-hi: rgba(255,250,235,0.16);
      --login-hi2: rgba(246,211,122,0.12);

      --login-field-bg: rgba(10, 7, 4, 0.78);
      --login-field-bg2: rgba(255,250,235,0.08);

      --login-ink: rgba(246,211,122,0.99);
      --login-stroke: rgba(0,0,0,0.40);
      --login-shadow-a: rgba(10,6,2,0.34);
      --login-shadow-b: rgba(10,6,2,0.22);

      --login-inner-inset: 10px;
      --login-metal-a: rgba(255,250,235,0.22);
      --login-metal-b: rgba(246,211,122,0.20);
      --login-metal-c: rgba(120,70,18,0.22);
      --login-frost: rgba(255,255,255,0.055);
      --login-grain: rgba(255,255,255,0.03);
      --login-corner-hi: rgba(255,244,210,0.22);
      --login-corner-hi2: rgba(255,255,255,0.14);
      --login-thickness: rgba(0,0,0,0.28);
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html, body { height: 100%; }

    body{
      min-height:100vh;
      font-family:"Noto Serif TC","Ê®ôÊ•∑È´î","Microsoft JhengHei",serif;
      color:var(--gold);
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;

      background:
        radial-gradient(1200px 760px at 50% 8%, rgba(255,255,255,var(--ambient-op)) 0, rgba(235,240,245,0.16) 46%, rgba(0,0,0,0) 82%),
        radial-gradient(980px 560px at 50% 92%, rgba(246,211,122,0.10) 0, rgba(0,0,0,0) 74%),
        linear-gradient(180deg, #6b5a46 0%, #4a3b2e 46%, #33281f 100%);
      filter: brightness(var(--exposure)) saturate(1.02);
    }
    body.locked{ overflow:hidden; }

    body.booting .hero-inner::before,
    body.booting .hero-inner::after,
    body.booting .lotus-stage,
    body.booting .side-glass,
    body.booting .ripple-film,
    body.booting .mist-film{
      backdrop-filter:none !important;
      -webkit-backdrop-filter:none !important;
      filter:none !important;
    }
    body.booting .ripple-film{ opacity: 0 !important; }
    body.booting .mist-film{ opacity: 0 !important; }

    /* ===== ÁôªÂÖ• ===== */
    .login-overlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      z-index:999;
      background:
        radial-gradient(900px 540px at 50% 26%, rgba(255,244,210,0.18), rgba(0,0,0,0) 60%),
        radial-gradient(circle at 50% 20%, rgba(255,244,210,0.30), rgba(18,12,7,0.92));
    }

    .login-box{
      width: min(640px, 94vw);
      padding: clamp(1.55rem, 3.6vw, 2.25rem) clamp(1.30rem, 3.9vw, 2.50rem) clamp(1.25rem, 3.6vw, 2.10rem);
      border-radius: 24px;
      background:
        radial-gradient(120% 140% at 16% 12%, var(--login-hi), rgba(0,0,0,0) 62%),
        radial-gradient(120% 140% at 72% 18%, var(--login-hi2), rgba(0,0,0,0) 66%),
        repeating-linear-gradient(
          135deg,
          rgba(255,255,255,0.00) 0 8px,
          var(--login-grain) 8px 9px,
          rgba(255,255,255,0.00) 9px 18px
        ),
        radial-gradient(120% 120% at 50% 40%, var(--login-frost), rgba(0,0,0,0) 62%),
        linear-gradient(180deg, var(--login-solid-top), var(--login-solid-bot));
      border: 1.5px solid var(--login-border);
      box-shadow:
        0 34px 96px rgba(0,0,0,0.68),
        0 14px 34px rgba(26,14,4,0.46),
        0 0 34px rgba(246,211,122,0.20),
        inset 0 1px 0 rgba(255,255,255,0.11),
        inset 0 0 0 1px rgba(0,0,0,0.26),
        inset 0 -22px 42px var(--login-thickness);
      color: rgba(246,211,122,0.92);
      transform: translateY(-10px) scale(1.00);
      position: relative;
      isolation: isolate;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
    }

    .login-box::before{
      content:"";
      position:absolute;
      inset: var(--login-inner-inset);
      border-radius: calc(24px - var(--login-inner-inset));
      pointer-events:none;
      z-index:1;
      background:
        radial-gradient(220px 160px at 0% 0%,   var(--login-corner-hi2), rgba(0,0,0,0) 62%),
        radial-gradient(220px 160px at 100% 0%, var(--login-corner-hi),  rgba(0,0,0,0) 64%),
        radial-gradient(240px 180px at 0% 100%, rgba(246,211,122,0.14), rgba(0,0,0,0) 66%),
        radial-gradient(240px 180px at 100% 100%, rgba(255,255,255,0.10), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(255,255,255,0.12), rgba(0,0,0,0.16)),
        linear-gradient(90deg,  rgba(255,255,255,0.08), rgba(0,0,0,0.10) 50%, rgba(255,255,255,0.05));
      box-shadow:
        inset 0 0 0 1px var(--login-border2),
        inset 0 0 0 2px rgba(0,0,0,0.20),
        inset 0 18px 28px rgba(255,255,255,0.035),
        inset 0 -20px 34px rgba(0,0,0,0.30);
      opacity: .92;
      mix-blend-mode: normal;
      filter: saturate(1.05) contrast(1.06);
    }

    .login-box::after{
      content:"";
      position:absolute;
      left: 7%;
      right: 7%;
      bottom: -18px;
      height: 34px;
      background: radial-gradient(closest-side, rgba(0,0,0,0.56), rgba(0,0,0,0));
      filter: blur(12px);
      opacity: .95;
      z-index: -1;
      pointer-events:none;
    }
    .login-box > *{ position:relative; z-index:2; }

    .login-title{
      text-align:center;
      font-size: clamp(1.75rem, 4.6vw, 2.35rem);
      letter-spacing: .22em;
      text-indent: .22em;
      margin-bottom: .60rem;
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-weight: 900;
    }

    .login-sub{
      text-align:center;
      font-size: clamp(.92rem, 2.6vw, 1.06rem);
      letter-spacing:.12em;
      text-indent:.12em;
      margin: 0 0 1.15rem;
      min-height: 1.2rem;
      color: var(--txt-gold-strong);
      -webkit-text-stroke: .90px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 4px 8px var(--login-shadow-a);
      opacity: .995;
    }

    .crystal-ui{
      isolation:isolate;
      mix-blend-mode: normal;
      color: var(--txt-gold-strong);
      -webkit-text-stroke: 1.06px var(--txt-stroke);
      text-shadow:
        0 1px 0 var(--txt-shadow-2),
        0 2px 5px var(--txt-shadow-1),
        0 0 6px var(--txt-glow),
        0 -1px 4px var(--txt-hi);
      filter: saturate(1.28) contrast(1.34);
      paint-order: stroke fill;
    }
    @supports (-webkit-background-clip:text){
      .crystal-ui{
        background: linear-gradient(180deg, var(--crystalA) 0%, var(--crystalB) 32%, var(--crystalC) 74%, var(--crystalD) 100%);
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
    }

    .login-field{ margin-bottom: 1.10rem; }

    .login-field label{
      display:block;
      font-size: clamp(.95rem, 2.5vw, 1.05rem);
      letter-spacing:.18em;
      text-indent:.18em;
      margin-bottom:.42rem;

      color: var(--txt-gold-strong);
      -webkit-text-stroke: .90px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 4px 8px var(--login-shadow-a);
      opacity: .995;
    }

    .login-field input, .login-field select{
      width:100%;
      padding: .74rem .92rem;
      border-radius:999px;
      border:1px solid rgba(246,211,122,0.72);

      background:
        linear-gradient(180deg, var(--login-field-bg2), rgba(0,0,0,0.00)),
        linear-gradient(180deg, var(--login-field-bg), rgba(0,0,0,0.40));

      outline:none;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;

      color: var(--login-ink);
      caret-color: var(--login-ink);

      -webkit-text-stroke: .70px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 4px 8px var(--login-shadow-a);

      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.06),
        0 12px 20px rgba(0,0,0,0.22);

      color-scheme: dark;
    }

    #username option{
      background: rgba(8,5,3,0.98);
      color: rgba(246,211,122,0.98);
    }
    #username option:disabled{
      color: rgba(246,211,122,0.62);
    }

    .login-field input::placeholder{
      color: rgba(246,211,122,0.62);
      -webkit-text-stroke: 0;
      text-shadow: none;
    }

    .login-field input:focus, .login-field select:focus{
      border-color: rgba(255,244,210,0.94);
      box-shadow:
        0 0 0 2px rgba(246,211,122,0.18),
        0 0 20px rgba(246,211,122,0.30),
        inset 0 1px 0 rgba(255,255,255,0.08);
    }

    .login-pwd-wrapper{ display:flex; align-items:center; gap:.50rem; }
    .login-pwd-input{ flex:1 1 auto; }

    .btn-eye-login{
      padding:.34rem .88rem;
      border-radius:999px;
      border:1px solid rgba(246,211,122,0.80);
      background: rgba(0,0,0,0.30);
      cursor:pointer;
      box-shadow:0 12px 20px rgba(0,0,0,0.30);

      color: var(--txt-gold-strong);
      -webkit-text-stroke: .7px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 4px 8px var(--login-shadow-a);

      backdrop-filter:none;
      -webkit-backdrop-filter:none;
    }
    .btn-eye-login:hover{ background: rgba(255,244,210,0.10); }

    .login-error{
      min-height:1.15rem;
      margin-bottom:.45rem;
      font-size: .86rem;
      text-align:center;
      color:#ffb3b3;
      text-shadow: 0 2px 10px rgba(0,0,0,0.34);
    }

    .login-actions{
      margin-top:.95rem;
      display:flex;
      justify-content:center;
      gap:.70rem;
      flex-wrap:wrap;
    }

    .btn-login{
      padding:.70rem 2.65rem;
      border-radius:999px;
      border:1px solid rgba(246,211,122,0.80);
      background:
        radial-gradient(circle at 18% 18%, rgba(255,244,210,0.22), rgba(255,255,255,0.06) 55%, rgba(0,0,0,0.34));
      cursor:pointer;
      box-shadow:
        0 16px 30px rgba(0,0,0,0.44),
        0 0 20px rgba(246,211,122,0.16);
      transition:transform .15s ease-out, box-shadow .2s ease-out, background .2s ease-out, border-color .2s ease-out;
      letter-spacing:.22em; text-indent:.22em;
      font-size: clamp(1.02rem, 2.9vw, 1.14rem);
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-weight:900;
      backdrop-filter:none;
      -webkit-backdrop-filter:none;
    }
    .btn-login:hover{
      transform:translateY(-1px);
      box-shadow:
        0 18px 34px rgba(0,0,0,0.46),
        0 0 24px rgba(246,211,122,0.22);
      border-color:#fff4cf;
      background:
        radial-gradient(circle at 18% 18%, rgba(255,244,210,0.26), rgba(255,255,255,0.06) 55%, rgba(0,0,0,0.34));
    }

    .btn-secondary{
      padding:.70rem 1.85rem;
      border-radius:999px;
      border:1px solid rgba(246,211,122,0.62);
      background: rgba(0,0,0,0.28);
      cursor:pointer;
      box-shadow:0 14px 24px rgba(0,0,0,0.34);
      transition:transform .15s ease-out, border-color .2s ease-out, background .2s ease-out;
      letter-spacing:.16em; text-indent:.16em;
      font-size: clamp(.98rem, 2.8vw, 1.08rem);
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-weight:900;

      color: var(--txt-gold-strong);
      -webkit-text-stroke: .90px var(--login-stroke);
      text-shadow: 0 1px 0 var(--login-shadow-b), 0 4px 8px var(--login-shadow-a);
      backdrop-filter:none;
      -webkit-backdrop-filter:none;
    }
    .btn-secondary:hover{
      transform:translateY(-1px);
      border-color:#fff4cf;
      background: rgba(255,244,210,0.10);
    }

    /* ===== ËàûÂè∞ ===== */
    .hero{
      position:relative;
      height: var(--appH, 100svh);
      min-height: var(--appH, 100svh);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      color:var(--gold);
    }

    .hero::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 50% 10%,
          rgba(255,255,255,0.78) 0,
          rgba(235,242,250,0.26) 34%,
          rgba(255,255,255,0.10) 56%,
          rgba(0,0,0,0.00) 84%),
        radial-gradient(1100px 720px at 50% 62%,
          rgba(255,244,210,0.06) 0,
          rgba(246,211,122,0.045) 44%,
          rgba(0,0,0,0.00) 82%);
      z-index:-6;
    }
    .hero::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 50% 64%, rgba(255,255,255,0.05) 0, rgba(0,0,0,0.00) 68%),
        radial-gradient(circle at 50% 94%, rgba(0,0,0,0.00) 0, rgba(26,14,4,0.012) 74%, rgba(26,14,4,0.02) 100%);
      z-index:-5;
      pointer-events:none;
    }

    .hero-inner{
      position:relative;
      width: calc(100vw - (2 * var(--outer-side)));
      height: var(--appH, 100svh);
      margin:0 var(--outer-side);
      padding: 0;
      isolation:isolate;
      contain: layout paint;
    }

    .hero-inner::before{
      content:"";
      position:absolute;
      inset:var(--frame-inset);
      border-radius:var(--frame-radius);
      background:
        radial-gradient(circle at 50% 46%, rgba(255,255,255,0.14), rgba(0,0,0,0.00) 68%),
        linear-gradient(180deg, rgba(255,255,255,0.045), rgba(42,24,6,0.010));
      backdrop-filter: blur(var(--stage-blur)) saturate(1.08);
      -webkit-backdrop-filter: blur(var(--stage-blur)) saturate(1.08);
      opacity: .995;
      z-index:-6;
      pointer-events:none;
    }
    .hero-inner::after{
      content:"";
      position:absolute;
      inset:var(--frame-inset);
      border-radius:var(--frame-radius);
      background:
        radial-gradient(circle at 50% 16%, rgba(255,255,255,0.06), rgba(255,255,255,0.00) 60%),
        linear-gradient(180deg, rgba(255,255,255,0.028), rgba(255,255,255,0.012));
      border:1px solid rgba(246,211,122,0.22);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.070),
        0 0 18px rgba(26,14,4,0.10),
        0 0 34px rgba(246,211,122,0.18);
      z-index:-5;
      pointer-events:none;
    }

    .ripple-film{
      position:absolute;
      inset:var(--frame-inset);
      border-radius:var(--frame-radius);
      pointer-events:none;
      z-index:-4;
      opacity: var(--ripple-op);
      mix-blend-mode: screen;
      background:
        repeating-radial-gradient(circle at 34% 42%,
          rgba(255,255,255,0.10) 0 1px,
          rgba(255,255,255,0.00) 6px 18px),
        repeating-radial-gradient(circle at 70% 60%,
          rgba(246,211,122,0.06) 0 1px,
          rgba(0,0,0,0.00) 7px 22px);
      filter: blur(.10px);
      mask-image: radial-gradient(circle at 50% 55%, rgba(0,0,0,1) 0 62%, rgba(0,0,0,0) 90%);
      -webkit-mask-image: radial-gradient(circle at 50% 55%, rgba(0,0,0,1) 0 62%, rgba(0,0,0,0) 90%);
      animation: rippleMove var(--ripple-speed) ease-in-out infinite;
    }
    @keyframes rippleMove{
      0%{ background-position: 0% 0%, 0% 0%; transform: translateY(0px); }
      50%{ background-position: 12% 7%, -9% 10%; transform: translateY(-1px); }
      100%{ background-position: 0% 0%, 0% 0%; transform: translateY(0px); }
    }
    @media (prefers-reduced-motion: reduce){ .ripple-film{ animation:none; } }

    .mist-film{
      position:absolute;
      inset:var(--frame-inset);
      border-radius:var(--frame-radius);
      pointer-events:none;
      z-index:-3;
      opacity: var(--mist-op);

      background:
        repeating-linear-gradient(
          90deg,
          rgba(0,0,0,0) 0 10px,
          var(--mist-beam) 10px 14px,
          rgba(0,0,0,0) 14px 34px
        ),
        radial-gradient(560px 280px at 24% 14%, var(--mist-a), rgba(0,0,0,0) 72%),
        radial-gradient(600px 300px at 74% 18%, var(--mist-b), rgba(0,0,0,0) 74%),
        radial-gradient(760px 340px at 52% 10%, var(--mist-c), rgba(0,0,0,0) 76%),
        radial-gradient(460px 240px at 38% 26%, rgba(255,255,255,0.07), rgba(0,0,0,0) 74%),
        radial-gradient(520px 260px at 66% 30%, rgba(235,244,252,0.06), rgba(0,0,0,0) 76%);

      filter: blur(var(--mist-blur));
      mix-blend-mode: soft-light;

      mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 18%, rgba(0,0,0,0) 60%);
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 18%, rgba(0,0,0,0) 60%);

      animation: mistDrift var(--mist-speed) ease-in-out infinite;
      transform: translateZ(0);
      background-size: 220% 100%, 120% 100%, 120% 100%, 120% 100%, 120% 100%, 120% 100%;
      background-position: 0% 0%, 50% 0%, 50% 0%, 50% 0%, 50% 0%, 50% 0%;
    }
    @keyframes mistDrift{
      0%{
        transform: translate3d(0, 3px, 0) scale(1.00);
        opacity: var(--mist-op);
        background-position: 0% 0%, 50% 0%, 50% 0%, 50% 0%, 50% 0%, 50% 0%;
      }
      50%{
        transform: translate3d(14px, -14px, 0) scale(1.02);
        opacity: calc(var(--mist-op) * 0.90);
        background-position: 18% 0%, 52% 0%, 48% 0%, 50% 0%, 52% 0%, 48% 0%;
      }
      100%{
        transform: translate3d(0, 3px, 0) scale(1.00);
        opacity: var(--mist-op);
        background-position: 0% 0%, 50% 0%, 50% 0%, 50% 0%, 50% 0%, 50% 0%;
      }
    }
    @media (prefers-reduced-motion: reduce){ .mist-film{ animation:none; } }

    .side-glass{
      position:absolute;
      top: var(--stage-top);
      bottom: var(--frame-inset);
      width: var(--sideglass-w);
      pointer-events:none;
      border-radius: calc(var(--frame-radius) - 12px);
      z-index:8;
      opacity: var(--sideglass-op);
      background:
        radial-gradient(150% 140% at 18% 16%, var(--sideglass-hi), rgba(255,255,255,0.00) 58%),
        radial-gradient(160% 170% at 70% 26%, var(--sideglass-gold), rgba(0,0,0,0.00) 64%),
        radial-gradient(160% 200% at 40% 70%, var(--sideglass-hi2), rgba(0,0,0,0.00) 70%),
        linear-gradient(180deg, rgba(255,255,255,0.022), var(--sideglass-dark));
      backdrop-filter: blur(var(--panel-blur)) saturate(1.10);
      -webkit-backdrop-filter: blur(var(--panel-blur)) saturate(1.10);
      box-shadow:
        0 18px 52px rgba(26,14,4,0.08),
        0 0 30px rgba(246,211,122,0.14),
        inset 0 0 0 1px rgba(255,255,255,0.045),
        inset 0 18px 28px rgba(255,255,255,0.016);
      overflow:hidden;
      filter: brightness(1.10);
    }
    .side-glass::before{
      content:"";
      position:absolute;
      left: 16%;
      top: -60%;
      width: 24%;
      height: 120%;
      background: radial-gradient(circle at 32% 45%, rgba(255,255,255,0.12), rgba(255,255,255,0.00) 74%);
      transform: rotate(10deg);
      opacity: .16;
      filter: blur(.85px);
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .side-glass::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(680px 210px at 50% 0%, rgba(246,211,122,0.10), rgba(0,0,0,0.00) 64%);
      opacity: .22;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .side-glass-left{ left: var(--glass-inset); }
    .side-glass-right{ right: var(--glass-inset); }

    .lotus-stage{
      position:absolute;
      top: var(--stage-top);
      bottom: var(--frame-inset);
      left:  var(--frame-inset);
      right: var(--frame-inset);
      border-radius: calc(var(--frame-radius) - 2px);
      overflow:hidden;
      pointer-events:none;
      z-index:6;
      background:
        radial-gradient(circle at 50% 54%, rgba(255,255,255,0.14), rgba(0,0,0,0.00) 74%),
        radial-gradient(circle at 50% 66%, rgba(255,255,255,0.05), rgba(0,0,0,0.00) 82%),
        linear-gradient(180deg, rgba(255,255,255,0.018), rgba(42,24,6,0.003));
      box-shadow:
        0 22px 60px rgba(26,14,4,0.08),
        0 0 44px rgba(246,211,122,0.13),
        inset 0 18px 30px rgba(255,255,255,0.010);
      backdrop-filter: blur(var(--panel-blur)) saturate(1.10);
      -webkit-backdrop-filter: blur(var(--panel-blur)) saturate(1.10);
      transform: translateZ(0);
      contain: paint;
      filter: brightness(1.04);
    }
    .lotus-stage::before{
      content:"";
      position:absolute;
      left: 20%;
      top: -64%;
      width: 22%;
      height: 124%;
      background: radial-gradient(circle at 30% 42%, rgba(255,255,255,0.09), rgba(255,255,255,0.00) 74%);
      transform: rotate(9deg);
      opacity:.10;
      filter: blur(.90px);
      pointer-events:none;
      mix-blend-mode: screen;
      z-index:3;
    }
    .lotus-stage::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(920px 260px at 50% 0%, rgba(255,255,255,0.09), rgba(0,0,0,0.00) 72%);
      opacity:.16;
      pointer-events:none;
      mix-blend-mode: screen;
      z-index:3;
    }

    .lotus-stage .zen-visual::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(920px 540px at 50% 58%,
          rgba(255,255,255,0.08) 0%,
          rgba(255,255,255,0.04) 24%,
          rgba(0,0,0,0.00) 62%),
        radial-gradient(1100px 680px at 50% 56%,
          rgba(255,244,210,0.030) 0%,
          rgba(0,0,0,0.00) 76%);
      mix-blend-mode: soft-light;
      opacity: .12;
      pointer-events:none;
    }

    .spotlight{
      position:absolute;
      inset:-2px;
      z-index:4;
      pointer-events:none;
      background:
        radial-gradient(980px 620px at 50% 54%,
          rgba(255,255,255,0.26) 0,
          rgba(255,255,255,0.12) 34%,
          rgba(246,211,122,0.06) 62%,
          rgba(0,0,0,0.00) 86%),
        radial-gradient(720px 420px at 50% 64%,
          rgba(255,255,255,0.10) 0,
          rgba(0,0,0,0.00) 80%);
      opacity: var(--lotus-spot-op);
      mix-blend-mode: screen;
      filter: blur(.85px);
    }

    .zen-visual{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      opacity: var(--zen-opacity);
      pointer-events:none;
      z-index:2;
    }
    .zen-visual img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: var(--zen-posX) var(--zen-posY);
      transform: scale(var(--zen-scale)) translateZ(0);
      filter:
        saturate(var(--zen-sat))
        contrast(var(--zen-contrast))
        brightness(var(--zen-bright))
        drop-shadow(0 7px 12px rgba(26,14,4,0.07));
      image-rendering: auto;
    }

    /* ===== ‰ΩøÁî®ËÄÖÂàó ===== */
    .user-bar{
      position:fixed;
      top: calc(var(--outer-side) + var(--frame-inset) + 6px + env(safe-area-inset-top));
      left: calc(var(--outer-side) + var(--frame-inset) + 10px + env(safe-area-inset-left));
      display:flex;
      align-items:center;
      gap:.80rem;
      flex-wrap: wrap;
      row-gap: .55rem;
      max-width: calc(100vw - (2 * (var(--outer-side) + 10px)));
      pointer-events:none;
      z-index:60;
      isolation:isolate;
    }
    .user-pill, .btn-switch{ pointer-events:auto; }

    .user-pill,
    .btn-switch{
      position:relative;
      border-radius:999px;
      cursor:pointer;
      white-space:nowrap;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;

      isolation:isolate;
      mix-blend-mode: normal;
      background: linear-gradient(180deg, var(--crystalA) 0%, var(--crystalB) 32%, var(--crystalC) 74%, var(--crystalD) 100%);
      -webkit-background-clip:text;
      background-clip:text;
      -webkit-text-fill-color: transparent;
      color: transparent;

      -webkit-text-stroke: 1.02px var(--txt-stroke);
      text-shadow:
        0 1px 0 var(--txt-shadow-2),
        0 2px 5px var(--txt-shadow-1),
        0 0 6px var(--txt-glow);
      filter: saturate(1.28) contrast(1.34);
      paint-order: stroke fill;
    }

    .user-pill{
      padding:.30rem 1.02rem;
      border:1px solid rgba(246,211,122,0.34);
      font-size:.82rem;
      letter-spacing:.08em;
      opacity:.995;
      box-shadow:0 8px 18px rgba(26,14,4,0.12), 0 0 14px rgba(246,211,122,0.10);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .user-pill::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:999px;
      z-index:-1;
      background:
        radial-gradient(circle at 18% 18%, rgba(255,255,255,0.10), rgba(255,255,255,0.03) 55%, rgba(42,24,6,0.10));
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.018);
      pointer-events:none;
    }

    .btn-switch{
      padding:.26rem .98rem;
      border:1px solid rgba(246,211,122,0.40);
      font-size:.80rem;
      letter-spacing:.08em;
      opacity:.995;
      box-shadow:0 9px 18px rgba(26,14,4,0.14), 0 0 14px rgba(246,211,122,0.10);
      transition:transform .15s ease-out, box-shadow .2s ease-out, filter .2s ease-out;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .btn-switch::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:999px;
      z-index:-1;
      background:
        radial-gradient(circle at 18% 18%, rgba(255,255,255,0.10), rgba(255,255,255,0.03) 55%, rgba(42,24,6,0.12));
      pointer-events:none;
    }
    .btn-switch:hover{
      transform:translateY(-1px);
      filter: brightness(1.03);
      box-shadow:0 11px 22px rgba(26,14,4,0.16), 0 0 18px rgba(246,211,122,0.12);
    }

    .btn-export{
      border-color: rgba(255,235,180,0.70);
      box-shadow:0 10px 20px rgba(26,14,4,0.15), 0 0 18px rgba(246,211,122,0.14);
    }
    .btn-export::before{
      background:
        radial-gradient(circle at 18% 18%, rgba(255,255,255,0.14), rgba(255,255,255,0.04) 55%, rgba(42,24,6,0.14));
    }

    /* ===== Ê®ôÈ°å ===== */
    .site-title-wrapper{
      position:fixed;
      top: calc(var(--title-top) + var(--title-shift));
      left:50%;
      transform:translateX(-50%);
      text-align:center;
      letter-spacing:.34em;
      text-indent:.34em;
      z-index:59;
      pointer-events:none;
      width: min(94vw, 980px);
      isolation:isolate;
      mix-blend-mode: normal;
    }
    .site-title-wrapper::after{
      content:"";
      position:absolute;
      left:50%;
      top: calc(100% - .20rem);
      transform: translateX(-50%);
      width: min(46vw, 560px);
      height: clamp(34px, 5.4vh, 62px);
      background:
        radial-gradient(closest-side at 50% 0%,
          rgba(255,255,255,0.14),
          rgba(235,240,245,0.06) 42%,
          rgba(0,0,0,0.00) 74%),
        linear-gradient(to bottom,
          rgba(255,255,255,0.04),
          rgba(0,0,0,0.00));
      clip-path: polygon(50% 0%, 18% 100%, 82% 100%);
      filter: blur(.90px);
      opacity: .30;
      mix-blend-mode: screen;
      pointer-events:none;
    }

    .site-title{
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-size: var(--title-size);
      font-weight: 900;
      line-height: 1.02;
      letter-spacing: .32em;
      text-indent: .32em;
    }

    /* nav-area */
    .nav-area{
      position:absolute;
      inset: var(--frame-inset);
      z-index: 30;
      contain: layout paint;
    }
    @media (min-width: 901px){
      .nav-area.arc{ display:block; }
      .nav-area.arc .nav-btn{
        position:absolute;
        left: calc(50% + var(--x, 0px));
        top: var(--y, 50%);
        transform: translate(-50%, -50%) rotate(var(--rot, 0deg));
      }
    }

    /* ===== ÊåâÈçµ ===== */
    .nav-btn{
      position:relative;
      min-height: 66px;
      height: auto;
      border-radius: 999px;
      border: 1px solid var(--btn-border);
      background:
        radial-gradient(120% 140% at 18% 18%, rgba(255,255,255,var(--btn-glass-a)), rgba(255,255,255,0.00) 62%),
        radial-gradient(120% 140% at 72% 62%, rgba(246,211,122,var(--btn-glass-b)), rgba(0,0,0,0.00) 80%),
        linear-gradient(180deg, rgba(255,255,255, 0.010), rgba(42,24,6, 0.010));
      text-decoration:none;
      cursor:pointer;
      box-shadow:
        0 18px 34px rgba(26,14,4,0.13),
        0 10px 18px rgba(26,14,4,0.07),
        0 0 18px rgba(246,211,122,0.10),
        inset 0 0 0 1px rgba(255,255,255,0.012);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px clamp(.80rem, 1.10vw, 1.45rem);
      backdrop-filter: blur(var(--btn-blur)) saturate(1.12);
      -webkit-backdrop-filter: blur(var(--btn-blur)) saturate(1.12);
      transition: transform .18s ease-out, box-shadow .22s ease-out, border-color .2s ease-out, filter .2s ease-out;
      transform: translateZ(0);
      overflow:hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      contain: paint;
      isolation:isolate;
      mix-blend-mode: normal;
    }

    .nav-btn::after{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(62% 120% at 50% 34%, var(--btn-spotA), rgba(0,0,0,0) 62%),
        radial-gradient(58% 140% at 50% 62%, var(--btn-spotB), rgba(0,0,0,0) 74%);
      opacity: var(--btn-spot-op);
      pointer-events:none;
      mix-blend-mode: screen;
      filter: blur(.90px);
    }

    .nav-btn::before{
      content:"";
      position:absolute;
      left: 18%;
      top: -72%;
      width: 20%;
      height: 150%;
      background: radial-gradient(circle at 30% 42%, rgba(255,255,255,0.10), rgba(255,255,255,0.00) 78%);
      transform: rotate(10deg);
      opacity: .08;
      filter: blur(.95px);
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .nav-btn:hover{
      transform: translateY(-3px) translateZ(0);
      border-color: rgba(255,235,180,0.72);
      filter: brightness(1.05);
      box-shadow:
        0 20px 38px rgba(26,14,4,0.15),
        0 0 26px rgba(246,211,122,0.16);
    }

    .nav-btn span{
      position:relative;
      z-index:2;
      width:100%;
      text-align:center;
      line-height:1.18;
      font-size: clamp(1.02rem, 1.10vw, 1.20rem);
      font-weight: 900;
      letter-spacing: clamp(0.10em, 0.14vw, 0.14em);
      text-indent: 0.10em;
      white-space: normal;
      word-break: break-word;
      overflow-wrap: anywhere;

      isolation:isolate;
      mix-blend-mode: normal;
      paint-order: stroke fill;

      -webkit-text-stroke: 1.06px var(--txt-stroke);
      text-shadow:
        0 1px 0 var(--txt-shadow-2),
        0 2px 5px var(--txt-shadow-1),
        0 0 6px var(--txt-glow),
        0 -1px 4px var(--txt-hi);
      filter: saturate(1.30) contrast(1.36);
      color: var(--txt-gold-strong);
    }
    @supports (-webkit-background-clip:text){
      .nav-btn span{
        background: linear-gradient(180deg, var(--crystalA) 0%, var(--crystalB) 32%, var(--crystalC) 76%, var(--crystalD) 100%);
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
    }

    /* ===== Á¶™Â≠óÂçÄ ===== */
    .zen-words{
      position:absolute;
      left: var(--frame-inset);
      right: var(--frame-inset);
      top: var(--stage-top);
      bottom: var(--frame-inset);
      pointer-events:none;
      z-index: 58;
      isolation:isolate;
      mix-blend-mode: normal;
    }

    .zw-top-axis{
      position:absolute;
      left: 0;
      right: 0;
      top: var(--axis-top);
      height: 0;
      pointer-events:none;
    }
    .zw-axis-char{
      position:absolute;
      top: 0;
      font-size: clamp(32px, 2.7vw, 50px);
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-weight: 900;
      letter-spacing: .08em;
      opacity: .99;
    }
    .zw-axis-char.mid{ left: 50%; transform: translateX(-50%); }
    .zw-axis-char.left{ left: calc(50% - var(--axis-gap)); transform: translateX(-50%); }
    .zw-axis-char.right{ left: calc(50% + var(--axis-gap)); transform: translateX(-50%); }

    .zw-side-col{
      position:absolute;
      top: var(--zen-side-cy, 50%);
      transform: translate(-50%, -50%);
      writing-mode: vertical-rl;
      text-orientation: upright;
      white-space: nowrap;
      font-size: clamp(22px, 1.9vw, 34px);
      letter-spacing: .22em;
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-weight: 900;
      opacity: .985;
      padding: .12rem .22rem;
      filter: drop-shadow(0 8px 14px rgba(26,14,4,0.10));
    }
    .zw-side-col.left{  left: calc(50% - var(--zen-side-cx, 320px)); }
    .zw-side-col.right{ left: calc(50% + var(--zen-side-cx, 320px)); }

    .zw-bottom-line{
      position:absolute;
      left: 50%;
      bottom: clamp(22px, 4.4vh, 60px);
      transform: translateX(-50%);
      font-size: clamp(22px, 2.1vw, 36px);
      letter-spacing: .18em;
      white-space: nowrap;
      opacity: .99;
      font-family:"DFKai-SB","Ê®ôÊ•∑È´î","BiauKai","KaiTi","STKaiti","Kaiti TC","Noto Serif TC",serif;
      font-weight: 900;
    }

    .zw-axis-char,
    .zw-side-col,
    .zw-bottom-line{
      -webkit-text-stroke: 1.06px var(--txt-stroke);
      text-shadow:
        0 1px 0 var(--txt-shadow-2),
        0 2px 5px var(--txt-shadow-1),
        0 0 6px var(--txt-glow),
        0 -1px 4px var(--txt-hi);
      filter: saturate(1.30) contrast(1.36);
      color: var(--txt-gold-strong);
      mix-blend-mode: normal;
      paint-order: stroke fill;
    }
    @supports (-webkit-background-clip:text){
      .zw-axis-char,
      .zw-side-col,
      .zw-bottom-line{
        background: linear-gradient(180deg, var(--crystalA) 0%, var(--crystalB) 32%, var(--crystalC) 76%, var(--crystalD) 100%);
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
    }

    /* ===== ÊâãÊ©üÁâà ===== */
    @media (max-width: 900px){
      :root{
        --outer-side: 10px;
        --frame-inset: clamp(14px, 3.4vw, 20px);
        --sideglass-w: 0px;
        --title-shift: clamp(28px, 6.2vh, 72px);
        --title-size: clamp(2.08rem, 8.2vw, 3.08rem);
        --btn-blur: 3.8px;

        --zen-side-cx: 0px;

        --axis-top: clamp(132px, 17vh, 240px);
        --axis-gap: clamp(74px, 18vw, 136px);

        --login-inner-inset: 9px;
      }
      .side-glass{ display:none; }

      .user-bar{
        top: calc(var(--frame-inset) + 10px + env(safe-area-inset-top));
        left: calc(var(--frame-inset) + 10px + env(safe-area-inset-left));
        max-width: calc(100vw - 20px);
      }

      .nav-area{
        top: var(--nav-top-m);
        bottom: var(--nav-bottom-m);
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        width: min(560px, calc(100% - (2 * (var(--frame-inset) + 14px))));
        display:grid;
        grid-template-columns: repeat(2, minmax(0,1fr));
        gap: .66rem;
        align-content: start;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 8px;
        scrollbar-width: none;
      }
      .nav-area::-webkit-scrollbar{ width:0; height:0; }

      .nav-btn{
        position:relative !important;
        left:auto !important;
        top:auto !important;
        transform:none !important;
        width:100% !important;
        min-height: clamp(54px, 6.4vh, 74px) !important;
        height:auto !important;
        backdrop-filter: blur(var(--btn-blur-m)) saturate(1.10);
        -webkit-backdrop-filter: blur(var(--btn-blur-m)) saturate(1.10);
      }

      @media (max-width: 420px){
        .nav-area{ grid-template-columns: 1fr; }
      }

      .zw-axis-char{ font-size: clamp(24px, 6.8vw, 34px); }
      .zw-side-col{ display:none; }
      .zw-bottom-line{
        bottom: clamp(16px, 4.4vh, 52px);
        font-size: clamp(16px, 5.2vw, 24px);
        letter-spacing: .14em;
      }

      .login-box{
        width: min(640px, 96vw);
        border-radius: 22px;
        transform: translateY(-7px);
      }
      .login-box::before{
        border-radius: calc(22px - var(--login-inner-inset));
      }
    }

    body.compact .nav-area{ gap: .56rem; }
    body.compact .nav-btn{ min-height: clamp(50px, 5.8vh, 66px) !important; }
    body.compact .nav-btn span{ font-size: clamp(.98rem, 4.1vw, 1.06rem); }

    body.ultra .nav-area{ grid-template-columns: 1fr !important; gap: .52rem; }
    body.ultra .nav-btn{ min-height: clamp(48px, 5.2vh, 62px) !important; }
    body.ultra .nav-btn span{ font-size: clamp(.96rem, 4.2vw, 1.03rem); letter-spacing: .10em; }

    a.nav-btn,
    a.nav-btn:visited,
    a.nav-btn:hover,
    a.nav-btn:active{
      color: inherit !important;
    }
  </style>
</head>

<body class="locked booting">
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <div class="login-title crystal-ui">Tasun Ë≥áÊñô ¬∑ ÁôªÂÖ•</div>
      <div class="login-sub" id="loginSub"></div>

      <form id="loginForm">
        <div class="login-field">
          <label for="username">‰ΩøÁî®ËÄÖÂêçÁ®±</label>
          <select id="username" name="username" autocomplete="username"></select>
        </div>

        <div class="login-field">
          <label for="password">ÂØÜÁ¢º</label>
          <div class="login-pwd-wrapper">
            <input id="password" name="password" type="password" autocomplete="current-password" class="login-pwd-input" />
            <button type="button" class="btn-eye-login" id="btnTogglePwd">üëÅ</button>
          </div>
        </div>

        <div class="login-error" id="loginError"></div>

        <div class="login-actions">
          <button type="submit" class="btn-login crystal-ui">ÁôªÂÖ•</button>
          <button type="button" class="btn-secondary" id="btnForceRelogin">ÂàáÊèõ/ÈáçÊñ∞ÁôªÂÖ•</button>
        </div>
      </form>
    </div>
  </div>

  <main class="hero">
    <div class="hero-inner" id="heroInner">
      <div class="ripple-film" aria-hidden="true"></div>
      <div class="mist-film" aria-hidden="true"></div>

      <div class="side-glass side-glass-left" aria-hidden="true"></div>
      <div class="side-glass side-glass-right" aria-hidden="true"></div>

      <div class="lotus-stage" id="lotusStage" aria-hidden="true">
        <div class="spotlight" aria-hidden="true"></div>
        <div class="zen-visual" aria-hidden="true">
          <img id="zenImg"
               src="‰ΩõÊïôÁ¶™ÊÑè‰∏ªË¶ñË¶∫.png"
               alt=""
               loading="eager"
               decoding="async"
               fetchpriority="high">
        </div>
      </div>

      <div class="zen-words" aria-hidden="true">
        <div class="zw-top-axis" id="zwTopAxis">
          <span class="zw-axis-char left">Á©∫</span>
          <span class="zw-axis-char mid">ÁÑ°</span>
          <span class="zw-axis-char right">Êòé</span>
        </div>

        <div class="zw-side-col left">Á©∫ÂØßÁÑ°Êàë</div>
        <div class="zw-side-col right">Ê∏ÖÊòéÂØßÈùú</div>

        <div class="zw-bottom-line" id="zwBottomLine">Á©∫ÁÑ°„ÄÄÊòéÈùú</div>
      </div>

      <div class="user-bar" id="userBar">
        <div class="user-pill" id="userInfo" data-text="ÁõÆÂâç‰ΩøÁî®ËÄÖÔºöÊú™ÁôªÂÖ•">ÁõÆÂâç‰ΩøÁî®ËÄÖÔºöÊú™ÁôªÂÖ•</div>
        <button class="btn-switch" id="btnSwitchUser" type="button">ÂàáÊèõÂ∏≥Ëôü</button>
        <button class="btn-switch btn-export" id="btnExport" type="button">ÂåØÂá∫ÂÇô‰ªΩ</button>
      </div>

      <div class="site-title-wrapper" id="titleWrap">
        <div class="site-title crystal-ui">Tasun Ë≥áÊñô</div>
      </div>

      <div class="nav-area" id="navArea"></div>
    </div>
  </main>

  <script>
    const AUTH_KEY    = "tasunAuthTable_v1";
    const CURRENT_KEY = "tasunCurrentUser_v1";
    const SESSION_KEY = "tasunSessionLogin_v1";

    const NAV_KEY     = "tasunNavButtons_v1";
    const ROUTE_KEY   = "tasunNavRoutes_v1";

    const BACKUP_RING_KEY = "tasunBackupRing_v1";
    const BACKUP_RING_MAX = 10;

    const withV = window.__withV || ((u)=>u);

    const METRO_ID    = "btn2";
    const METRO_HREF  = "Ê±êÊù±Â∑•Á®ãÁÆ°ÁêÜË°®.html";

    const FIXED_ROUTES = {
      "Êç∑ÈÅãÊ±êÊù±Á∑ö‰∫ãÈ†ÖÁ¥ÄÈåÑ": "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html",
      "Êç∑ÈÅãÊ±êÊù±Á∑ö‰∫ãÈ†ÖË®òÈåÑ": "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html",
      "Êç∑ÈÅãÊ±êÊù±Á∑ö‰∫ãÈ†ÖÁ¥ÄÈåÑ.html": "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html",
      "Êç∑ÈÅãÊ±êÊù±Á∑ö‰∫ãÈ†ÖË®òÈåÑ.html": "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html",
      "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã": "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html",
      "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html": "Êç∑ÈÅãÊ±êÊù±Á∑öË®ò‰∫ã.html",
    };

    const LEGACY_BUTTON_KEYS = ["btn1","btn2","btn3","btn4","btn5"];
    const $ = (sel) => document.querySelector(sel);

    function hrefToDom(href){
      const h = String(href || "").trim();
      if(!h) return "#";
      if(/^https?:\/\//i.test(h)) return h;
      if(/^mailto:/i.test(h)) return h;
      return withV(encodeURI(h));
    }

    function labelToFile(label){
      let s = String(label || "").trim();
      if(!s) return "#";
      if(s.endsWith(".html")) return s;
      s = s.replace(/[\\\/:*?"<>|]/g, "").trim();
      s = s.replace(/\s+/g, "");
      return s + ".html";
    }

    function safeJsonParse(s, fallback){
      try{ return JSON.parse(s); }catch(e){ return fallback; }
    }

    function shouldIncludeKey(k){
      const key = String(k || "");
      return (
        key.startsWith("tasun") ||
        key.includes("Ê±êÊù±") ||
        key.includes("Êç∑ÈÅã") ||
        key.includes("Ê∞¥Áí∞") ||
        key.includes("ÂØ©Êü•") ||
        key.includes("Êñá‰ª∂") ||
        key.includes("Ë≥áÊñôÂ∫´")
      );
    }

    function collectBackupPayload(reason){
      const now = new Date();
      const keys = [];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(shouldIncludeKey(k)) keys.push(k);
      }
      keys.sort((a,b)=>a.localeCompare(b, "zh-Hant"));

      const data = {};
      keys.forEach(k => {
        const raw = localStorage.getItem(k);
        const parsed = safeJsonParse(raw, null);
        data[k] = (parsed === null && raw !== "null" && raw !== null) ? raw : parsed;
      });

      const sess = safeJsonParse(sessionStorage.getItem(SESSION_KEY) || "null", null);

      return {
        meta: {
          app: "Tasun index.html",
          reason: String(reason || "manual"),
          ts: now.toISOString(),
          href: location.href,
          cacheV: (window.__CACHE_V || "")
        },
        session: sess,
        data
      };
    }

    function storeBackupRing(payload){
      try{
        const arr = safeJsonParse(localStorage.getItem(BACKUP_RING_KEY) || "[]", []);
        const next = Array.isArray(arr) ? arr : [];
        next.unshift(payload);
        next.length = Math.min(next.length, BACKUP_RING_MAX);
        localStorage.setItem(BACKUP_RING_KEY, JSON.stringify(next));
      }catch(e){}
    }

    function downloadJson(payload){
      const ts = new Date().toISOString().replace(/[:.]/g, "-");
      const filename = `TasunÂÇô‰ªΩ_${ts}.json`;
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.style.display = "none";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(url);
        a.remove();
      }, 0);
    }

    /* =========================================================
       ‚úÖ‚úÖ‚úÖ ‰øÆÊ≠£ÈáçÈªûÔºöËá™ÂãïÂÇô‰ªΩ‰∏çÂÜç‰∏ãËºâÔºàÈÅøÂÖç‰∏ÄÁõ¥Ë∑≥„ÄåÂè¶Â≠òÊñ∞Ê™î„ÄçÔºâ
       - Ëá™ÂãïÔºöÂè™ÂØ´ÂÖ• BACKUP_RINGÔºàlocalStorageÔºâ
       - ÊâãÂãïÔºàÊåâ„ÄåÂåØÂá∫ÂÇô‰ªΩ„ÄçÔºâÔºöÊâç‰∏ãËºâ JSON
       ========================================================= */
    let _exportTimer = 0;
    let _pendingReason = "";
    let _exportOnceExit = false;

    function exportBackupNow(reason, opts){
      const o = opts || {};
      const payload = collectBackupPayload(reason);
      storeBackupRing(payload);
      if(o.download){
        try{ downloadJson(payload); }catch(e){}
      }
    }

    function scheduleExport(reason){
      const r = String(reason || "auto");
      _pendingReason = _pendingReason ? (_pendingReason + " | " + r) : r;
      clearTimeout(_exportTimer);
      _exportTimer = setTimeout(() => {
        const rr = _pendingReason || "auto";
        _pendingReason = "";
        // ‚úÖ Ëá™ÂãïÂÇô‰ªΩÔºö‰∏ç‰∏ãËºâÔºåÂè™Â≠òÁí∞ÁãÄÂÇô‰ªΩ
        exportBackupNow(rr, { download:false });
      }, 350);
    }

    function tryExportOnExit(){
      if(_exportOnceExit) return;
      _exportOnceExit = true;
      // ‚úÖ Èõ¢Èñã/ÂàáÊèõÔºöÂè™Â≠òÔºå‰∏ç‰∏ãËºâÔºàÈÅøÂÖçË∑≥Á™óÔºâ
      exportBackupNow("exit/pagehide", { download:false });
    }

    (function patchLocalStorage(){
      try{
        const _set = localStorage.setItem.bind(localStorage);
        const _remove = localStorage.removeItem.bind(localStorage);

        localStorage.setItem = function(k, v){
          _set(k, v);
          if(shouldIncludeKey(k)) scheduleExport("save:setItem:" + k);
        };
        localStorage.removeItem = function(k){
          _remove(k);
          if(shouldIncludeKey(k)) scheduleExport("save:removeItem:" + k);
        };
      }catch(e){}
    })();

    window.addEventListener("storage", (e) => {
      if(!e || !e.key) return;
      if(shouldIncludeKey(e.key)) scheduleExport("storage:" + e.key);
    });

    window.addEventListener("pagehide", tryExportOnExit, { passive:true });
    document.addEventListener("visibilitychange", () => {
      if(document.visibilityState === "hidden") tryExportOnExit();
    }, { passive:true });

    function applyFixedRoutes(obj){
      const out = (obj && typeof obj === "object") ? { ...obj } : {};
      Object.keys(FIXED_ROUTES).forEach(k => { out[k] = FIXED_ROUTES[k]; });
      out[METRO_ID] = METRO_HREF;
      out["systemBtn"] = out["systemBtn"] || "Ê¨äÈôêË°®.html";
      return out;
    }

    function loadRoutes(){
      const seed = applyFixedRoutes({
        "btn3": "https://www.dropbox.com/",
        "systemBtn": "Ê¨äÈôêË°®.html",
        [METRO_ID]: METRO_HREF
      });

      const raw = localStorage.getItem(ROUTE_KEY);
      if(!raw){
        localStorage.setItem(ROUTE_KEY, JSON.stringify(seed, null, 2));
        return seed;
      }

      const parsed = safeJsonParse(raw, null);
      const base = (parsed && typeof parsed === "object") ? parsed : {};
      const merged = applyFixedRoutes({ ...base, ...seed });

      if(JSON.stringify(base) !== JSON.stringify(merged)){
        localStorage.setItem(ROUTE_KEY, JSON.stringify(merged, null, 2));
      }
      return merged;
    }

    function loadNavButtonsSeedIfMissing(){
      const seed = [
        { id:"btn1", label:"ËáªÈºéÊôÇ‰ª£Â§ßÂªàÁÆ°ÁêÜË°®" },
        { id:"btn2", label:"Êç∑ÈÅãÊ±êÊ≠¢Êù±ÊπñÁ∑ö" },
        { id:"btn3", label:"Èõ≤Á´ØÊ™îÊ°à" },
        { id:"btn4", label:"Â∑•Á®ãË≥áÊñôÂ∫´" },
        { id:"btn5", label:"Ë≥áÊñôÂ∫´" }
      ];
      const raw = localStorage.getItem(NAV_KEY);
      if(!raw){
        localStorage.setItem(NAV_KEY, JSON.stringify(seed));
        return seed;
      }
      const arr = safeJsonParse(raw, null);
      if(Array.isArray(arr) && arr.length) return arr;
      localStorage.setItem(NAV_KEY, JSON.stringify(seed));
      return seed;
    }

    function resolveHref(cfg, routes){
      const id = String(cfg?.id || "").trim();
      const label = String(cfg?.label || "").trim();

      if(label && FIXED_ROUTES[label]) return FIXED_ROUTES[label];

      if(id === METRO_ID) return METRO_HREF;
      if(routes && routes[id]) return routes[id];
      if(routes && label && routes[label]) return routes[label];

      const guess = labelToFile(label);
      if(FIXED_ROUTES[guess]) return FIXED_ROUTES[guess];
      return guess;
    }

    function getDefaultAuthTableLegacy(btnCount){
      const keys = Array.from({length: btnCount}, (_, i) => `btn${i+1}`);
      const mkAll = () => Object.fromEntries(keys.map(k => [k, true]));
      const mkOnlyLast = () => Object.fromEntries(keys.map((k, i) => [k, i === btnCount - 1]));
      return [
        { user:"alex",  pass:"Tasun08040224", role:"admin", ...mkAll() },
        { user:"JOYCE", pass:"09220224",      role:"admin", ...mkAll() },
        { user:"tasun", pass:"tasun08040224", role:"write", ...mkAll() },
        { user:"wu",    pass:"123456",        role:"read",  ...mkOnlyLast() }
      ];
    }

    function normalizeRowFromStorage(row, btnCount){
      const username = (row?.username ?? row?.user ?? row?.name ?? row?.account ?? "").toString().trim();
      const password = (row?.password ?? row?.pass ?? "").toString();
      const level    = (row?.level ?? row?.role ?? "read").toString().trim().toLowerCase();

      const buttons = [];
      for(let i=0;i<btnCount;i++){
        const k = `btn${i+1}`;
        buttons[i] = !!row?.[k];
      }
      return { username, password, level, buttons };
    }

    function loadAuthTable(btnCount){
      const raw = localStorage.getItem(AUTH_KEY);
      if(!raw){
        const legacy = getDefaultAuthTableLegacy(btnCount);
        localStorage.setItem(AUTH_KEY, JSON.stringify(legacy));
        return legacy.map(r => normalizeRowFromStorage(r, btnCount));
      }
      const parsed = safeJsonParse(raw, null);
      const arr = Array.isArray(parsed) ? parsed : (parsed && Array.isArray(parsed.users) ? parsed.users : null);
      if(Array.isArray(arr)){
        const mapped = arr.map(r => normalizeRowFromStorage(r, btnCount)).filter(x => x.username);
        if(mapped.length) return mapped;
      }
      const legacy = getDefaultAuthTableLegacy(btnCount);
      localStorage.setItem(AUTH_KEY, JSON.stringify(legacy));
      return legacy.map(r => normalizeRowFromStorage(r, btnCount));
    }

    function setSession(user){
      try{ sessionStorage.setItem(SESSION_KEY, JSON.stringify({ user: user.username, role: user.level, t: Date.now() })); }catch(e){}
    }
    function clearSession(){ try{ sessionStorage.removeItem(SESSION_KEY); }catch(e){} }
    function getSession(){
      const obj = safeJsonParse(sessionStorage.getItem(SESSION_KEY) || "null", null);
      if(!obj || typeof obj !== "object") return null;
      const u = String(obj.user || "").trim();
      const r = String(obj.role || "").trim().toLowerCase();
      if(!u) return null;
      return { user: u, role: r, t: Number(obj.t || 0) };
    }

    const loginOverlay = $("#loginOverlay");
    const loginForm    = $("#loginForm");
    const loginError   = $("#loginError");
    const loginSub     = $("#loginSub");
    const userInfo     = $("#userInfo");
    const btnSwitch    = $("#btnSwitchUser");
    const btnExport    = $("#btnExport");
    const btnTogglePwd = $("#btnTogglePwd");
    const btnForceRelogin = $("#btnForceRelogin");
    const navArea      = $("#navArea");
    const heroInner    = $("#heroInner");
    const titleWrap    = $("#titleWrap");
    const userBar      = $("#userBar");
    const zwBottomLine = $("#zwBottomLine");
    const lotusStage   = $("#lotusStage");

    let AUTH_TABLE = [];
    let ROUTES = loadRoutes();
    let NAV_ARR = loadNavButtonsSeedIfMissing();

    const ROLE_MAP = {
      "btn1": ["admin","write","read"],
      "btn2": ["admin","write","read"],
      "btn3": ["admin","write","read"],
      "btn4": ["admin","write"],
      "btn5": ["admin","write","read"],
      "systemBtn": ["admin"]
    };

    const SYSTEM_BTN = { id:"systemBtn", label:"Á≥ªÁµ± / Ê¨äÈôê", roles:["admin"] };

    let BTN_CONFIGS = [];
    let mainNavBtns = [];

    function isRoleAllowed(cfg, level){
      if(!cfg || !Array.isArray(cfg.roles)) return true;
      return cfg.roles.includes(level);
    }
    function isAllowedByAuth(user, cfg){
      if(cfg && cfg.id === "systemBtn") return true;
      const flags = Array.isArray(user.buttons) ? user.buttons : [];
      const m = String(cfg?.id || "").match(/^btn(\d+)$/i);
      if(!m) return true;
      const idx = parseInt(m[1], 10) - 1;
      return (flags[idx] === undefined) ? true : !!flags[idx];
    }

    function populateUserSelect(){
      const sel = document.getElementById("username");
      AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
      sel.innerHTML = "";

      if(!AUTH_TABLE.length){
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "ÔºàÂ∞öÁÑ°‰ΩøÁî®ËÄÖÔºåË´ãÂÖàÂà∞„ÄåÁ≥ªÁµ± / Ê¨äÈôê„ÄçÊñ∞Â¢ûÔºâ";
        opt.disabled = true;
        opt.selected = true;
        sel.appendChild(opt);
        return;
      }

      const ph = document.createElement("option");
      ph.value = "";
      ph.textContent = "Ë´ãÈÅ∏Êìá‰ΩøÁî®ËÄÖ";
      ph.disabled = true;
      ph.selected = true;
      sel.appendChild(ph);

      const names = Array.from(new Set(AUTH_TABLE.map(r => r.username).filter(Boolean)));
      names.sort((a,b)=>a.localeCompare(b, "zh-Hant"));
      names.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        sel.appendChild(opt);
      });
    }

    function scheduleAll(){
      scheduleLayout();
      scheduleMobileKeepout();
      scheduleAxisTop();
    }

    function touchLayout(){
      scheduleMobileKeepout();
      scheduleAxisTop();
      scheduleLayout();
    }

    function buildMainButtons(){
      ROUTES = loadRoutes();
      NAV_ARR = loadNavButtonsSeedIfMissing();

      BTN_CONFIGS = NAV_ARR.map(x => {
        const id = String(x?.id || "").trim();
        const label = String(x?.label || "").trim();
        const roles = ROLE_MAP[id] || ["admin","write","read"];
        const target = (id === "btn3") ? "_blank" : "";
        return { id, label, roles, target };
      }).concat([SYSTEM_BTN]);

      mainNavBtns = [];
      navArea.innerHTML = "";

      BTN_CONFIGS.forEach((cfg) => {
        const a = document.createElement("a");
        a.className = "nav-btn";
        a.id = cfg.id || "";

        const span = document.createElement("span");
        span.textContent = cfg.label;
        a.appendChild(span);

        const finalHref = resolveHref(cfg, ROUTES);
        a.setAttribute("href", hrefToDom(finalHref));

        const t = cfg.target || "";
        if(t){
          a.target = t;
          if(t === "_blank") a.rel = "noopener noreferrer";
        }

        a.style.display = "none";
        navArea.appendChild(a);
        mainNavBtns.push(a);
      });

      scheduleAll();
    }

    function resetButtonsForLogout(){
      mainNavBtns.forEach(btn => btn.style.display = "none");
      navArea.classList.remove("arc");
      scheduleAll();
    }

    function findUser(username, password){
      const u = (username || "").trim();
      return AUTH_TABLE.find(row => row.username === u && row.password === password);
    }

    function showLogin(){
      document.body.classList.add("locked");
      loginOverlay.style.display = "flex";
      loginError.textContent = "";
      loginSub.textContent = "";
      document.getElementById("password").value = "";

      populateUserSelect();
      resetButtonsForLogout();

      userInfo.textContent = "ÁõÆÂâç‰ΩøÁî®ËÄÖÔºöÊú™ÁôªÂÖ•";
      userInfo.setAttribute("data-text", "ÁõÆÂâç‰ΩøÁî®ËÄÖÔºöÊú™ÁôªÂÖ•");

      autoEnterIfSessionValid();
      touchLayout();
    }

    function autoEnterIfSessionValid(){
      const sess = getSession();
      if(!sess) return;

      const u = AUTH_TABLE.find(r => r.username === sess.user);
      if(!u){ clearSession(); return; }
      if(String(u.level||"").toLowerCase() !== String(sess.role||"").toLowerCase()){
        clearSession(); return;
      }

      loginSub.textContent = `Â∑≤ÁôªÂÖ•Ôºö${u.username}Ôºà${u.level}Ôºâ‚Ä¶ Ê≠£Âú®ÈÄ≤ÂÖ•`;
      setTimeout(() => {
        if(!getSession()) return;
        applyUser(u);
      }, 150);
    }

    function applyUser(user){
      document.body.classList.remove("locked");
      loginOverlay.style.display = "none";
      loginSub.textContent = "";

      setSession(user);
      localStorage.setItem(CURRENT_KEY, JSON.stringify({ user: user.username, role: user.level }));

      const t = `ÁõÆÂâç‰ΩøÁî®ËÄÖÔºö${user.username} (${user.level})`;
      userInfo.textContent = t;
      userInfo.setAttribute("data-text", t);

      buildMainButtons();

      mainNavBtns.forEach((btn, index) => {
        const cfg = BTN_CONFIGS[index];
        const okRole = isRoleAllowed(cfg, user.level);
        const okAuth = isAllowedByAuth(user, cfg);

        btn.style.display = (okRole && okAuth) ? "flex" : "none";

        const finalHref = resolveHref(cfg, ROUTES);
        btn.setAttribute("href", hrefToDom(finalHref));
      });

      // ‚úÖ Ëá™ÂãïÂÇô‰ªΩÔºöÂè™Â≠òÁí∞ÁãÄÂÇô‰ªΩÔºå‰∏ç‰∏ãËºâ
      scheduleExport("login:applyUser");
      touchLayout();
    }

    (function(){
      const img = document.getElementById("zenImg");
      if(img) img.src = withV(img.getAttribute("src") || img.src);
    })();

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
    function lerp(a,b,t){ return a + (b-a)*t; }

    function fitButtonHeights(btns, baseH){
      btns.forEach(btn => {
        const span = btn.querySelector("span");
        if(!span) return;
        btn.style.height = "auto";
        const need = Math.ceil(span.scrollHeight + 26);
        const h = Math.max(baseH, need);
        btn.style.height = h + "px";
      });
    }

    function layoutArcButtons(){
      const isDesktop = window.matchMedia("(min-width: 901px)").matches;
      if(!isDesktop){
        navArea.classList.remove("arc");
        return;
      }

      const visible = mainNavBtns.filter(b => b.style.display !== "none");
      if(!visible.length){
        navArea.classList.remove("arc");
        return;
      }

      navArea.classList.add("arc");

      const rect = navArea.getBoundingClientRect();
      const H = Math.max(1, rect.height);
      const W = Math.max(1, rect.width);

      const centerY = H * 0.56;

      const topMargin = clamp(H * 0.14, 64, 132);
      const botMargin = clamp(H * 0.12, 56, 124);

      const baseH = clamp(H * 0.12, 62, 92);

      visible.forEach(btn => {
        const span = btn.querySelector("span");
        const textW = span ? span.getBoundingClientRect().width : 240;

        const minW = clamp(W * 0.26, 280, 390);
        const maxW = clamp(W * 0.46, 400, 620);
        const targetW = clamp(textW + 180, minW, maxW);

        btn.style.width = targetW + "px";
      });

      fitButtonHeights(visible, baseH);

      const keepoutCX = clamp(W * 0.20, 200, 360);
      const keepoutW  = clamp(W * 0.12, 110, 190);
      const keepoutY1 = clamp(H * 0.30, 140, 260);
      const keepoutY2 = clamp(H * 0.78, 440, 840);

      const ls = lotusStage ? lotusStage.getBoundingClientRect() : null;
      let zenSideCX = clamp(W * 0.26, 220, 380);
      let sideTextY1 = H * 0.20;
      let sideTextY2 = H * 0.86;

      if(ls){
        zenSideCX = clamp(ls.width * 0.33, 210, 390);
        sideTextY1 = clamp((ls.top - rect.top) + ls.height * 0.18, 90, H * 0.50);
        sideTextY2 = clamp((ls.top - rect.top) + ls.height * 0.86, H * 0.46, H - 60);
      }
      document.documentElement.style.setProperty("--zen-side-cx", Math.round(zenSideCX) + "px");

      const sideTextHalfW = 46;

      const left = [];
      const right = [];
      visible.forEach((btn, i) => (i % 2 === 0 ? left : right).push(btn));

      const yMin = topMargin;
      const yMax = H - botMargin;

      const angleMin = -54 * Math.PI / 180;
      const angleMax =  54 * Math.PI / 180;

      const Ry = (yMax - yMin) * 0.50;

      const baseX = clamp(W * 0.41, 310, (W/2) - 210);
      const bulge = clamp(W * 0.12, 84, 150);

      function neededAbsXToAvoidKeepout(bw, bh, y){
        const yTop = y - bh/2;
        const yBot = y + bh/2;
        const overlapY = !(yBot < keepoutY1 || yTop > keepoutY2);
        if(!overlapY) return 0;
        const margin = 28;
        return keepoutCX + keepoutW/2 + bw/2 + margin;
      }

      function neededAbsXToAvoidSideText(bw, bh, y){
        const yTop = y - bh/2;
        const yBot = y + bh/2;
        const overlapY = !(yBot < sideTextY1 || yTop > sideTextY2);
        if(!overlapY) return 0;
        const margin = 44;
        return zenSideCX + sideTextHalfW + (bw/2) + margin;
      }

      function place(btn, sideSign, i, count){
        const t = (count <= 1) ? 0.5 : (i / (count - 1));
        const ang = lerp(angleMin, angleMax, t);

        const bw = btn.getBoundingClientRect().width || 380;
        const bh = btn.getBoundingClientRect().height || baseH;

        let y = centerY + Math.sin(ang) * Ry;
        y = clamp(y, yMin, yMax);

        let xAbs = baseX + Math.cos(ang) * bulge;

        const maxAbsX = (W/2) - (bw/2) - 64;
        xAbs = clamp(xAbs, 240, maxAbsX);

        const needK = neededAbsXToAvoidKeepout(bw, bh, y);
        if(needK > 0) xAbs = Math.max(xAbs, needK);

        const needT = neededAbsXToAvoidSideText(bw, bh, y);
        if(needT > 0) xAbs = Math.max(xAbs, needT);

        xAbs = clamp(xAbs, 240, maxAbsX);

        const rot = sideSign * (Math.sin(ang) * 6.0);

        btn.style.setProperty("--x", `${sideSign * xAbs}px`);
        btn.style.setProperty("--y", `${y}px`);
        btn.style.setProperty("--rot", `${rot}deg`);
      }

      left.forEach((btn, i) => place(btn, -1, i, left.length));
      right.forEach((btn, i) => place(btn,  1, i, right.length));
    }

    let _raf = 0;
    function scheduleLayout(){
      cancelAnimationFrame(_raf);
      _raf = requestAnimationFrame(layoutArcButtons);
    }

    let _mkRaf = 0;
    function scheduleMobileKeepout(){
      cancelAnimationFrame(_mkRaf);
      _mkRaf = requestAnimationFrame(applyMobileKeepout);
    }

    function isMobile(){
      return window.matchMedia("(max-width: 900px)").matches;
    }

    function applyMobileKeepout(){
      if(!isMobile()) {
        document.body.classList.remove("compact","ultra");
        return;
      }
      if(!heroInner || !navArea) return;

      const h = (window.visualViewport && window.visualViewport.height) ? window.visualViewport.height : window.innerHeight;
      document.body.classList.toggle("compact", h <= 660);
      document.body.classList.toggle("ultra",  h <= 560);

      const hi = heroInner.getBoundingClientRect();
      const ub = userBar ? userBar.getBoundingClientRect() : null;
      const tw = titleWrap ? titleWrap.getBoundingClientRect() : null;
      const bl = zwBottomLine ? zwBottomLine.getBoundingClientRect() : null;

      const safeTop = hi.top;
      const safeBottom = hi.bottom;

      let topNeed = 0;
      if(ub) topNeed = Math.max(topNeed, (ub.bottom - safeTop) + 10);
      if(tw) topNeed = Math.max(topNeed, (tw.bottom - safeTop) + 10);

      const frameInset = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--frame-inset")) || 16;
      topNeed = Math.max(topNeed, frameInset + 64);

      let bottomNeed = frameInset + 18;
      if(bl){
        const gap = 10;
        bottomNeed = Math.max(bottomNeed, (safeBottom - bl.top) + gap);
      }

      const minRoom = 220;
      if((hi.height - topNeed - bottomNeed) < minRoom){
        document.body.classList.add("ultra");
      }

      document.documentElement.style.setProperty("--nav-top-m",  `${Math.round(topNeed)}px`);
      document.documentElement.style.setProperty("--nav-bottom-m", `${Math.round(bottomNeed)}px`);

      if(bl){
        const navR = navArea.getBoundingClientRect();
        if(navR.bottom > (bl.top - 8)){
          const extra = Math.round(navR.bottom - (bl.top - 8));
          document.documentElement.style.setProperty("--nav-bottom-m", `${Math.round(bottomNeed + extra)}px`);
        }
      }
    }

    let _axisRaf = 0;
    function scheduleAxisTop(){
      cancelAnimationFrame(_axisRaf);
      _axisRaf = requestAnimationFrame(syncZenWordsToArrow);
    }

    function syncZenWordsToArrow(){
      if(!heroInner) return;

      const hi = heroInner.getBoundingClientRect();
      const tw = titleWrap ? titleWrap.getBoundingClientRect() : null;
      const ls = lotusStage ? lotusStage.getBoundingClientRect() : null;

      let topFromTitle = tw ? ((tw.bottom - hi.top) + 16) : 140;
      let topNearLotus = ls ? ((ls.top - hi.top) + (ls.height * 0.18)) : (hi.height * 0.28);

      let top = Math.max(topFromTitle, Math.min(topNearLotus, topFromTitle + 90));

      const minTop = 110;
      const maxTop = ls ? ((ls.top - hi.top) + (ls.height * 0.30)) : (hi.height * 0.38);
      top = clamp(top, minTop, maxTop);

      document.documentElement.style.setProperty("--axis-top", `${Math.round(top)}px`);

      if(ls){
        let cy = (ls.top - hi.top) + (ls.height * 0.58);
        cy = clamp(cy, hi.height * 0.30, hi.height * 0.80);
        document.documentElement.style.setProperty("--zen-side-cy", `${Math.round(cy)}px`);

        let cx = clamp(ls.width * 0.33, 210, 390);
        document.documentElement.style.setProperty("--zen-side-cx", `${Math.round(cx)}px`);

        let gap = clamp(ls.width * 0.16, 96, 240);
        document.documentElement.style.setProperty("--axis-gap", `${Math.round(gap)}px`);
      }
    }

    let _vhRaf = 0;
    function setAppHeight(){
      cancelAnimationFrame(_vhRaf);
      _vhRaf = requestAnimationFrame(() => {
        const h = (window.visualViewport && window.visualViewport.height) ? window.visualViewport.height : window.innerHeight;
        document.documentElement.style.setProperty("--appH", h + "px");
        scheduleAll();
      });
    }

    window.addEventListener("resize", setAppHeight, { passive:true });
    if(window.visualViewport){
      window.visualViewport.addEventListener("resize", setAppHeight, { passive:true });
      window.visualViewport.addEventListener("scroll", setAppHeight, { passive:true });
    }

    function syncFromLocal(){
      try{
        ROUTES = loadRoutes();
        NAV_ARR = loadNavButtonsSeedIfMissing();
        AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
      }catch(e){}

      const sess = getSession();
      buildMainButtons();

      if(sess){
        const u = AUTH_TABLE.find(r =>
          r.username === sess.user &&
          String(r.level||"").toLowerCase() === String(sess.role||"").toLowerCase()
        );
        if(u) applyUser(u);
      }else{
        scheduleAll();
      }
    }

    window.addEventListener("focus", syncFromLocal, { passive:true });
    document.addEventListener("visibilitychange", () => {
      if(document.visibilityState === "visible") syncFromLocal();
    });

    AUTH_TABLE = loadAuthTable(LEGACY_BUTTON_KEYS.length);
    buildMainButtons();
    setAppHeight();
    showLogin();

    requestAnimationFrame(() => {
      document.body.classList.remove("booting");
      setTimeout(scheduleMobileKeepout, 0);
      setTimeout(scheduleMobileKeepout, 140);
      setTimeout(scheduleMobileKeepout, 280);

      if(document.fonts && document.fonts.ready){
        document.fonts.ready.then(() => {
          scheduleAxisTop();
          scheduleLayout();
        });
      }else{
        setTimeout(scheduleAxisTop, 180);
      }
    });

    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      if(!username){
        loginError.textContent = "Ë´ãÂÖàÈÅ∏Êìá‰ΩøÁî®ËÄÖÂêçÁ®±„ÄÇ";
        return;
      }
      const user = findUser(username, password);
      if(!user){
        loginError.textContent = "Â∏≥ËôüÊàñÂØÜÁ¢ºÈåØË™§ÔºåË´ãÂÜçË©¶‰∏ÄÊ¨°„ÄÇ";
        return;
      }
      loginError.textContent = "";
      applyUser(user);
      document.getElementById("password").value = "";
    });

    btnForceRelogin.addEventListener("click", () => {
      clearSession();
      loginSub.textContent = "Ë´ãÈáçÊñ∞Ëº∏ÂÖ•ÂØÜÁ¢ºÁôªÂÖ•";
      loginError.textContent = "";
      const pwd = document.getElementById("password");
      pwd.value = "";
      pwd.focus();
      touchLayout();
    });

    btnSwitch.addEventListener("click", () => {
      clearSession();
      localStorage.removeItem(CURRENT_KEY);
      showLogin();
      scheduleExport("switchUser");
    });

    btnTogglePwd.addEventListener("click", () => {
      const pwd = document.getElementById("password");
      pwd.type = (pwd.type === "password") ? "text" : "password";
    });

    // ‚úÖ ÊâãÂãïÂåØÂá∫ÔºöÊâç‰∏ãËºâ JSONÔºà‰∏çÊúÉÂÜçËá™ÂãïË∑≥Ë¶ñÁ™óÔºâ
    btnExport.addEventListener("click", () => {
      exportBackupNow("manual:button", { download:true });
    });
  </script>
</body>
</html>
