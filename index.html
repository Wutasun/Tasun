<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Tasun è³‡æ–™é¦–é  Â· ç©ºç„¡æ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --gold:#f6d37a;
      --gold2:#e6c061;
      --gold-soft: rgba(246,211,122,.75);
      --panel: rgba(0,0,0,.38);
      --panel2: rgba(0,0,0,.22);
      --stroke: rgba(246,211,122,.28);
      --shadow: rgba(0,0,0,.55);

      --safe: clamp(14px, 2.2vw, 22px);
      --btn-h: 64px;
      --btn-r: 999px;
      --btn-w: clamp(240px, 24vw, 420px);

      /* å¼§å½¢æ–‡å­—çš„å¤§å°/å¼§åº¦å¯åœ¨é€™å¾®èª¿ */
      --arc-font: clamp(28px, 3.2vw, 46px);
      --arc-w: min(520px, 96%);
      --arc-h: clamp(130px, 18vh, 190px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Noto Serif TC", system-ui, -apple-system, "Microsoft JhengHei", sans-serif;
      color: var(--gold);
      overflow-x:hidden;
      background:
        radial-gradient(circle at 20% 10%, rgba(246,211,122,.16) 0, transparent 42%),
        radial-gradient(circle at 80% 88%, rgba(246,211,122,.14) 0, transparent 46%),
        radial-gradient(circle at 50% 60%, rgba(246,211,122,.06) 0, transparent 55%),
        linear-gradient(180deg, #070604 0%, #050302 55%, #040202 100%);
    }

    .frame{
      position:relative;
      min-height:100vh;
      padding: var(--safe);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .shell{
      width:min(1280px, 96vw);
      min-height: min(720px, 88vh);
      border-radius: 26px;
      background:
        radial-gradient(circle at 50% 15%, rgba(246,211,122,.14) 0, rgba(0,0,0,.10) 55%, rgba(0,0,0,.22) 100%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
      box-shadow: 0 18px 60px rgba(0,0,0,.55), inset 0 0 0 1px rgba(246,211,122,.10);
      position:relative;
      overflow:hidden;
    }

    .shell::before{
      content:"";
      position:absolute; inset:-2px;
      pointer-events:none;
      background:
        radial-gradient(70% 34% at 50% 0%,
          rgba(246,211,122,.42) 0%,
          rgba(246,211,122,.18) 28%,
          rgba(246,211,122,.08) 52%,
          rgba(0,0,0,0) 76%),
        radial-gradient(110% 64% at 50% -10%,
          rgba(255,255,255,.18) 0%,
          rgba(246,211,122,.08) 30%,
          rgba(0,0,0,0) 72%),
        radial-gradient(circle at 50% 56%,
          rgba(246,211,122,.30) 0%,
          rgba(246,211,122,.26) 22%,
          rgba(246,211,122,.20) 36%,
          rgba(246,211,122,.08) 52%,
          rgba(0,0,0,0) 62%),
        radial-gradient(circle at 50% 56%,
          rgba(255,255,255,.10) 0%,
          rgba(255,255,255,.08) 38%,
          rgba(255,255,255,.00) 58%),
        radial-gradient(circle at 50% 55%,
          rgba(0,0,0,0) 0%,
          rgba(0,0,0,.18) 62%,
          rgba(0,0,0,.56) 100%);
      mix-blend-mode: screen;
      opacity: .92;
    }

    .shell::after{
      content:"";
      position:absolute; inset:-2px;
      pointer-events:none;
      background:
        radial-gradient(60% 50% at 50% 45%,
          rgba(255,255,255,.10) 0%,
          rgba(255,255,255,.05) 38%,
          rgba(0,0,0,0) 70%),
        conic-gradient(from 220deg at 50% 6%,
          rgba(255,255,255,.08),
          rgba(255,255,255,0) 18%,
          rgba(255,255,255,.06) 36%,
          rgba(255,255,255,0) 52%,
          rgba(255,255,255,.05) 70%,
          rgba(255,255,255,0) 86%,
          rgba(255,255,255,.06));
      opacity:.35;
      filter: blur(10px);
      mix-blend-mode: screen;
    }

    .topbar{
      position:absolute;
      left: var(--safe);
      right: var(--safe);
      top: var(--safe);
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content:space-between;
      z-index:5;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,.40);
      border: 1px solid rgba(246,211,122,.22);
      color: var(--gold);
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      white-space:nowrap;
      max-width: 100%;
    }

    .btn{
      cursor:pointer;
      user-select:none;
      appearance:none;
      outline:none;
      font: inherit;
      color: var(--gold);
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,.28);
      padding: 10px 14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.18));
      box-shadow: 0 10px 28px rgba(0,0,0,.38), inset 0 0 0 1px rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn:hover{ filter: brightness(1.05); }
    .btn:active{ transform: translateY(1px); }

    .title{
      position:absolute;
      top: calc(var(--safe) + 52px);
      left: 0; right:0;
      text-align:center;
      z-index:4;
      pointer-events:none;
      padding: 0 18px;
    }
    .title h1{
      margin: 0;
      font-size: clamp(38px, 5vw, 72px);
      letter-spacing: .12em;
      color: var(--gold);
      text-shadow:
        0 4px 18px rgba(0,0,0,.6),
        0 0 22px rgba(246,211,122,.20);
      font-weight: 700;
    }

    .center{
      position:absolute;
      inset: 120px var(--safe) var(--safe) var(--safe);
      display:grid;
      grid-template-columns: 1fr minmax(280px, 520px) 1fr;
      gap: clamp(18px, 2.6vw, 42px);
      align-items:center;
      justify-items:center;
      z-index:3;
      padding: clamp(18px, 3vw, 36px);
    }

    .col{
      width:100%;
      display:flex;
      flex-direction:column;
      gap: clamp(22px, 5vh, 56px);
      align-items:center;
      justify-content:center;
    }

    .nav-btn{
      width: var(--btn-w);
      max-width: 100%;
      min-height: var(--btn-h);
      padding: 16px 22px;
      border-radius: var(--btn-r);
      border: 1px solid rgba(246,211,122,.26);
      background:
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.22));
      box-shadow:
        0 14px 40px rgba(0,0,0,.48),
        inset 0 0 0 1px rgba(255,255,255,.04);
      color: var(--gold);
      text-decoration:none;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      letter-spacing:.08em;
      font-size: clamp(15px, 1.4vw, 18px);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .nav-btn:hover{ filter:brightness(1.06); }
    .nav-btn:active{ transform: translateY(1px); }

    .lotusWrap{
      position:relative;
      width: min(520px, 92%);
      aspect-ratio: 1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-top: clamp(10px, 2vh, 24px);
    }
    .lotusWrap::before{
      content:"";
      position:absolute;
      width: 132%;
      height: 132%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 55%,
          rgba(246,211,122,.18) 0%,
          rgba(246,211,122,.16) 26%,
          rgba(246,211,122,.10) 40%,
          rgba(246,211,122,.04) 54%,
          rgba(0,0,0,0) 62%);
      filter: blur(1px);
      opacity:.95;
      mix-blend-mode: screen;
    }

    .lotus{
      width: min(460px, 92%);
      height:auto;
      display:block;
      filter:
        drop-shadow(0 22px 42px rgba(0,0,0,.58))
        drop-shadow(0 0 22px rgba(246,211,122,.22));
      transform: translateZ(0);
    }
    .lotusSvg{ display:none; }

    /* ========= åœ–2å¼§å½¢æ’ç‰ˆï¼šæ ¸å¿ƒ ========= */
    .mantra{
      position:absolute;
      inset: 0;
      pointer-events:none;
      color: rgba(246,211,122,.72);
      text-shadow: 0 6px 20px rgba(0,0,0,.55);
      font-weight: 600;
      letter-spacing: .2em;
    }

    /* å¼§å½¢ã€Œç©ºç„¡æ˜ã€ */
    .arcText{
      position:absolute;
      top: clamp(6px, 2.2vh, 18px);
      left: 50%;
      transform: translateX(-50%);
      width: var(--arc-w);
      height: var(--arc-h);
      filter:
        drop-shadow(0 10px 24px rgba(0,0,0,.55))
        drop-shadow(0 0 18px rgba(246,211,122,.18));
      opacity: .92;
    }
    .arcText text{
      font-family: "Noto Serif TC", "Microsoft JhengHei", system-ui, sans-serif;
      font-size: var(--arc-font);
      fill: rgba(246,211,122,.78);
      letter-spacing: .35em; /* ä¸€é«”æ„Ÿ */
      font-weight: 700;
    }

    /* å‘¨åœå­—ï¼šé‡æ–°æ ¡æ­£åˆ°è“®èŠ±å‘¨é‚Šã€å·¦å³å°ç¨± */
    .sideCol{
      position:absolute;
      top: 38%;
      transform: translateY(-50%);
      display:flex;
      flex-direction:column;
      gap: clamp(14px, 2.2vh, 20px);
      font-size: clamp(18px, 2.1vw, 28px);
      opacity: .86;
    }
    .sideLeft{ left: clamp(16px, 4.8vw, 44px); }
    .sideRight{ right: clamp(16px, 4.8vw, 44px); }

    /* ä¸­å¤®å…§åœˆå­—ï¼ˆä¿ç•™ä½ çš„ç¦ªå­—æ°›åœï¼Œä½†è®“ä½ç½®æ›´é›†ä¸­ï¼‰ */
    .inner{
      position:absolute;
      left:50%;
      top:56%;
      transform: translate(-50%,-50%);
      display:grid;
      gap: clamp(10px, 2vh, 18px);
      text-align:center;
      font-size: clamp(16px, 2.0vw, 26px);
      opacity:.80;
      letter-spacing:.18em;
    }
    .inner .row{
      display:flex;
      gap: clamp(18px, 3vw, 42px);
      justify-content:center;
      align-items:center;
    }

    /* ä¸‹æ–¹ã€Œç©ºç„¡æ˜éœã€ï¼šå¾®æ”¶æ–‚ã€ç½®åº•ä¸å¹²æ“¾ */
    .bottomRow{
      position:absolute;
      left:50%;
      bottom: clamp(10px, 2.4vh, 18px);
      transform: translateX(-50%);
      display:flex;
      gap: clamp(18px, 3.2vw, 46px);
      font-size: clamp(18px, 2.1vw, 28px);
      opacity:.82;
      letter-spacing:.22em;
    }

    /* Login overlay */
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
      background: rgba(0,0,0,.42);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .overlay.show{ display:flex; }

    .loginCard{
      width: min(520px, 92vw);
      border-radius: 18px;
      border: 1px solid rgba(246,211,122,.22);
      background:
        radial-gradient(circle at 50% 0%, rgba(246,211,122,.18) 0, rgba(0,0,0,.10) 55%, rgba(0,0,0,.26) 100%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
      box-shadow: 0 18px 60px rgba(0,0,0,.6), inset 0 0 0 1px rgba(255,255,255,.04);
      padding: 18px;
      position:relative;
      overflow:hidden;
    }
    .loginCard h2{
      margin: 4px 0 14px;
      text-align:center;
      letter-spacing:.14em;
      font-size: 20px;
      color: var(--gold);
      text-shadow: 0 8px 22px rgba(0,0,0,.55);
    }
    .row{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin: 10px 0;
    }
    label{
      font-size: 13px;
      opacity:.9;
      letter-spacing:.1em;
    }
    select, input{
      width:100%;
      border-radius: 999px;
      border: 1px solid rgba(246,211,122,.22);
      background: rgba(0,0,0,.40);
      color: var(--gold);
      padding: 12px 14px;
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      font-family: inherit;
    }
    .pwWrap{ position:relative; }
    .pwToggle{
      position:absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border-radius: 999px;
      padding: 8px 10px;
      border: 1px solid rgba(246,211,122,.22);
      background: rgba(0,0,0,.35);
      color: var(--gold);
      cursor:pointer;
    }
    .loginActions{
      display:flex;
      gap: 10px;
      justify-content:space-between;
      margin-top: 12px;
      flex-wrap:wrap;
    }
    .hint{
      margin-top: 10px;
      font-size: 13px;
      opacity:.88;
      color: rgba(246,211,122,.88);
      text-shadow: 0 6px 18px rgba(0,0,0,.55);
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(246,211,122,.14);
      background: rgba(0,0,0,.22);
    }

    /* æ‰‹æ©Ÿï¼šé¿å…æ“ å£“ï¼Œå·¦å³åˆ—éš±è—ï¼Œä½†å¼§å½¢ä¿ç•™ */
    @media (max-width: 980px){
      .center{
        grid-template-columns: 1fr;
        inset: 120px var(--safe) var(--safe) var(--safe);
        gap: 16px;
      }
      .col{ gap: 14px; }
      .lotusWrap{ width: min(520px, 96%); }
      .sideCol{ display:none; }
      .inner{ top:58%; }
    }

    @media (max-width: 560px){
      .title{ top: calc(var(--safe) + 42px); }
      .topbar{ gap: 10px; }
      .pill{ padding: 8px 12px; }
      .btn{ padding: 9px 12px; }
      .nav-btn{ min-height: 58px; }
      .arcText{ top: 6px; }
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="shell" id="shell">
      <div class="topbar">
        <div class="pill" id="whoPill">ç›®å‰ä½¿ç”¨è€…ï¼šâ€”</div>
        <button class="btn" id="switchBtn">åˆ‡æ›å¸³è™Ÿ</button>
      </div>

      <div class="title">
        <h1>Tasun è³‡æ–™</h1>
      </div>

      <div class="center">
        <div class="col" id="leftCol">
          <a class="nav-btn" data-key="btn1" href="è‡»é¼ç®¡ç†è¡¨.html">è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨</a>
          <a class="nav-btn" data-key="btn3" href="https://www.dropbox.com/" target="_blank" rel="noopener">é›²ç«¯æª”æ¡ˆ</a>
          <a class="nav-btn" data-key="btn5" href="è³‡æ–™åº«.html">è³‡æ–™åº«</a>
        </div>

        <div class="lotusWrap">
          <img class="lotus" id="lotusImg" src="lotus-gold.png" alt="Lotus" />

          <!-- å…§å»º 3D è“®èŠ± SVGï¼ˆåœ–ç‰‡å¤±æ•—æ‰é¡¯ç¤ºï¼Œä¸æœƒå†ä¸è¦‹ï¼‰ -->
          <svg id="lotusSvg" class="lotus lotusSvg" viewBox="0 0 700 520" xmlns="http://www.w3.org/2000/svg" aria-label="Lotus">
            <defs>
              <radialGradient id="gCore" cx="50%" cy="45%" r="60%">
                <stop offset="0%" stop-color="#ffe9b6" stop-opacity=".95"/>
                <stop offset="45%" stop-color="#f6d37a" stop-opacity=".75"/>
                <stop offset="100%" stop-color="#a37a2a" stop-opacity=".10"/>
              </radialGradient>

              <linearGradient id="gPetal" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#ffe7b0" stop-opacity=".90"/>
                <stop offset="55%" stop-color="#f6d37a" stop-opacity=".55"/>
                <stop offset="100%" stop-color="#2a1d06" stop-opacity=".05"/>
              </linearGradient>

              <filter id="soft" x="-30%" y="-30%" width="160%" height="160%">
                <feGaussianBlur stdDeviation="1.6" result="b"/>
                <feMerge>
                  <feMergeNode in="b"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>

              <filter id="glow" x="-30%" y="-30%" width="160%" height="160%">
                <feGaussianBlur stdDeviation="12" result="gb"/>
                <feColorMatrix in="gb" type="matrix"
                  values="1 0 0 0 0
                          0 0.92 0 0 0
                          0 0 0.55 0 0
                          0 0 0 0.45 0" result="gc"/>
                <feMerge>
                  <feMergeNode in="gc"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>

            <ellipse cx="350" cy="320" rx="250" ry="140" fill="url(#gCore)" opacity=".35" filter="url(#glow)"/>

            <g filter="url(#soft)" opacity=".95">
              <path d="M135 332 C165 225, 250 165, 330 210 C265 265, 235 325, 250 392 C210 392, 165 372, 135 332 Z"
                    fill="url(#gPetal)"/>
              <path d="M565 332 C535 225, 450 165, 370 210 C435 265, 465 325, 450 392 C490 392, 535 372, 565 332 Z"
                    fill="url(#gPetal)"/>
            </g>

            <g filter="url(#soft)" opacity=".90">
              <path d="M85 340 C120 190, 250 110, 350 170 C250 245, 185 325, 205 420 C150 420, 110 395, 85 340 Z"
                    fill="url(#gPetal)" opacity=".85"/>
              <path d="M615 340 C580 190, 450 110, 350 170 C450 245, 515 325, 495 420 C550 420, 590 395, 615 340 Z"
                    fill="url(#gPetal)" opacity=".85"/>
            </g>

            <g filter="url(#soft)">
              <path d="M350 84 C408 135, 455 212, 435 300 C418 370, 392 415, 350 452 C308 415, 282 370, 265 300 C245 212, 292 135, 350 84 Z"
                    fill="url(#gPetal)" opacity=".98"/>
              <path d="M260 130 C310 160, 342 220, 330 292 C320 350, 300 392, 276 420 C248 390, 230 348, 220 300 C205 230, 225 165, 260 130 Z"
                    fill="url(#gPetal)" opacity=".80"/>
              <path d="M440 130 C390 160, 358 220, 370 292 C380 350, 400 392, 424 420 C452 390, 470 348, 480 300 C495 230, 475 165, 440 130 Z"
                    fill="url(#gPetal)" opacity=".80"/>
            </g>

            <ellipse cx="350" cy="310" rx="86" ry="56" fill="url(#gCore)" opacity=".78" filter="url(#soft)"/>
            <ellipse cx="350" cy="310" rx="42" ry="26" fill="#ffe9b6" opacity=".55"/>
          </svg>

          <!-- åœ–2å¼§å½¢æ–‡å­—ï¼šç©ºç„¡æ˜ï¼ˆä¸€é«”æ„Ÿå¼§å½¢ï¼‰+ å‘¨åœå­—æ ¡æ­£ -->
          <div class="mantra" aria-hidden="true">
            <!-- å¼§å½¢ï¼šç©ºç„¡æ˜ -->
            <svg class="arcText" viewBox="0 0 600 200" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <!-- å¼§ç·šï¼šä½ è‹¥è¦æ›´å½ï¼ŒæŠŠ Q çš„æ§åˆ¶é» y å€¼èª¿æ›´å°ï¼Œä¾‹å¦‚ 18ï¼›è¦æ›´å¹³å°±èª¿å¤§ï¼Œä¾‹å¦‚ 60 -->
                <path id="arcPath" d="M 70 140 Q 300 22 530 140" />
              </defs>
              <text text-anchor="middle">
                <textPath href="#arcPath" startOffset="50%">ç©º ç„¡ æ˜</textPath>
              </text>
            </svg>

            <!-- å·¦å³å­—åˆ—ï¼ˆæ¡Œæ©Ÿé¡¯ç¤ºï¼Œæ‰‹æ©Ÿéš±è—ï¼‰ -->
            <div class="sideCol sideLeft">
              <span>ç„¡</span><span>ç©º</span><span>éˆ</span><span>ç„¡</span><span>æˆ‘</span>
            </div>
            <div class="sideCol sideRight">
              <span>æ˜</span><span>æ¸…</span><span>æ˜</span><span>å¯§</span><span>éœ</span>
            </div>

            <!-- å…§åœˆå­—ï¼šæ›´é›†ä¸­ï¼ˆä¸é£„æ•£ï¼‰ -->
            <div class="inner">
              <div class="row"><span>ç„¡</span><span>ç©º</span><span>æ˜</span></div>
              <div class="row" style="opacity:.92;"><span>ç©º</span><span>ç„¡</span><span>æ˜</span></div>
            </div>

            <!-- åº•éƒ¨ï¼šç©ºç„¡æ˜éœ -->
            <div class="bottomRow"><span>ç©º</span><span>ç„¡</span><span>æ˜</span><span>éœ</span></div>
          </div>
        </div>

        <div class="col" id="rightCol">
          <a class="nav-btn" data-key="btn2" href="ç”„é¼quality.html">ç¼ºå¤± / å“è³ª</a>
          <a class="nav-btn" data-key="btn4" href="å·¥ç¨‹è³‡æ–™åº«.html">å·¥ç¨‹è³‡æ–™åº«</a>
          <a class="nav-btn" data-key="btn6" data-admin-only="1" href="æ¬Šé™è¡¨.html">ç³»çµ± / æ¬Šé™</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Login overlay -->
  <div class="overlay" id="overlay">
    <div class="loginCard">
      <h2>Tasun è³‡æ–™ Â· ç™»å…¥</h2>

      <div class="row">
        <label for="userSel">å¸³è™Ÿï¼ˆä¸‹æ‹‰é¸å–®ï¼‰</label>
        <select id="userSel"></select>
      </div>

      <div class="row">
        <label for="pw">å¯†ç¢¼</label>
        <div class="pwWrap">
          <input id="pw" type="password" placeholder="è¼¸å…¥å¯†ç¢¼" autocomplete="current-password" />
          <button class="pwToggle" id="pwToggle" type="button" title="é¡¯ç¤º/éš±è—">ğŸ‘</button>
        </div>
      </div>

      <div class="loginActions">
        <button class="btn" id="loginBtn">ç™»å…¥</button>
        <button class="btn" id="closeLoginBtn" style="opacity:.9">é—œé–‰</button>
      </div>

      <div class="hint" id="hint">è«‹é¸æ“‡å¸³è™Ÿä¸¦è¼¸å…¥å¯†ç¢¼ã€‚</div>
    </div>
  </div>

<script>
(() => {
  const AUTH_KEY    = 'tasunAuthTable_v1';
  const CURRENT_KEY = 'tasunCurrentUser_v1';
  const BTN_META_KEY= 'tasunButtonMeta_v1';

  const BUTTON_DEFS = [
    { key:'btn1', name:'è‡»é¼æ™‚ä»£å¤§å»ˆç®¡ç†è¡¨', href:'è‡»é¼ç®¡ç†è¡¨.html' },
    { key:'btn2', name:'ç¼ºå¤± / å“è³ª',       href:'ç”„é¼quality.html' },
    { key:'btn3', name:'é›²ç«¯æª”æ¡ˆ',           href:'https://www.dropbox.com/' },
    { key:'btn4', name:'å·¥ç¨‹è³‡æ–™åº«',         href:'å·¥ç¨‹è³‡æ–™åº«.html' },
    { key:'btn5', name:'è³‡æ–™åº«',             href:'è³‡æ–™åº«.html' },
  ];

  function ensureButtonMeta(){
    localStorage.setItem(BTN_META_KEY, JSON.stringify(BUTTON_DEFS));
  }

  function safeJsonParse(s, fallback){
    try{ return JSON.parse(s); }catch(e){ return fallback; }
  }

  function bool(v){
    return v === true || v === 1 || v === '1' || v === 'true';
  }

  function normalizeAuthList(list){
    if(!Array.isArray(list)) return [];
    const roleOK = new Set(['admin','write','read']);

    const cleaned = list.map(x => {
      const user = String((x && x.user != null) ? x.user : '').trim();
      const pass = String((x && x.pass != null) ? x.pass : '');
      const role0 = String((x && x.role != null) ? x.role : 'read').toLowerCase();
      const role = roleOK.has(role0) ? role0 : 'read';

      const row = { user, pass, role };
      for(let i=1;i<=5;i++){
        const k = 'btn'+i;
        row[k] = bool(x && x[k]);
      }
      return row;
    }).filter(r => r.user !== '' && r.user.toLowerCase() !== 'undefined');

    return cleaned;
  }

  function seedAuthIfMissingOrBroken(){
    const raw = localStorage.getItem(AUTH_KEY);
    const parsed = safeJsonParse(raw || 'null', null);
    const cleaned = normalizeAuthList(parsed);

    if(!cleaned.length){
      const seed = [
        { user:'alex',  pass:'Tasun08040224', role:'admin', btn1:true, btn2:true, btn3:true, btn4:true, btn5:true },
        { user:'tasun', pass:'tasun08040224', role:'write', btn1:true, btn2:true, btn3:false, btn4:true, btn5:false },
        { user:'wu',    pass:'123456',        role:'read',  btn1:true, btn2:false,btn3:false, btn4:false,btn5:false },
        { user:'JOYCE', pass:'09220224',      role:'admin', btn1:true, btn2:true, btn3:true, btn4:true, btn5:true },
      ];
      localStorage.setItem(AUTH_KEY, JSON.stringify(seed));
      return seed;
    }

    localStorage.setItem(AUTH_KEY, JSON.stringify(cleaned));
    return cleaned;
  }

  function readAuth(){
    const parsed = safeJsonParse(localStorage.getItem(AUTH_KEY) || '[]', []);
    return normalizeAuthList(parsed);
  }

  function readCurrent(){
    const c = safeJsonParse(localStorage.getItem(CURRENT_KEY) || 'null', null);
    if(!c || typeof c !== 'object') return null;

    const user = String(c.user || '').trim();
    if(!user || user.toLowerCase() === 'undefined') return null;

    const auth = readAuth();
    const row = auth.find(a => a.user.toLowerCase() === user.toLowerCase());
    if(!row) return null;

    return { user: row.user, role: row.role };
  }

  function setCurrent(userObj){
    localStorage.setItem(CURRENT_KEY, JSON.stringify(userObj));
  }

  function applyPermissions(current){
    const whoPill = document.getElementById('whoPill');
    const buttons = document.querySelectorAll('.nav-btn');

    if(!current){
      whoPill.textContent = 'ç›®å‰ä½¿ç”¨è€…ï¼šâ€”';
      buttons.forEach(b => b.style.display = 'none');
      return;
    }

    whoPill.textContent = `ç›®å‰ä½¿ç”¨è€…ï¼š${current.user} (${current.role})`;

    const auth = readAuth();
    const row = auth.find(x => x.user.toLowerCase() === current.user.toLowerCase());
    const role = (current.role||'read').toLowerCase();

    buttons.forEach(b => {
      const key = b.dataset.key;
      const adminOnly = b.dataset.adminOnly === '1';

      if(adminOnly){
        b.style.display = (role === 'admin') ? '' : 'none';
        return;
      }

      if(role === 'admin'){
        b.style.display = '';
        return;
      }

      const allowed = row ? bool(row[key]) : false;
      b.style.display = allowed ? '' : 'none';
    });
  }

  // UI: login
  const overlay = document.getElementById('overlay');
  const userSel = document.getElementById('userSel');
  const pw      = document.getElementById('pw');
  const hint    = document.getElementById('hint');
  const loginBtn= document.getElementById('loginBtn');
  const closeLoginBtn = document.getElementById('closeLoginBtn');
  const switchBtn = document.getElementById('switchBtn');
  const pwToggle = document.getElementById('pwToggle');

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function openLogin(){
    const auth = readAuth();
    userSel.innerHTML =
      `<option value="" selected disabled>è«‹é¸æ“‡å¸³è™Ÿ</option>` +
      auth.map(a => `<option value="${escapeHtml(a.user)}">${escapeHtml(a.user)}</option>`).join('');
    pw.value = '';
    hint.textContent = 'è«‹é¸æ“‡å¸³è™Ÿä¸¦è¼¸å…¥å¯†ç¢¼ã€‚';
    overlay.classList.add('show');
    setTimeout(()=> userSel.focus(), 120);
  }

  function closeLogin(){
    overlay.classList.remove('show');
  }

  function doLogin(){
    const auth = readAuth();
    const u = (userSel.value || '').trim();
    const p = (pw.value || '').trim();

    if(!u){
      hint.textContent = 'è«‹å…ˆé¸æ“‡å¸³è™Ÿã€‚';
      return;
    }

    const row = auth.find(a => a.user.toLowerCase() === u.toLowerCase());
    if(!row){
      hint.textContent = 'æ‰¾ä¸åˆ°æ­¤å¸³è™Ÿã€‚';
      return;
    }
    if(String(row.pass||'') !== p){
      hint.textContent = 'å¯†ç¢¼éŒ¯èª¤ã€‚';
      return;
    }

    setCurrent({ user: row.user, role: row.role });
    applyPermissions(readCurrent());
    closeLogin();
  }

  pwToggle.addEventListener('click', () => {
    pw.type = (pw.type === 'password') ? 'text' : 'password';
    pwToggle.textContent = (pw.type === 'password') ? 'ğŸ‘' : 'ğŸ™ˆ';
  });

  loginBtn.addEventListener('click', doLogin);
  closeLoginBtn.addEventListener('click', closeLogin);
  switchBtn.addEventListener('click', () => {
    localStorage.removeItem(CURRENT_KEY);
    applyPermissions(null);
    openLogin();
  });
  pw.addEventListener('keydown', (e) => { if(e.key === 'Enter') doLogin(); });

  // è“®èŠ±åœ–æª”ä¸å­˜åœ¨ï¼šæ”¹ç”¨ SVG
  const lotusImg = document.getElementById('lotusImg');
  const lotusSvg = document.getElementById('lotusSvg');
  lotusImg.addEventListener('error', () => {
    lotusImg.style.display = 'none';
    lotusSvg.style.display = 'block';
  });

  // init
  ensureButtonMeta();
  seedAuthIfMissingOrBroken();

  const cur = readCurrent();
  if(cur){
    applyPermissions(cur);
  }else{
    applyPermissions(null);
    openLogin();
  }

  window.addEventListener('storage', (e) => {
    if(e.key === AUTH_KEY || e.key === CURRENT_KEY){
      seedAuthIfMissingOrBroken();
      applyPermissions(readCurrent());
    }
  });

})();
</script>
</body>
</html>
